<!doctype html>
<html lang="zh-CN">









<head>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
  <!-- ä¼˜å…ˆä½¿ç”¨ IE æœ€æ–°ç‰ˆæœ¬å’Œ Chrome -->
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
  <!-- ä¸ºç§»åŠ¨è®¾å¤‡æ·»åŠ  viewport -->
  <meta name="viewport" content="width=device-width,initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no">
  <!-- æ·»åŠ åˆ°ä¸»å±åçš„æ ‡é¢˜ï¼ˆiOS 6 æ–°å¢ï¼‰ -->
  <meta name="apple-mobile-web-app-title" content="å…³äºsocket.ioçš„ä½¿ç”¨ - Jeff's world">
  <!-- æ˜¯å¦å¯ç”¨ WebApp å…¨å±æ¨¡å¼ï¼Œåˆ é™¤è‹¹æœé»˜è®¤çš„å·¥å…·æ å’Œèœå•æ  -->
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <!-- è®¾ç½®è‹¹æœå·¥å…·æ é¢œè‰² -->
  <meta name="apple-mobile-web-app-status-bar-style" content = "black" />
  <!-- æ·»åŠ æ™ºèƒ½ App å¹¿å‘Šæ¡ Smart App Bannerï¼ˆiOS 6+ Safariï¼‰ -->
  <!-- <meta name = "apple-itunes-app" content = "app-id=myAppStoreID, affiliate-data=myAffiliateData, app-argument=myURL"> -->
  <!-- å¿½ç•¥é¡µé¢ä¸­çš„æ•°å­—è¯†åˆ«ä¸ºç”µè¯ï¼Œå¿½ç•¥emailè¯†åˆ« -->
  <meta name="format-detection" content = "telphone=no, email=no" />
  <!--ä¸‹é¢ä¸‰ä¸ªæ˜¯æ¸…é™¤ç¼“å­˜ å¾®ä¿¡æµè§ˆå™¨ç¼“å­˜ä¸¥é‡åˆæ— åˆ·æ–°ï¼›è¿™ä¸ªæ–¹æ³•è°ƒè¯•çš„æ—¶å€™å¾ˆæ–¹ä¾¿-->
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Cache-Control" content="no-cache">
  <meta http-equiv="Expires" content="0">
  
  <link rel="dns-prefetch" href="https://jeff_zhong.gitee.io">
  <link rel="icon shortcut" type="image/ico" href="/favicon.ico">
  <meta name="author" content="Jeff Zhong">
  <meta name="description" content="it's a blog by hexo">
  <meta name="keywords" content="hexo theme">
  <title >å…³äºsocket.ioçš„ä½¿ç”¨ - Jeff's world</title>
    <!-- The Open Graph protocol -->
  <meta property="og:url" content="https://jeff_zhong.gitee.io">
  <meta property="og:type" content="blog">
  <meta property="og:title" content="å…³äºsocket.ioçš„ä½¿ç”¨ - Jeff's world">
  <meta property="og:description" content="it's a blog by hexo">
  
    
    
      <link rel="stylesheet" href="/blog/lib/fontello/fontello.css">
    
      <link rel="stylesheet" href="/blog/lib/reboto/roboto.css">
    
      <link rel="stylesheet" href="/blog/css/index.css">
    
  
  <script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?5255e97b442092b8e1a219e6a48a0d42";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>

<meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/blog/atom.xml" title="Jeff's world" type="application/atom+xml">
</head>
<body>
<header class="header">
  <div class="top"></div>
  <h2>Jeff's World</h2>
  <h3>Things that I'm interested in</h3>
  <div class="menu">
  
  
  
      <a  href="/blog/" title="ä¸» é¡µ">
        <i class="icon-home"></i>
        <span>ä¸» é¡µ</span>
      </a>
  
      <a  href="https://jeff_zhong.gitee.io/demo/" title="Demo">
        <i class="icon-page"></i>
        <span>Demo</span>
      </a>
  
      <a  data-tag="search"  href="javascript:;" title="æœ ç´¢">
        <i class="icon-search"></i>
        <span>æœ ç´¢</span>
      </a>
  
  </div>
  <div class="state">
  
    <a href="/blog/archives">53<br>æ–‡ ç« </a><a href="/blog/categories">2<br>åˆ† ç±»</a><a href="/blog/tags">70<br>æ ‡ ç­¾</a>
  </div>
  <div class="social">
  
  
  
      <a href="https://github.com/edwardzhong" target="_blank" rel="noopener" title="Github"><i class="icon-github"></i></a>
  
      <a href="https://twitter.com/JianfengEdward" target="_blank" rel="noopener" title="Twitter"><i class="icon-twitter"></i></a>
  
      <a href="https://www.facebook.com/jianfeng.edward" target="_blank" rel="noopener" title="Facebook"><i class="icon-facebook"></i></a>
  
      <a href="http://weibo.com/1593251850" target="_blank" rel="noopener" title="Weibo"><i class="icon-weibo"></i></a>
  
      <a href="/blog/atom.xml" title="Rss"><i class="icon-rss"></i></a>
  
  </div>
  <div id="payBtn" class="pay-icon" title="è°¢è°¢æ‚¨çš„èµèµ">èµ</div>
</header>
  <div class="container">
    <div class="main">
    
        
<div class="post-list">
	<article class="post" style="animation:listshow 0.6s ease-out both 0.30000000000000004s">
    
    
        
    
	
	<a href="javascript:;">
        <div class="post-banner" style="background: url(/blog/images/banner9.jpg)  center top / 100% no-repeat">
    		<h3 class="post-title">å…³äºsocket.ioçš„ä½¿ç”¨</h3>
    	</div>
	</a>
	<div class="post-inner">
	
    	<div class="post-info">
    		<time><i class="icon-calendar"></i> 2019/03/29 00:44:00</time>
    		<span class="category">
    		
    			
    			<i class="icon-book"></i>
    			
                    
                        <a href="/blog/categories/%E6%8A%80%E6%9C%AF/">æŠ€æœ¯</a>
                    
    			
    		
    		</span>
    	</div>
    	<!-- <p><p>è¿™æ®µæ—¶é—´å­¦ä¹ äº†socket.ioï¼Œç”¨å®ƒå†™äº†å°é¡¹ç›®ï¼Œåœ¨æ­¤æ€»ç»“ä¸‹å®ƒçš„åŸºæœ¬ä½¿ç”¨æ–¹å¼å’Œä¸€äº›è¦ç‚¹ã€‚socket.ioæ˜¯åŸºäºNode.jså’ŒWebSocketåè®®çš„å®æ—¶é€šä¿¡å¼€æºæ¡†æ¶ï¼Œå®ƒåŒ…æ‹¬å®¢æˆ·ç«¯çš„JavaSâ€¦</p>
</p> -->
    	
    		<div class="post-content"><p>è¿™æ®µæ—¶é—´å­¦ä¹ äº†<strong>socket.io</strong>ï¼Œç”¨å®ƒå†™äº†å°é¡¹ç›®ï¼Œåœ¨æ­¤æ€»ç»“ä¸‹å®ƒçš„åŸºæœ¬ä½¿ç”¨æ–¹å¼å’Œä¸€äº›è¦ç‚¹ã€‚<br><strong>socket.io</strong>æ˜¯åŸºäº<strong>Node.js</strong>å’Œ<strong>WebSocket</strong>åè®®çš„å®æ—¶é€šä¿¡å¼€æºæ¡†æ¶ï¼Œå®ƒåŒ…æ‹¬å®¢æˆ·ç«¯çš„JavaScriptå’ŒæœåŠ¡å™¨ç«¯çš„Node.jsã€‚</p>
<h2 id="æœåŠ¡ç«¯"><a href="#æœåŠ¡ç«¯" class="headerlink" title="æœåŠ¡ç«¯"></a>æœåŠ¡ç«¯</h2><p>è¿™é‡Œåç«¯ä½¿ç”¨çš„æ¡†æ¶æ˜¯<strong>koa2</strong>ï¼Œ<strong>socket.io</strong>å°†è‡ªèº«ç»‘å®šåˆ°koaçš„è¿›ç¨‹ä¸­å»ï¼Œå…¶ä¸­æœ€é‡è¦çš„äº‹ä»¶å°±æ˜¯ <strong>connection</strong> å’Œ <strong>disconnect</strong>ã€‚å®ƒä»¬æ˜¯æ¡†æ¶æœ¬èº«å®šä¹‰çš„ç³»ç»Ÿäº‹ä»¶ï¼Œä¹Ÿå°±æ„å‘³ç€å®ƒæ˜¯è‡ªç„¶å°±å­˜åœ¨çš„ä¸éœ€è¦æˆ‘ä»¬è‡ªå®šä¹‰ï¼Œå½“ç„¶è¿˜æœ‰å…¶å®ƒç³»ç»Ÿäº‹ä»¶ï¼Œä½†å¾ˆå°‘ä¼šç”¨å¾—åˆ°ã€‚</p>
<a id="more"></a>

<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> koa = <span class="built_in">require</span>(<span class="string">'koa'</span>)</span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> koa()</span><br><span class="line"><span class="keyword">const</span> server = <span class="built_in">require</span>(<span class="string">'http'</span>).createServer(app.callback())</span><br><span class="line"><span class="keyword">const</span> io = <span class="built_in">require</span>(<span class="string">'socket.io'</span>)(server)</span><br><span class="line"></span><br><span class="line"><span class="comment">//ç›‘å¬connectäº‹ä»¶</span></span><br><span class="line">io.on(<span class="string">'connection'</span>, socket =&gt; &#123;</span><br><span class="line">  socket.emit(<span class="string">'open'</span>);<span class="comment">//é€šçŸ¥å®¢æˆ·ç«¯å·²è¿æ¥</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'connected'</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//ç›‘å¬disconnectäº‹ä»¶</span></span><br><span class="line">  socket.on(<span class="string">'disconnect'</span>, () =&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'disconnect'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line">server.listen(<span class="number">3001</span>);</span><br></pre></td></tr></table></figure>

<h2 id="å®¢æˆ·ç«¯"><a href="#å®¢æˆ·ç«¯" class="headerlink" title="å®¢æˆ·ç«¯"></a>å®¢æˆ·ç«¯</h2><p>webç«¯ç›´æ¥ä¼ å…¥urlåœ°å€å³å¯ï¼Œå…¶ä¸­è¿™é‡Œç›‘å¬çš„ <strong>open</strong> äº‹ä»¶æ˜¯ç”¨æˆ·è‡ªå®šä¹‰çš„ï¼Œå¯¹åº”æœåŠ¡ç«¯çš„åˆ™æ˜¯å‘é€<strong>open</strong>äº‹ä»¶ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> io <span class="keyword">from</span> <span class="string">'socket.io-client'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å»ºç«‹websocketè¿æ¥</span></span><br><span class="line"><span class="keyword">const</span> socket = io(<span class="string">'http://127.0.0.1:3001'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ”¶åˆ°serverçš„è¿æ¥ç¡®è®¤</span></span><br><span class="line">socket.on(<span class="string">'open'</span>, () =&gt; &#123;</span><br><span class="line">    showTip(<span class="string">'socket io is open !'</span>);</span><br><span class="line">    init();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="emit-å’Œ-on"><a href="#emit-å’Œ-on" class="headerlink" title="emit å’Œ on"></a>emit å’Œ on</h2><p><strong>emit</strong> å’Œ <strong>on</strong> æ˜¯æœ€é‡è¦çš„ä¸¤ä¸ªapiï¼Œåˆ†åˆ«å¯¹åº” <strong>å‘é€</strong> å’Œ <strong>ç›‘å¬</strong> äº‹ä»¶ã€‚</p>
<ul>
<li><strong>socket.emit(eventName[, â€¦args])</strong>ï¼šå‘å°„ï¼ˆè§¦å‘ï¼‰ä¸€ä¸ªäº‹ä»¶</li>
<li><strong>socket.on(eventName, callback)</strong>ï¼šç›‘å¬ä¸€ä¸ª emit å‘å°„çš„äº‹ä»¶</li>
</ul>
<p>æˆ‘ä»¬å¯ä»¥éå¸¸è‡ªç”±çš„åœ¨æœåŠ¡ç«¯å®šä¹‰å¹¶å‘é€ä¸€ä¸ªäº‹ä»¶<strong>emit</strong>ï¼Œç„¶ååœ¨å®¢æˆ·ç«¯ç›‘å¬ <strong>on</strong>ï¼Œåè¿‡æ¥ä¹Ÿä¸€æ ·ã€‚</p>
<p>å‘é€çš„å†…å®¹æ ¼å¼ä¹Ÿéå¸¸è‡ªç”±ï¼Œæ—¢å¯ä»¥æ˜¯åŸºæœ¬æ•°æ®ç±»å‹ <strong>Number</strong>ï¼Œ<strong>String</strong>ï¼Œ<strong>Boolean</strong> ç­‰ï¼Œä¹Ÿå¯ä»¥æ˜¯ <strong>Object</strong>ï¼Œ<strong>Array</strong> ç±»å‹ï¼Œç”šè‡³è¿˜å¯ä»¥æ˜¯å‡½æ•°ã€‚è€Œç”¨å›è°ƒå‡½æ•°çš„æ–¹å¼åˆ™å¯ä»¥è¿›è¡Œæ›´ä¾¿æºçš„äº¤äº’ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*** æœåŠ¡ç«¯ **/</span></span><br><span class="line">socket.on(<span class="string">'message'</span>,data =&gt;&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(data)</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">socket.emit(<span class="string">'send'</span>,<span class="string">'hello everybody'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/*** å®¢æˆ·ç«¯ **/</span></span><br><span class="line">socket.emit(<span class="string">'message'</span>,&#123;<span class="attr">id</span>:<span class="string">'1'</span>,<span class="attr">txt</span>:<span class="string">'hello'</span>&#125;);</span><br><span class="line"></span><br><span class="line">socket.on(<span class="string">'send'</span>,data =&gt;&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(data);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//å›è°ƒå‡½æ•°</span></span><br><span class="line"><span class="comment">/*** æœåŠ¡ç«¯ **/</span></span><br><span class="line">socket.on(<span class="string">'sayit'</span>, (word, callback)=&gt; &#123;</span><br><span class="line">  callback(<span class="string">'say '</span> + word);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">/*** å®¢æˆ·ç«¯ **/</span></span><br><span class="line">socket.emit(<span class="string">'sayit'</span>, <span class="string">'wow'</span>, data =&gt; &#123; </span><br><span class="line">  <span class="built_in">console</span>.log(data); <span class="comment">// say wow</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="broadcast-å¹¿æ’­"><a href="#broadcast-å¹¿æ’­" class="headerlink" title="broadcast å¹¿æ’­"></a>broadcast å¹¿æ’­</h2><p><strong>broadcast</strong> é»˜è®¤æ˜¯å‘æ‰€æœ‰çš„socketè¿æ¥è¿›è¡Œå¹¿æ’­ï¼Œä½†æ˜¯ä¸åŒ…æ‹¬å‘é€è€…è‡ªèº«ï¼Œå¦‚æœè‡ªå·±ä¹Ÿæ‰“ç®—æ¥æ”¶æ¶ˆæ¯çš„è¯ï¼Œéœ€è¦ç»™è‡ªå·±å•ç‹¬å‘é€ã€‚</p>
 <figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*** æœåŠ¡ç«¯ **/</span></span><br><span class="line">io.on(<span class="string">'connection'</span>, socket =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> data= &#123;</span><br><span class="line">    txt:<span class="string">'new user login'</span>,</span><br><span class="line">    time:<span class="keyword">new</span> <span class="built_in">Date</span>()</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//å¹¿æ’­å‘æ‰€æœ‰socketè¿æ¥</span></span><br><span class="line">  socket.broadcast.emit(<span class="string">'userin'</span>,data);</span><br><span class="line">  <span class="comment">//ç»™è‡ªå·±ä¹Ÿå‘ä¸€ä»½</span></span><br><span class="line">  socket.emit(<span class="string">'userin'</span>,data);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>



<h2 id="namespace-å‘½åç©ºé—´"><a href="#namespace-å‘½åç©ºé—´" class="headerlink" title="namespace å‘½åç©ºé—´"></a>namespace å‘½åç©ºé—´</h2><p>å¦‚æœä½ æƒ³éš”ç¦»ä½œç”¨åŸŸï¼Œæˆ–è€…åˆ’åˆ†ä¸šåŠ¡æ¨¡å—ï¼Œ<strong>namespace</strong> æ˜¯ä¸ªæœ‰æ•ˆçš„æ³•å­ã€‚<strong>namespace</strong> ç›¸å½“äºå»ºç«‹æ–°çš„é¢‘é“ï¼Œä½ å¯ä»¥åœ¨ä¸€ä¸ª <strong>socket.io</strong> æœåŠ¡ä¸Šé¢éš”ç¦»ä¸åŒçš„è¿æ¥ï¼Œäº‹ä»¶å’Œä¸­é—´ä»¶ã€‚</p>
<p>é»˜è®¤çš„è¿æ¥ä¹Ÿæ˜¯æœ‰<strong>namespace</strong>çš„ï¼Œé‚£å°±æ˜¯ <strong>/</strong>ï¼›<br>ä½¿ç”¨å‘½åç©ºé—´çš„æ–¹å¼ä¸€ï¼šç›´æ¥åœ¨é“¾æ¥åé¢åŠ å­åŸŸåï¼Œè¿™ç§å…¶å®ç”¨çš„è¿˜æ˜¯åŒä¸€ä¸ª sokcet æœåŠ¡è¿›ç¨‹ï¼Œå¯ä»¥çœ‹æˆæ˜¯è½¯éš”ç¦»å§ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*** å®¢æˆ·ç«¯ **/</span></span><br><span class="line"><span class="keyword">import</span> io <span class="keyword">from</span> <span class="string">'socket.io-client'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//é»˜è®¤çš„namespace</span></span><br><span class="line"><span class="keyword">const</span> socket = io(<span class="string">'http://127.0.0.1:3001'</span>);</span><br><span class="line"><span class="comment">// mypath</span></span><br><span class="line"><span class="keyword">const</span> socket = io(<span class="string">'http://127.0.0.1:3001/mypath'</span>, &#123; <span class="attr">forceNew</span>: <span class="literal">true</span> &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">/*** æœåŠ¡ç«¯ **/</span></span><br><span class="line"><span class="comment">//é»˜è®¤çš„namespace</span></span><br><span class="line">io.on(<span class="string">'connection'</span>, socket =&gt; &#123;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// mypath</span></span><br><span class="line">io.of(<span class="string">'/mypath'</span>).on(<span class="string">'connection'</span>, socket =&gt; &#123;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨å‘½åç©ºé—´çš„æ–¹å¼äºŒï¼š path å‚æ•°ï¼Œè¿™ç§å°±æ˜¯å®æ‰“å®çš„é‡æ–°èµ·äº†ä¸€ä¸ª socket æœåŠ¡äº†ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*** å®¢æˆ·ç«¯ **/</span></span><br><span class="line"><span class="keyword">const</span> socket = io(<span class="string">'http://localhost'</span>, &#123;</span><br><span class="line">  path: <span class="string">'/mypath'</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">/*** æœåŠ¡ç«¯ **/</span></span><br><span class="line"><span class="comment">// å¦å¤–é‡æ–°èµ·socketæœåŠ¡</span></span><br><span class="line"><span class="keyword">const</span> io = <span class="built_in">require</span>(<span class="string">'socket.io'</span>)(&#123;</span><br><span class="line">  path: <span class="string">'/mypath'</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>



<h2 id="middleware-ä¸­é—´ä»¶"><a href="#middleware-ä¸­é—´ä»¶" class="headerlink" title="middleware ä¸­é—´ä»¶"></a>middleware ä¸­é—´ä»¶</h2><p><strong>socket.io</strong> çš„ä¸­é—´ä»¶ å’Œ kao2 çš„éå¸¸ç›¸ä¼¼ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥åœ¨å˜åŠ¨å¾ˆå°çš„æƒ…å†µä¸‹ï¼Œå°†koa2çš„ä¸­é—´ä»¶æ”¹é€ ä¸º <strong>socket.io</strong> æ‰€ç”¨ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> mypath = io.of(<span class="string">'/mypath'</span>).on(<span class="string">'connection'</span>, socket =&gt; &#123;</span><br><span class="line">    socket.on(<span class="string">'message'</span>, data =&gt; &#123;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//ä¸­é—´ä»¶</span></span><br><span class="line"><span class="keyword">const</span> auth = <span class="function">(<span class="params">socket, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> data = socket.request;</span><br><span class="line">  <span class="keyword">if</span>(!verify(data))&#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'not verify'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  next();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// mypath è¿™ä¸ª namespace æ³¨å†Œä¸­é—´ä»¶</span></span><br><span class="line">mypath.use(auth);</span><br></pre></td></tr></table></figure>



<h2 id="rooms"><a href="#rooms" class="headerlink" title="rooms"></a>rooms</h2><p>æ¯ä¸€ä¸ªsocketè¿æ¥éƒ½ä¼šæœ‰ä¸€ä¸ªç‹¬ä¸€æ— äºŒçš„æ ‡å¿—ï¼Œé‚£å°±æ˜¯ socket.idï¼Œæˆ‘ä»¬å°±æ˜¯é€šè¿‡idæ¥åŒºåˆ†ä¸åŒè¿æ¥çš„ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œsocket.id æœ¬èº«ä¹Ÿæ˜¯æˆ¿é—´ <strong>room</strong> çš„æ ‡å¿—ï¼Œé€šä¿—è®²ï¼Œæ¯ä¸ªsocket è¿æ¥è‡ªèº«éƒ½æ‹¥æœ‰ä¸€é—´æˆ¿ <strong>room</strong>ã€‚é‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥ç»™è¿™ä¸ª <strong>room</strong> å‘é€æ¶ˆæ¯ï¼Œè¿˜æœ‰å¦‚æœä½ åŠ å…¥äº†æˆ¿é—´ï¼Œå°±èƒ½æ¥å—åˆ°æˆ¿é—´é‡Œçš„å¹¿æ’­ä¿¡æ¯ã€‚å½“ç„¶ä½ å¯ä»¥è‡ªå®šä¹‰ <strong>room</strong> ï¼Œè®©socketè¿æ¥åŠ å…¥æˆ–ç¦»å¼€ã€‚è¿˜æœ‰å¦‚æœ socket æ–­å¼€è¿æ¥ï¼Œä¹Ÿå°±æ˜¯ disconnect åï¼Œå®ƒä¼šè¢«è‡ªåŠ¨ç§»å‡ºroomã€‚</p>
<p>è€Œè¿™å°±æ˜¯å®ç° <em>å•ç‹¬èŠå¤©</em> å’Œ <em>ç¾¤ç»„èŠå¤©</em> çš„åŸºç¡€ï¼Œæ¥çœ‹ä¸€ä¸‹å¯¹åº”çš„apiã€‚</p>
<ul>
<li><strong>socket.join(rooms[, callback])</strong>ï¼šåŠ å…¥æˆ¿é—´</li>
<li><strong>socket.leave(room[, callback])</strong> ï¼šç¦»å¼€æˆ¿é—´</li>
<li><strong>socket.to(room)</strong>ï¼š ç»™æˆ¿é—´å‘é€æ¶ˆæ¯</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// è‡ªå®šä¹‰room</span></span><br><span class="line">io.on(<span class="string">'connection'</span>, socket =&gt;&#123;    </span><br><span class="line">  socket.join(<span class="string">'some room'</span>)); <span class="comment">// åŠ å…¥æˆ¿é—´</span></span><br><span class="line">  socket.leave(<span class="string">'some room'</span>); <span class="comment">// ç¦»å¼€æˆ¿é—´</span></span><br><span class="line">&#125;); </span><br><span class="line"></span><br><span class="line"><span class="comment">// å‘æˆ¿é—´é‡Œçš„æ‰€æœ‰å®¢æˆ·ç«¯å‘é€æ¶ˆæ¯</span></span><br><span class="line">io.to(<span class="string">'some room'</span>).emit(<span class="string">'some event'</span>); </span><br><span class="line"></span><br><span class="line"><span class="comment">// é»˜è®¤æˆ¿é—´ï¼ˆæ¯ä¸€ä¸ªidä¸€ä¸ªroomï¼‰</span></span><br><span class="line">socket.on(<span class="string">'say to someone'</span>, (id, msg) =&gt; &#123;    </span><br><span class="line">	socket.broadcast.to(id).emit(<span class="string">'my message'</span>, msg); </span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>



<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>ç›¸ä¿¡æœ‰äº†ä»¥ä¸Šä»‹ç»çš„åŸºç¡€çŸ¥è¯†ï¼Œå†åŠ ä¸Šå®˜ç½‘å¯¹åº”çš„æ–‡æ¡£ï¼Œè¦å¼€å‘èŠå¤©å®¤æˆ–è€…å…¶ä»– å®æ—¶é€šä¿¡ çš„é¡¹ç›®ï¼Œæ˜¯ä¸€ä»¶æ˜“å¦‚åæŒçš„äº‹æƒ…</p>
<p><em><a href="https://socket.io/" target="_blank" rel="noopener">socket.ioå®˜ç½‘</a></em> é‡Œé¢æœ‰å¯¹ api éå¸¸è¯¦ç»†çš„è®²è§£å’Œç”¨ä¾‹ã€‚</p>
</div>
    	
		<div class="post-footer">
			<div class="tags">
				<i class="icon-tags"></i> 
				
					
					
						
							<a href="/blog/tags/%E5%89%8D%E7%AB%AF/">å‰ç«¯</a>
						
					
						
							<a href="/blog/tags/js/">js</a>
						
					
						
							<a href="/blog/tags/socket-io/">socket.io</a>
						
					
				
			</div>
			<a class="share" href="javascript:;" data-url="/blog/2019/03/29/socketio/" data-desc="è¿™æ®µæ—¶é—´å­¦ä¹ äº†socket.ioï¼Œç”¨å®ƒå†™äº†å°é¡¹ç›®ï¼Œåœ¨æ­¤æ€»ç»“ä¸‹å®ƒçš„åŸºæœ¬ä½¿ç”¨æ–¹å¼å’Œä¸€äº›è¦ç‚¹ã€‚soc..." data-type="share" title="share"><i class="icon-share"></i></a>
		</div>
	</div>
</article>
</div>
<nav class="pagination clearfix">
  
    
      
        <a href="/blog/2019/04/08/fullstack/" class="prev post-prev"> <i class="icon-leftarrow"></i> koa+mysql+vue+soc...</a>
      

      
        <a href="/blog/2019/02/04/reacthooks/" class="next post-next"> åŸºäºWebpack 4 å’Œ Rea... <i class="icon-rightarrow"></i></a>
      
    
  
</nav>

<div class="wxshare-popup">
    <a class="close" href="javascript:;"></a>
    <p>æ‰«ä¸€æ‰«ï¼Œåˆ†äº«åˆ°å¾®ä¿¡</p>
    <div id="qrcode" class="wx-qrcode"></div>
</div>

    
    <footer class="footer">
<p class="theme">
	Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/edwardzhong/simply.git" target="_blank" rel="noopener">simply</a>
</p>
<p class="copy">Copyright &copy; 2025 Jeff Zhong</p>
</footer>
    <div class="top-bottom">
      <div class="to-top hide" title="to top"><i class="icon-up"></i></div>
      <div class="to-bottom hide" title="to bottom"><i class="icon-down"></i></div>
    </div>
    </div>

  </div>
<input type="hidden" name="isPost" id="isPost" value="true">
<i id="barBtn" class="icon icon-menu"></i>
<div id="payMe" class="payme">
    <i class="icon icon-cancel"></i>
    <p class="pay-title">ç»™æˆ‘çš„æ—©é¤åŠ ä¸ªè›‹å§ ğŸ˜Š</p>
    <div>
      <img src="/images/weixinpay.jpg" alt="weixinpay">
      <img src="/images/alipay.jpg" alt="alipay" style="display:none;">
    </div>
    <div class="pay-selects">
        <input type="radio" name="pay" id="weixinpay" checked="checked"><label for="weixinpay"> å¾®ä¿¡ </label>&nbsp;&nbsp;
        <input type="radio" name="pay" id="alipay"><label for="alipay"> æ”¯ä»˜å® </label>
    </div>
</div>

  
  
    <script src="/blog/lib/jquery-2.2.3.min.js"></script>
  
    <script src="/blog/lib/qrcode.min.js"></script>
  
    <script src="/blog/js/index.js"></script>
  

<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>

</body>
</html>
