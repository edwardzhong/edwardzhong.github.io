<!doctype html>
<html lang="zh-CN">









<head>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
  <!-- ä¼˜å…ˆä½¿ç”¨ IE æœ€æ–°ç‰ˆæœ¬å’Œ Chrome -->
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
  <!-- ä¸ºç§»åŠ¨è®¾å¤‡æ·»åŠ  viewport -->
  <meta name="viewport" content="width=device-width,initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no">
  <!-- æ·»åŠ åˆ°ä¸»å±åçš„æ ‡é¢˜ï¼ˆiOS 6 æ–°å¢ï¼‰ -->
  <meta name="apple-mobile-web-app-title" content="åŸºäºWebpack 4 å’Œ React hooks æ­å»ºé¡¹ç›® - Jeff's world">
  <!-- æ˜¯å¦å¯ç”¨ WebApp å…¨å±æ¨¡å¼ï¼Œåˆ é™¤è‹¹æœé»˜è®¤çš„å·¥å…·æ å’Œèœå•æ  -->
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <!-- è®¾ç½®è‹¹æœå·¥å…·æ é¢œè‰² -->
  <meta name="apple-mobile-web-app-status-bar-style" content = "black" />
  <!-- æ·»åŠ æ™ºèƒ½ App å¹¿å‘Šæ¡ Smart App Bannerï¼ˆiOS 6+ Safariï¼‰ -->
  <!-- <meta name = "apple-itunes-app" content = "app-id=myAppStoreID, affiliate-data=myAffiliateData, app-argument=myURL"> -->
  <!-- å¿½ç•¥é¡µé¢ä¸­çš„æ•°å­—è¯†åˆ«ä¸ºç”µè¯ï¼Œå¿½ç•¥emailè¯†åˆ« -->
  <meta name="format-detection" content = "telphone=no, email=no" />
  <!--ä¸‹é¢ä¸‰ä¸ªæ˜¯æ¸…é™¤ç¼“å­˜ å¾®ä¿¡æµè§ˆå™¨ç¼“å­˜ä¸¥é‡åˆæ— åˆ·æ–°ï¼›è¿™ä¸ªæ–¹æ³•è°ƒè¯•çš„æ—¶å€™å¾ˆæ–¹ä¾¿-->
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Cache-Control" content="no-cache">
  <meta http-equiv="Expires" content="0">
  
  <link rel="dns-prefetch" href="https://jeff_zhong.gitee.io/blog">
  <link rel="icon shortcut" type="image/ico" href="/favicon.ico">
  <meta name="author" content="Jeff Zhong">
  <meta name="description" content="it's a blog by hexo">
  <meta name="keywords" content="hexo theme">
  <title >åŸºäºWebpack 4 å’Œ React hooks æ­å»ºé¡¹ç›® - Jeff's world</title>
    <!-- The Open Graph protocol -->
  <meta property="og:url" content="https://jeff_zhong.gitee.io/blog">
  <meta property="og:type" content="blog">
  <meta property="og:title" content="åŸºäºWebpack 4 å’Œ React hooks æ­å»ºé¡¹ç›® - Jeff's world">
  <meta property="og:description" content="it's a blog by hexo">
  
    
    
      <link rel="stylesheet" href="/lib/fontello/fontello.css">
    
      <link rel="stylesheet" href="/lib/reboto/roboto.css">
    
      <link rel="stylesheet" href="/css/index.css">
    
  
  <script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?5255e97b442092b8e1a219e6a48a0d42";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>

<meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/atom.xml" title="Jeff's world" type="application/atom+xml">
</head>
<body>
<header class="header">
  <div class="top"></div>
  <h2>Jeff's World</h2>
  <h3>Things that I'm interested in</h3>
  <div class="menu">
  
  
  
      <a  href="/" title="ä¸» é¡µ">
        <i class="icon-home"></i>
        <span>ä¸» é¡µ</span>
      </a>
  
      <a  href="https://jeff_zhong.gitee.io/demo/" title="Demo">
        <i class="icon-page"></i>
        <span>Demo</span>
      </a>
  
      <a  data-tag="search"  href="javascript:;" title="æœ ç´¢">
        <i class="icon-search"></i>
        <span>æœ ç´¢</span>
      </a>
  
  </div>
  <div class="state">
  
    <a href="/archives">53<br>æ–‡ ç« </a><a href="/categories">2<br>åˆ† ç±»</a><a href="/tags">70<br>æ ‡ ç­¾</a>
  </div>
  <div class="social">
  
  
  
      <a href="https://github.com/edwardzhong" target="_blank" rel="noopener" title="Github"><i class="icon-github"></i></a>
  
      <a href="https://x.com/jeff_zhong3" target="_blank" rel="noopener" title="X"><i class="icon-twitter"></i></a>
  
      <a href="https://www.facebook.com/jianfeng.edward" target="_blank" rel="noopener" title="Facebook"><i class="icon-facebook"></i></a>
  
      <a href="http://weibo.com/1593251850" target="_blank" rel="noopener" title="Weibo"><i class="icon-weibo"></i></a>
  
      <a href="/atom.xml" title="Rss"><i class="icon-rss"></i></a>
  
  </div>
  <div id="payBtn" class="pay-icon" title="è°¢è°¢æ‚¨çš„èµèµ">èµ</div>
</header>
  <div class="container">
    <div class="main">
    
        
<div class="post-list">
	<article class="post" style="animation:listshow 0.6s ease-out both 0.30000000000000004s">
    
    
        
    
	
	<a href="javascript:;">
        <div class="post-banner" style="background: url(/blog/images/banner8.jpg)  center top / 100% no-repeat">
    		<h3 class="post-title">åŸºäºWebpack 4 å’Œ React hooks æ­å»ºé¡¹ç›®</h3>
    	</div>
	</a>
	<div class="post-inner">
	
    	<div class="post-info">
    		<time><i class="icon-calendar"></i> 2019/02/04 13:58:00</time>
    		<span class="category">
    		
    			
    			<i class="icon-book"></i>
    			
                    
                        <a href="/categories/%E6%8A%80%E6%9C%AF/">æŠ€æœ¯</a>
                    
    			
    		
    		</span>
    	</div>
    	<!-- <p><p>é¢å¯¹æ—¥æ–°æœˆå¼‚çš„å‰ç«¯ï¼Œæˆ‘è¡¨ç¤ºå¿«å­¦ä¸åŠ¨äº†ğŸ˜‚ã€‚ Webpack è€æ—©å°±å·²ç»æ›´æ–°åˆ°äº† V4.xï¼Œå‰æ®µæ—¶é—´ React åˆæ¨å‡ºäº†  hooks APIã€‚åˆšå¥½æ˜¥èŠ‚åœ¨å®¶é‡Œä¼‘å‡ï¼Œæ—¶é—´æ¯”è¾ƒç©ºé—²ï¼Œè¿˜æ˜¯èµ¶ç´§æŠŠ Reâ€¦</p>
</p> -->
    	
    		<div class="post-content"><p>é¢å¯¹æ—¥æ–°æœˆå¼‚çš„å‰ç«¯ï¼Œæˆ‘è¡¨ç¤ºå¿«å­¦ä¸åŠ¨äº†ğŸ˜‚ã€‚ <strong>Webpack</strong> è€æ—©å°±å·²ç»æ›´æ–°åˆ°äº† V4.xï¼Œå‰æ®µæ—¶é—´ <strong>React</strong> åˆæ¨å‡ºäº†  <strong>hooks</strong> APIã€‚åˆšå¥½æ˜¥èŠ‚åœ¨å®¶é‡Œä¼‘å‡ï¼Œæ—¶é—´æ¯”è¾ƒç©ºé—²ï¼Œè¿˜æ˜¯èµ¶ç´§æŠŠ <strong>React</strong>æŠ€æœ¯æ ˆè¿™å—è¡¥ä¸Šã€‚</p>
<p>ç½‘ä¸Šæœ‰å¾ˆå¤šä»‹ç» <strong>hooks</strong> çŸ¥è¯†ç‚¹çš„æ–‡ç« ï¼Œä½†éƒ½æ¯”è¾ƒé›¶ç¢ï¼ŒåŸºæœ¬åªèƒ½å†™ä¸€äº›å° <strong>Demo</strong>ã€‚è¿˜æ²¡æœ‰æ¯”è¾ƒç³»ç»Ÿçš„ï¼Œå…¨æ–°çš„åŸºäº <strong>hooks</strong> è¿›è¡Œæ­å»ºå®é™…é¡¹ç›®çš„è®²è§£ã€‚æ‰€ä»¥è¿™é‡Œå°±ä»å¼€å‘å®é™…é¡¹ç›®çš„è§’åº¦ï¼Œæ­å»ºèµ·å•é¡µé¢ <strong>Web App</strong>é¡¹ç›®çš„åŸºæœ¬è„šæ‰‹æ¶ï¼Œå¹¶åŸºäº <strong>hooks</strong> API å®ç°ä¸€ä¸ª <strong>react</strong> é¡¹ç›®æ¨¡ç‰ˆã€‚</p>
<p> <strong>Hooks</strong> æœ€å¸å¼•äººçš„åœ°æ–¹å°±æ˜¯ç”¨ <strong>å‡½æ•°å¼ç»„ä»¶</strong> ä»£æ›¿é¢å‘å¯¹è±¡çš„ <strong>ç±»ç»„ä»¶</strong>ã€‚æ­¤å‰çš„ <strong>react</strong> å¦‚æœæ¶‰åŠåˆ°çŠ¶æ€ï¼Œè§£å†³æ–¹æ¡ˆé€šå¸¸åªèƒ½ä½¿ç”¨ <strong>ç±»ç»„ä»¶</strong>ï¼Œä¸šåŠ¡é€»è¾‘ä¸€å¤æ‚å°±å®¹æ˜“å¯¼è‡´ç»„ä»¶è‡ƒè‚¿ï¼Œæ¨¡å—çš„è§£è—•ä¹Ÿæ˜¯ä¸ªé—®é¢˜ã€‚è€Œä½¿ç”¨åŸºäº <strong>hooks</strong> çš„ <strong>å‡½æ•°ç»„ä»¶</strong> åï¼Œä»£ç ä¸ä»…æ›´åŠ ç®€æ´ï¼Œå†™èµ·æ¥æ›´çˆ½ï¼Œè€Œä¸”æ¨¡å—å¤ç”¨ä¹Ÿæ–¹ä¾¿å¾—å¤šï¼Œéå¸¸çœ‹å¥½å®ƒçš„æœªæ¥ã€‚</p>
<a id="more"></a>

<h2 id="webpack-4-çš„é…ç½®"><a href="#webpack-4-çš„é…ç½®" class="headerlink" title="webpack 4 çš„é…ç½®"></a>webpack 4 çš„é…ç½®</h2><p>æ²¡æœ‰ä½¿ç”¨ <strong>create-react-app</strong> è¿™ä¸ªè„šæ‰‹æ¶ï¼Œè€Œæ˜¯ä»å¤´å¼€å§‹é…ç½®å¼€å‘ç¯å¢ƒï¼Œå› ä¸ºè¿™æ ·è‡ªå®šä¹‰é…ç½®æŸäº›åŠŸèƒ½ä¼šæ›´æ–¹ä¾¿äº›ã€‚ä¸‹é¢è¿™ä¸ªæ˜¯é€šç”¨çš„é…ç½® <strong>webpack.common.js</strong> æ–‡ä»¶ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; resolve &#125; = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">'html-webpack-plugin'</span>);</span><br><span class="line"><span class="keyword">const</span> CleanWebpackPlugin = <span class="built_in">require</span>(<span class="string">'clean-webpack-plugin'</span>);</span><br><span class="line"><span class="keyword">const</span> &#123; HotModuleReplacementPlugin &#125; = <span class="built_in">require</span>(<span class="string">'webpack'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    entry: <span class="string">'./src/index.js'</span>,<span class="comment">//å•å…¥å£</span></span><br><span class="line">    output: &#123;</span><br><span class="line">        path: resolve(__dirname, <span class="string">'dist'</span>),</span><br><span class="line">        filename: <span class="string">'[name].[hash].js'</span><span class="comment">//è¾“å‡ºæ–‡ä»¶æ·»åŠ hash</span></span><br><span class="line">    &#125;,</span><br><span class="line">    optimization: &#123; <span class="comment">// ä»£æ›¿commonchunk, ä»£ç åˆ†å‰²</span></span><br><span class="line">        runtimeChunk: <span class="string">'single'</span>,</span><br><span class="line">        splitChunks: &#123;</span><br><span class="line">            cacheGroups: &#123;</span><br><span class="line">                vendor: &#123;</span><br><span class="line">                    test: <span class="regexp">/[\\/]node_modules[\\/]/</span>,</span><br><span class="line">                    name: <span class="string">'vendors'</span>,</span><br><span class="line">                    chunks: <span class="string">'all'</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="built_in">module</span>: &#123;</span><br><span class="line">        rules: [</span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/\.jsx?$/</span>,</span><br><span class="line">                exclude: <span class="regexp">/node_modules/</span>,</span><br><span class="line">                use: [<span class="string">'babel-loader'</span>]</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/\.css$/</span>,</span><br><span class="line">                use: [<span class="string">'style-loader'</span>, <span class="string">'css-loader'</span>]</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/\.scss$/</span>,</span><br><span class="line">                use: [<span class="string">'style-loader'</span>,</span><br><span class="line">                    &#123;</span><br><span class="line">                        loader: <span class="string">'css-loader'</span>,</span><br><span class="line">                        options: &#123;</span><br><span class="line">                            importLoaders: <span class="number">1</span>,</span><br><span class="line">                            modules: <span class="literal">true</span>,<span class="comment">//css modules</span></span><br><span class="line">                            localIdentName: <span class="string">'[name]___[local]___[hash:base64:5]'</span></span><br><span class="line">                        &#125;,</span><br><span class="line">                    &#125;,</span><br><span class="line">                    <span class="string">'postcss-loader'</span>, <span class="string">'sass-loader'</span>]</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;   <span class="comment">/* </span></span><br><span class="line"><span class="comment">                å½“æ–‡ä»¶ä½“ç§¯å°äº limit æ—¶ï¼Œurl-loader æŠŠæ–‡ä»¶è½¬ä¸º Data URI çš„æ ¼å¼å†…è”åˆ°å¼•ç”¨çš„åœ°æ–¹</span></span><br><span class="line"><span class="comment">                å½“æ–‡ä»¶å¤§äº limit æ—¶ï¼Œurl-loader ä¼šè°ƒç”¨ file-loader, æŠŠæ–‡ä»¶å‚¨å­˜åˆ°è¾“å‡ºç›®å½•ï¼Œå¹¶æŠŠå¼•ç”¨çš„æ–‡ä»¶è·¯å¾„æ”¹å†™æˆè¾“å‡ºåçš„è·¯å¾„ </span></span><br><span class="line"><span class="comment">                */</span></span><br><span class="line">                test: <span class="regexp">/\.(png|jpg|jpeg|gif|eot|ttf|woff|woff2|svg|svgz)(\?.+)?$/</span>,</span><br><span class="line">                use: [&#123;</span><br><span class="line">                    loader: <span class="string">'url-loader'</span>,</span><br><span class="line">                    options: &#123;</span><br><span class="line">                        limit: <span class="number">1000</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;]</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    plugins: [</span><br><span class="line">        <span class="keyword">new</span> CleanWebpackPlugin([<span class="string">'dist'</span>]),<span class="comment">//ç”Ÿæˆæ–°æ–‡ä»¶æ—¶ï¼Œæ¸…ç©ºç”Ÿå‡ºç›®å½•</span></span><br><span class="line">        <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">            template: <span class="string">'./public/index.html'</span>,<span class="comment">//æ¨¡ç‰ˆè·¯å¾„</span></span><br><span class="line">            favicon: <span class="string">'./public/favicon.png'</span>,</span><br><span class="line">            minify: &#123; <span class="comment">//å‹ç¼©</span></span><br><span class="line">                removeAttributeQuotes:<span class="literal">true</span>,</span><br><span class="line">                removeComments: <span class="literal">true</span>,</span><br><span class="line">                collapseWhitespace: <span class="literal">true</span>,</span><br><span class="line">                removeScriptTypeAttributes:<span class="literal">true</span>,</span><br><span class="line">                removeStyleLinkTypeAttributes:<span class="literal">true</span></span><br><span class="line">             &#125;,</span><br><span class="line">        &#125;),</span><br><span class="line">        <span class="keyword">new</span> HotModuleReplacementPlugin()<span class="comment">//HMR</span></span><br><span class="line">    ]</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>æ¥ç€åŸºäº <strong>webpack.common.js</strong> æ–‡ä»¶ï¼Œé…ç½®å‡ºå¼€å‘ç¯å¢ƒçš„ <strong>webpack.dev.js</strong> æ–‡ä»¶ï¼Œä¸»è¦å°±æ˜¯å¯åŠ¨å¼€å‘æœåŠ¡å™¨ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> merge = <span class="built_in">require</span>(<span class="string">'webpack-merge'</span>);</span><br><span class="line"><span class="keyword">const</span> common = <span class="built_in">require</span>(<span class="string">'./webpack.common.js'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = merge(common, &#123;</span><br><span class="line">    mode: <span class="string">'development'</span>,</span><br><span class="line">    devtool: <span class="string">'inline-source-map'</span>,</span><br><span class="line">    devServer: &#123;</span><br><span class="line">        contentBase: <span class="string">'./dist'</span>,</span><br><span class="line">        port: <span class="number">4001</span>,</span><br><span class="line">        hot: <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>ç”Ÿæˆæ¨¡å¼çš„ <strong>webpack.prod.js</strong> æ–‡ä»¶ï¼Œåªè¦å®šä¹‰äº† <strong>mode:â€™productionâ€™</strong>ï¼Œ <strong>webpack 4</strong> æ‰“åŒ…æ—¶å°±ä¼šè‡ªåŠ¨å‹ç¼©ä¼˜åŒ–ä»£ç ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> merge = <span class="built_in">require</span>(<span class="string">'webpack-merge'</span>);</span><br><span class="line"><span class="keyword">const</span> common = <span class="built_in">require</span>(<span class="string">'./webpack.common.js'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = merge(common, &#123;</span><br><span class="line">  mode: <span class="string">'production'</span>,</span><br><span class="line">  devtool: <span class="string">'source-map'</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>é…ç½® <strong>package.js</strong> ä¸­çš„ <strong>scripts</strong></p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"scripts"</span>: &#123;</span><br><span class="line">     <span class="attr">"start"</span>: <span class="string">"webpack-dev-server --open --config webpack.dev.js"</span>,</span><br><span class="line">     <span class="attr">"build"</span>: <span class="string">"webpack --config webpack.prod.js"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Babel-çš„é…ç½®"><a href="#Babel-çš„é…ç½®" class="headerlink" title="Babel çš„é…ç½®"></a>Babel çš„é…ç½®</h2><p> <strong>babel</strong> çš„ <strong>.babelrc</strong> æ–‡ä»¶ï¼Œ <strong>css module</strong> åŒ…è¿™é‡Œæ¨è *<a href="https://github.com/gajus/babel-plugin-react-css-modules" target="_blank" rel="noopener">babel-plugin-react-css-modules</a><em>ã€‚<br> *</em>react-css-modules** æ—¢æ”¯æŒå…¨å±€çš„css(é»˜è®¤ <strong>className</strong> å±æ€§)ï¼ŒåŒæ—¶ä¹Ÿæ”¯æŒå±€éƒ¨css module( <strong>styleName</strong> å±æ€§)ï¼Œè¿˜æ”¯æŒcssé¢„ç¼–è¯‘å™¨ï¼Œè¿™é‡Œä½¿ç”¨çš„æ˜¯ <strong>scss</strong>ã€‚</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"presets"</span>: [</span><br><span class="line">        <span class="string">"@babel/preset-env"</span>,</span><br><span class="line">        <span class="string">"@babel/preset-react"</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">"plugins"</span>: [</span><br><span class="line">        <span class="string">"@babel/plugin-proposal-class-properties"</span>,</span><br><span class="line">        <span class="string">"@babel/plugin-transform-runtime"</span>,</span><br><span class="line">        [</span><br><span class="line">            <span class="string">"react-css-modules"</span>,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">"exclude"</span>: <span class="string">"node_modules"</span>,</span><br><span class="line">                <span class="attr">"filetypes"</span>: &#123;</span><br><span class="line">                    <span class="attr">".scss"</span>: &#123;</span><br><span class="line">                        <span class="attr">"syntax"</span>: <span class="string">"postcss-scss"</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="attr">"generateScopedName"</span>: <span class="string">"[name]___[local]___[hash:base64:5]"</span></span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="React-é¡¹ç›®"><a href="#React-é¡¹ç›®" class="headerlink" title="React é¡¹ç›®"></a>React é¡¹ç›®</h2><p>ä¸‹é¢æ˜¯é¡¹ç›®åŸºæœ¬çš„ç›®å½•æ ‘ç»“æ„ï¼Œæ¥ç€ä»å…¥å£å¼€å§‹ä¸€æ­¥æ­¥ç»†åŒ–æ•´ä¸ªé¡¹ç›®ã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">â”œ package.json</span><br><span class="line">â”œ src</span><br><span class="line">â”‚ â”œ component // ç»„ä»¶ç›®å½•</span><br><span class="line">â”‚ â”œ reducer   // reducerç›®å½•</span><br><span class="line">â”‚ â”œ action.js</span><br><span class="line">â”‚ â”œ constants.js</span><br><span class="line">â”‚ â”œ context.js</span><br><span class="line">â”‚ â”” index.js</span><br><span class="line">â”œ public // é™æ€æ–‡ä»¶ç›®å½•</span><br><span class="line">â”‚ â”œ css</span><br><span class="line">â”‚ â”” index.html</span><br><span class="line">â”œ .babelrc</span><br><span class="line">â”œ webpack.common.js</span><br><span class="line">â”œ webpack.dev.js</span><br><span class="line">â”” webpack.prod.js</span><br></pre></td></tr></table></figure>

<p>çŠ¶æ€ç®¡ç†ç»„ä»¶ä½¿ç”¨ <strong>redux</strong>ï¼Œ <strong>react-router</strong> ç”¨äºæ„å»ºå•é¡µé¢çš„é¡¹ç›®ï¼Œå› ä¸ºä½¿ç”¨äº† <strong>hooks</strong> APIï¼Œæ‰€ä»¥ä¸å†éœ€è¦ <strong>react-redux</strong> è¿æ¥çŠ¶æ€ <strong>state</strong>ã€‚ </p>
<p>å…¥å£æ–‡ä»¶ <strong>index.js</strong></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// index.js</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; useReducer &#125; <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> &#123; render &#125; <span class="keyword">from</span> <span class="string">'react-dom'</span></span><br><span class="line"><span class="keyword">import</span> &#123; HashRouter <span class="keyword">as</span> Router, Route, Redirect, Switch &#125; <span class="keyword">from</span> <span class="string">'react-router-dom'</span></span><br><span class="line"><span class="keyword">import</span> Context <span class="keyword">from</span> <span class="string">'./context.js'</span></span><br><span class="line"><span class="keyword">import</span> Home <span class="keyword">from</span> <span class="string">'./component/home.js'</span></span><br><span class="line"><span class="keyword">import</span> List <span class="keyword">from</span> <span class="string">'./component/list.js'</span></span><br><span class="line"><span class="keyword">import</span> rootReducer <span class="keyword">from</span> <span class="string">'./reducer'</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">'../public/css/index.css'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Root = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> initState = &#123;</span><br><span class="line">        list: [</span><br><span class="line">            &#123; <span class="attr">id</span>: <span class="number">0</span>, <span class="attr">txt</span>: <span class="string">'webpack 4'</span> &#125;,</span><br><span class="line">            &#123; <span class="attr">id</span>: <span class="number">1</span>, <span class="attr">txt</span>: <span class="string">'react'</span> &#125;,</span><br><span class="line">            &#123; <span class="attr">id</span>: <span class="number">2</span>, <span class="attr">txt</span>: <span class="string">'redux'</span> &#125;,</span><br><span class="line">        ]</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="comment">// useReduceræ˜ å°„å‡ºstateï¼Œdispatch</span></span><br><span class="line">    <span class="keyword">const</span> [state, dispatch] = useReducer(rootReducer, initState);</span><br><span class="line">    <span class="comment">// &lt;Context.Provider value=&#123;&#123; state, dispatch &#125;&#125;&gt; åŸºæœ¬ä»£æ›¿äº† react-redux çš„ &lt;Provider store=&#123;store&#125;&gt;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">Context.Provider</span> <span class="attr">value</span>=<span class="string">&#123;&#123;</span> <span class="attr">state</span>, <span class="attr">dispatch</span> &#125;&#125;&gt;</span></span></span><br><span class="line">        &lt;Router&gt;</span><br><span class="line">            &lt;Switch&gt;</span><br><span class="line">                &lt;Route exact path="/" component=&#123;Home&#125; /&gt;</span><br><span class="line">                &lt;Route exact path="/list" component=&#123;List&#125; /&gt;</span><br><span class="line">                &lt;Route render=&#123;() =&gt; (&lt;Redirect to="/" /&gt;)&#125; /&gt;</span><br><span class="line">            &lt;/Switch&gt;</span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">Router</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">Context.Provider</span>&gt;</span></span></span><br><span class="line">&#125;</span><br><span class="line">render(</span><br><span class="line">    &lt;Root /&gt;,</span><br><span class="line">    <span class="built_in">document</span>.getElementById(<span class="string">'root'</span>)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p> <strong>constants.js</strong> ï¼Œ <strong>action.js</strong> å’Œ <strong>reducer.js</strong> ä¸ä¹‹å‰çš„å†™æ³•æ˜¯ä¸€è‡´çš„ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// constants.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> ADD_COMMENT = <span class="string">'ADD_COMMENT'</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> REMOVE_COMMENT = <span class="string">'REMOVE_COMMENT'</span></span><br></pre></td></tr></table></figure>

<p><strong>action.js</strong></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// action.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; ADD_COMMENT, REMOVE_COMMENT &#125; <span class="keyword">from</span> <span class="string">'./constants'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">addComment</span>(<span class="params">comment</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    type: ADD_COMMENT,</span><br><span class="line">    comment</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">removeComment</span>(<span class="params">id</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    type: REMOVE_COMMENT,</span><br><span class="line">    id</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>list.js</strong></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//list.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; ADD_COMMENT, REMOVE_COMMENT &#125; <span class="keyword">from</span> <span class="string">'../constants.js'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> list = <span class="function">(<span class="params">state = [], payload</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">switch</span> (payload.type) &#123;</span><br><span class="line">        <span class="keyword">case</span> ADD_COMMENT:</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">Array</span>.isArray(payload.comment)) &#123;</span><br><span class="line">                <span class="keyword">return</span> [...state, ...payload.comment];</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> [...state, payload.comment];</span><br><span class="line">            &#125;</span><br><span class="line">        <span class="keyword">case</span> REMOVE_COMMENT:</span><br><span class="line">            <span class="keyword">return</span> state.filter(<span class="function"><span class="params">i</span> =&gt;</span> i.id != payload.id);</span><br><span class="line">        <span class="keyword">default</span>: <span class="keyword">return</span> state;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> list</span><br></pre></td></tr></table></figure>

<p><strong>reducer.js</strong></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//reducer.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; combineReducers &#125; <span class="keyword">from</span> <span class="string">'redux'</span></span><br><span class="line"><span class="keyword">import</span> list <span class="keyword">from</span> <span class="string">'./list.js'</span></span><br><span class="line"><span class="keyword">import</span> user <span class="keyword">from</span> <span class="string">'./user.js'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> rootReducer = combineReducers(&#123;</span><br><span class="line">  list,</span><br><span class="line">  user</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> rootReducer</span><br></pre></td></tr></table></figure>

<p>æœ€å¤§åŒºåˆ«çš„åœ°æ–¹å°±æ˜¯ <strong>component</strong> ç»„ä»¶ï¼ŒåŸºäº <strong>å‡½æ•°å¼</strong>ï¼Œå†…éƒ¨çš„è¡¨è¾¾å¼å°±åƒæ˜¯å³æ’å³ç”¨çš„æ’æ§½ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿çš„æŠ½å–å‡ºé€šç”¨çš„ç»„ä»¶ï¼Œç„¶åä»å¤–éƒ¨å¼•ç”¨ã€‚ç›¸æ¯”ä¹‹å‰çš„ <strong>é¢å‘å¯¹è±¡</strong> æ–¹å¼ï¼Œæˆ‘è§‰å¾— <strong>å‡½æ•°è¡¨è¾¾å¼</strong> æ›´å—å‰ç«¯å¼€å‘è€…æ¬¢è¿ã€‚</p>
<ul>
<li><p><strong>useContext</strong> è·å–å…¨å±€çš„ <strong>state</strong></p>
</li>
<li><p><strong>useRef</strong> ä»£æ›¿ä¹‹å‰çš„ <strong>ref</strong></p>
</li>
<li><p><strong>useState</strong> ä»£æ›¿ä¹‹å‰çš„ <strong>state</strong></p>
</li>
<li><p><strong>useEffect</strong> åˆ™å¯ä»¥ä»£æ›¿ç”Ÿå‘½å‘¨æœŸé’©å­å‡½æ•° </p>
 <figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//ç›‘æ§æ•°ç»„ä¸­çš„å‚æ•°ï¼Œä¸€æ—¦å˜åŒ–å°±æ‰§è¡Œ</span></span><br><span class="line">useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123; updateData(); &#125;,[id]);</span><br><span class="line"></span><br><span class="line"><span class="comment">//ä¸ä¼ ç¬¬äºŒä¸ªå‚æ•°çš„è¯ï¼Œå®ƒå°±ç­‰ä»·äºæ¯æ¬¡componentDidMountå’ŒcomponentDidUpdateæ—¶æ‰§è¡Œ</span></span><br><span class="line">useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123; updateData(); &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//ç¬¬äºŒä¸ªå‚æ•°ä¼ ç©ºæ•°ç»„ï¼Œç­‰ä»·äºåªåœ¨componentDidMountå’ŒcomponentWillUnMountæ—¶æ‰§è¡Œï¼Œ </span></span><br><span class="line"><span class="comment">//ç¬¬ä¸€ä¸ªå‚æ•°ä¸­çš„è¿”å›å‡½æ•°ç”¨äºæ‰§è¡Œæ¸…ç†åŠŸèƒ½</span></span><br><span class="line">useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123; </span><br><span class="line">    initData(); </span><br><span class="line">    reutrn () =&gt; <span class="built_in">console</span>.log(<span class="string">'componentWillUnMount cleanup...'</span>); </span><br><span class="line">&#125;, []);</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p>æœ€åå°±æ˜¯å®ç°å…·ä½“ç•Œé¢å’Œä¸šåŠ¡é€»è¾‘çš„ç»„ä»¶äº†ï¼Œä¸‹é¢æ˜¯å…¶ä¸­çš„Listç»„ä»¶</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// list.js</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; useRef, useState, useContext &#125; <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> &#123; bindActionCreators &#125; <span class="keyword">from</span> <span class="string">'redux'</span></span><br><span class="line"><span class="keyword">import</span> &#123; Link &#125; <span class="keyword">from</span> <span class="string">'react-router-dom'</span></span><br><span class="line"><span class="keyword">import</span> Context <span class="keyword">from</span> <span class="string">'../context.js'</span></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> actions <span class="keyword">from</span> <span class="string">'../action.js'</span></span><br><span class="line"><span class="keyword">import</span> Dialog <span class="keyword">from</span> <span class="string">'./dialog.js'</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">'./list.scss'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> List = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> ctx = useContext(Context);<span class="comment">//è·å–å…¨å±€çŠ¶æ€state</span></span><br><span class="line">    <span class="keyword">const</span> &#123; user, list &#125; = ctx.state;</span><br><span class="line">    <span class="keyword">const</span> [visible, setVisible] = useState(<span class="literal">false</span>);</span><br><span class="line">    <span class="keyword">const</span> [rid, setRid] = useState(<span class="string">''</span>);</span><br><span class="line">    <span class="keyword">const</span> inputRef = useRef(<span class="literal">null</span>);</span><br><span class="line">    <span class="keyword">const</span> &#123; removeComment, addComment &#125; = bindActionCreators(actions, ctx.dispatch);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> confirmHandle = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        setVisible(<span class="literal">false</span>);</span><br><span class="line">        removeComment(rid);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> cancelHandle = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        setVisible(<span class="literal">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> add = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> input = inputRef.current,</span><br><span class="line">            val = input.value.trim();</span><br><span class="line">        <span class="keyword">if</span> (!val) <span class="keyword">return</span>;</span><br><span class="line">        addComment(&#123;</span><br><span class="line">            id: <span class="built_in">Math</span>.round(<span class="built_in">Math</span>.random() * <span class="number">1000000</span>),</span><br><span class="line">            txt: val</span><br><span class="line">        &#125;);</span><br><span class="line">        input.value = <span class="string">''</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line">        &lt;div styleName="form"&gt;</span><br><span class="line">            &lt;h3 styleName="sub-title"&gt;This is list page&lt;/h3&gt;</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                &lt;p&gt;hello, &#123;user.name&#125; !&lt;/p&gt;</span><br><span class="line">                &lt;p&gt;your email is &#123;user.email&#125; !&lt;/p&gt;</span><br><span class="line">                &lt;p styleName="tip"&gt;please add and remove the list item !!&lt;/p&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">            &lt;ul&gt; &#123;</span><br><span class="line">                list.map(l =&gt; &lt;li key=&#123;l.id&#125;&gt;&#123;l.txt&#125;&lt;i className="icon-minus" title="remove item" onClick=&#123;() =&gt; &#123;</span><br><span class="line">                    setVisible(true);</span><br><span class="line">                    setRid(l.id);</span><br><span class="line">                &#125;&#125;&gt;&lt;/i&gt;&lt;/li&gt;)</span><br><span class="line">            &#125; &lt;/ul&gt;</span><br><span class="line">            &lt;input ref=&#123;inputRef&#125; type="text" /&gt;</span><br><span class="line">            &lt;button onClick=&#123;add&#125; title="add item"&gt;Add Item&lt;/button&gt;</span><br><span class="line">            &lt;Link styleName="link" to="/"&gt;redirect to home&lt;/Link&gt;</span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">Dialog</span> <span class="attr">visible</span>=<span class="string">&#123;visible&#125;</span> <span class="attr">confirm</span>=<span class="string">&#123;confirmHandle&#125;</span> <span class="attr">cancel</span>=<span class="string">&#123;cancelHandle&#125;</span>&gt;</span>remove this item ?<span class="tag">&lt;/<span class="name">Dialog</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> List;</span><br></pre></td></tr></table></figure>

<h2 id="é¡¹ç›®ä»£ç "><a href="#é¡¹ç›®ä»£ç " class="headerlink" title="é¡¹ç›®ä»£ç "></a>é¡¹ç›®ä»£ç </h2><p><em><a href="https://github.com/edwardzhong/webpack_react" target="_blank" rel="noopener">https://github.com/edwardzhong/webpack_react</a></em> </p>
</div>
    	
		<div class="post-footer">
			<div class="tags">
				<i class="icon-tags"></i> 
				
					
					
						
							<a href="/tags/%E5%89%8D%E7%AB%AF/">å‰ç«¯</a>
						
					
						
							<a href="/tags/js/">js</a>
						
					
						
							<a href="/tags/react/">react</a>
						
					
						
							<a href="/tags/webpack/">webpack</a>
						
					
				
			</div>
			<a class="share" href="javascript:;" data-url="/2019/02/04/reacthooks/" data-desc="é¢å¯¹æ—¥æ–°æœˆå¼‚çš„å‰ç«¯ï¼Œæˆ‘è¡¨ç¤ºå¿«å­¦ä¸åŠ¨äº†ğŸ˜‚ã€‚ Webpack è€æ—©å°±å·²ç»æ›´æ–°åˆ°äº† V4.xï¼Œå‰æ®µ..." data-type="share" title="share"><i class="icon-share"></i></a>
		</div>
	</div>
</article>
</div>
<nav class="pagination clearfix">
  
    
      
        <a href="/2019/03/29/socketio/" class="prev post-prev"> <i class="icon-leftarrow"></i> å…³äºsocket.ioçš„ä½¿ç”¨</a>
      

      
        <a href="/2019/01/03/animationfun/" class="next post-next"> åŠ¨ç”»å‡½æ•°çš„ç»˜åˆ¶åŠè‡ªå®šä¹‰åŠ¨ç”»å‡½æ•° <i class="icon-rightarrow"></i></a>
      
    
  
</nav>

<div class="wxshare-popup">
    <a class="close" href="javascript:;"></a>
    <p>æ‰«ä¸€æ‰«ï¼Œåˆ†äº«åˆ°å¾®ä¿¡</p>
    <div id="qrcode" class="wx-qrcode"></div>
</div>

    
    <footer class="footer">
<p class="theme">
	Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/edwardzhong/simply.git" target="_blank" rel="noopener">simply</a>
</p>
<p class="copy">Copyright &copy; 2025 Jeff Zhong</p>
</footer>
    <div class="top-bottom">
      <div class="to-top hide" title="to top"><i class="icon-up"></i></div>
      <div class="to-bottom hide" title="to bottom"><i class="icon-down"></i></div>
    </div>
    </div>

  </div>
<input type="hidden" name="isPost" id="isPost" value="true">
<i id="barBtn" class="icon icon-menu"></i>
<div id="payMe" class="payme">
    <i class="icon icon-cancel"></i>
    <p class="pay-title">ç»™æˆ‘çš„æ—©é¤åŠ ä¸ªè›‹å§ ğŸ˜Š</p>
    <div>
      <img src="/images/weixinpay.jpg" alt="weixinpay">
      <img src="/images/alipay.jpg" alt="alipay" style="display:none;">
    </div>
    <div class="pay-selects">
        <input type="radio" name="pay" id="weixinpay" checked="checked"><label for="weixinpay"> å¾®ä¿¡ </label>&nbsp;&nbsp;
        <input type="radio" name="pay" id="alipay"><label for="alipay"> æ”¯ä»˜å® </label>
    </div>
</div>

  
  
    <script src="/lib/jquery-2.2.3.min.js"></script>
  
    <script src="/lib/qrcode.min.js"></script>
  
    <script src="/js/index.js"></script>
  

<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>

</body>
</html>
