<!doctype html>
<html lang="zh-CN">









<head>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
  <!-- ä¼˜å…ˆä½¿ç”¨ IE æœ€æ–°ç‰ˆæœ¬å’Œ Chrome -->
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
  <!-- ä¸ºç§»åŠ¨è®¾å¤‡æ·»åŠ  viewport -->
  <meta name="viewport" content="width=device-width,initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no">
  <!-- æ·»åŠ åˆ°ä¸»å±åçš„æ ‡é¢˜ï¼ˆiOS 6 æ–°å¢ï¼‰ -->
  <meta name="apple-mobile-web-app-title" content="ä½¿ç”¨typescriptæ”¹é€ koaå¼€å‘æ¡†æ¶ - Jeff's world">
  <!-- æ˜¯å¦å¯ç”¨ WebApp å…¨å±æ¨¡å¼ï¼Œåˆ é™¤è‹¹æœé»˜è®¤çš„å·¥å…·æ å’Œèœå•æ  -->
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <!-- è®¾ç½®è‹¹æœå·¥å…·æ é¢œè‰² -->
  <meta name="apple-mobile-web-app-status-bar-style" content = "black" />
  <!-- æ·»åŠ æ™ºèƒ½ App å¹¿å‘Šæ¡ Smart App Bannerï¼ˆiOS 6+ Safariï¼‰ -->
  <!-- <meta name = "apple-itunes-app" content = "app-id=myAppStoreID, affiliate-data=myAffiliateData, app-argument=myURL"> -->
  <!-- å¿½ç•¥é¡µé¢ä¸­çš„æ•°å­—è¯†åˆ«ä¸ºç”µè¯ï¼Œå¿½ç•¥emailè¯†åˆ« -->
  <meta name="format-detection" content = "telphone=no, email=no" />
  <!--ä¸‹é¢ä¸‰ä¸ªæ˜¯æ¸…é™¤ç¼“å­˜ å¾®ä¿¡æµè§ˆå™¨ç¼“å­˜ä¸¥é‡åˆæ— åˆ·æ–°ï¼›è¿™ä¸ªæ–¹æ³•è°ƒè¯•çš„æ—¶å€™å¾ˆæ–¹ä¾¿-->
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Cache-Control" content="no-cache">
  <meta http-equiv="Expires" content="0">
  
  <link rel="dns-prefetch" href="https://edwardzhong.github.io">
  <link rel="icon shortcut" type="image/ico" href="/favicon.ico">
  <meta name="author" content="Jeff Zhong">
  <meta name="description" content="it's a blog by hexo">
  <meta name="keywords" content="hexo theme">
  <title >ä½¿ç”¨typescriptæ”¹é€ koaå¼€å‘æ¡†æ¶ - Jeff's world</title>
    <!-- The Open Graph protocol -->
  <meta property="og:url" content="https://edwardzhong.github.io">
  <meta property="og:type" content="blog">
  <meta property="og:title" content="ä½¿ç”¨typescriptæ”¹é€ koaå¼€å‘æ¡†æ¶ - Jeff's world">
  <meta property="og:description" content="it's a blog by hexo">
  
    
    
      <link rel="stylesheet" href="/lib/fontello/fontello.css">
    
      <link rel="stylesheet" href="/lib/reboto/roboto.css">
    
      <link rel="stylesheet" href="/css/index.css">
    
  
  <script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?5255e97b442092b8e1a219e6a48a0d42";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>

<meta name="generator" content="Hexo 4.2.0"><link rel="alternate" href="/atom.xml" title="Jeff's world" type="application/atom+xml">
</head>
<body>
<header class="header">
  <div class="top"></div>
  <h2>Jeff's World</h2>
  <h3>Things that I'm interested in</h3>
  <div class="menu">
  
  
  
      <a  href="/" title="ä¸» é¡µ">
        <i class="icon-home"></i>
        <span>ä¸» é¡µ</span>
      </a>
  
      <a  href="/sites/demo/" title="Demo">
        <i class="icon-page"></i>
        <span>Demo</span>
      </a>
  
      <a  data-tag="search"  href="javascript:;" title="æœ ç´¢">
        <i class="icon-search"></i>
        <span>æœ ç´¢</span>
      </a>
  
  </div>
  <div class="state">
  
    <a href="/archives">43<br>æ–‡ ç« </a><a href="/categories">2<br>åˆ† ç±»</a><a href="/tags">60<br>æ ‡ ç­¾</a>
  </div>
  <div class="social">
  
  
  
      <a href="https://github.com/edwardzhong" target="_blank" rel="noopener" title="Github"><i class="icon-github"></i></a>
  
      <a href="https://twitter.com/JianfengEdward" target="_blank" rel="noopener" title="Twitter"><i class="icon-twitter"></i></a>
  
      <a href="https://www.facebook.com/jianfeng.edward" target="_blank" rel="noopener" title="Facebook"><i class="icon-facebook"></i></a>
  
      <a href="http://weibo.com/1593251850" target="_blank" rel="noopener" title="Weibo"><i class="icon-weibo"></i></a>
  
      <a href="/atom.xml" title="Rss"><i class="icon-rss"></i></a>
  
  </div>
  <div id="payBtn" class="pay-icon" title="è°¢è°¢æ‚¨çš„èµèµ">èµ</div>
</header>
  <div class="container">
    <div class="main">
    
        
<div class="post-list">
	<article class="post" style="animation:listshow 0.6s ease-out both 0.30000000000000004s">
    
    
        
    
	
	<a href="javascript:;">
        <div class="post-banner" style="background: url(/images/banner3.jpg)  center top / 100% no-repeat">
    		<h3 class="post-title">ä½¿ç”¨typescriptæ”¹é€ koaå¼€å‘æ¡†æ¶</h3>
    	</div>
	</a>
	<div class="post-inner">
	
    	<div class="post-info">
    		<time><i class="icon-calendar"></i> 2020/02/04 11:37:00</time>
    		<span class="category">
    		
    			
    			<i class="icon-book"></i>
    			
                    
                        <a href="/categories/%E6%8A%80%E6%9C%AF/">æŠ€æœ¯</a>
                    
    			
    		
    		</span>
    	</div>
    	<!-- <p><p>åŸæ–‡åœ°å€ï¼šä½¿ç”¨typescriptæ”¹é€ koaå¼€å‘æ¡†æ¶<br>å¼ºç±»å‹çš„ TypeScript å¼€å‘ä½“éªŒå’Œç»´æŠ¤é¡¹ç›®ä¸Šç›¸æ¯” JavaScript æœ‰ç€æ˜æ˜¾çš„ä¼˜åŠ¿ï¼Œé‚£ä¹ˆå¯¹å¸¸ç”¨çš„è„šæ‰‹æ¶è¿›è¡Œæ”¹é€ ä¹Ÿå°±åŠ¿åœ¨å¿…è¡Œäº†ã€‚<br>â€¦</p>
</p> -->
    	
    		<div class="post-content"><p>åŸæ–‡åœ°å€ï¼š<a href="https://edwardzhong.github.io/2020/02/04/koatypescript/">ä½¿ç”¨typescriptæ”¹é€ koaå¼€å‘æ¡†æ¶</a></p>
<p>å¼ºç±»å‹çš„ <strong>TypeScript</strong> å¼€å‘ä½“éªŒå’Œç»´æŠ¤é¡¹ç›®ä¸Šç›¸æ¯” <strong>JavaScript</strong> æœ‰ç€æ˜æ˜¾çš„ä¼˜åŠ¿ï¼Œé‚£ä¹ˆå¯¹å¸¸ç”¨çš„è„šæ‰‹æ¶è¿›è¡Œæ”¹é€ ä¹Ÿå°±åŠ¿åœ¨å¿…è¡Œäº†ã€‚</p>
<p>æ¥ä¸‹æ¥å¼€å§‹å¯¹åŸºäº <strong>koa</strong> æ¡†æ¶çš„ <strong>node</strong> åç«¯è„šæ‰‹æ¶è¿›è¡Œæ”¹é€ ï¼š</p>
<ol>
<li>é¡¹ç›®å¼€å‘ç¯å¢ƒ å’Œ <strong>typescript</strong> ç¼–è¯‘ç¯å¢ƒçš„æ­å»ºï¼›</li>
<li>å¯¹ <strong>node</strong>ã€<strong>koa</strong>ã€koaä¸­é—´ä»¶å’Œä½¿ç”¨åˆ°çš„åº“ æ·»åŠ ç±»å‹åŒ–æ”¯æŒï¼›</li>
<li>åŸºäº <strong>typesript</strong> çš„ç‰¹æ€§æ”¹é€ é¡¹ç›®ã€‚</li>
</ol>
<a id="more"></a>

<h2 id="é¡¹ç›®å¼€å‘ç¯å¢ƒæ­å»º"><a href="#é¡¹ç›®å¼€å‘ç¯å¢ƒæ­å»º" class="headerlink" title="é¡¹ç›®å¼€å‘ç¯å¢ƒæ­å»º"></a>é¡¹ç›®å¼€å‘ç¯å¢ƒæ­å»º</h2><p>åŸºäº <strong>gulp</strong> æ­å»ºå¼€å‘ç¼–è¯‘ç¯å¢ƒï¼Œ<strong>gulp-typescript</strong> æ’ä»¶ç”¨äºç¼–è¯‘ <strong>typescript</strong> æ–‡ä»¶ï¼Œ <strong>gulp-nodemon</strong> åˆ™å¯ä»¥ç›‘æ§æ–‡ä»¶å†…å®¹çš„å˜æ›´ï¼Œè‡ªåŠ¨ç¼–è¯‘å’Œé‡å¯<strong>node</strong>æœåŠ¡ï¼Œæå‡å¼€å‘æ•ˆç‡ã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm install -D gulp gulp-nodemon gulp-typescript ts-node typescript</span><br></pre></td></tr></table></figure>

<h4 id="gulp-çš„é…ç½®"><a href="#gulp-çš„é…ç½®" class="headerlink" title="gulp çš„é…ç½®"></a>gulp çš„é…ç½®</h4><p>gulpfile.js çš„è®¾ç½®</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; src, dest, watch, series, task &#125; = <span class="built_in">require</span>(<span class="string">'gulp'</span>);</span><br><span class="line"><span class="keyword">const</span> del = <span class="built_in">require</span>(<span class="string">'del'</span>);</span><br><span class="line"><span class="keyword">const</span> ts = <span class="built_in">require</span>(<span class="string">'gulp-typescript'</span>);</span><br><span class="line"><span class="keyword">const</span> nodemon = <span class="built_in">require</span>(<span class="string">'gulp-nodemon'</span>);</span><br><span class="line"><span class="keyword">const</span> tsProject = ts.createProject(<span class="string">'tsconfig.json'</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">clean</span>(<span class="params">cb</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> del([<span class="string">'dist'</span>], cb);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¾“å‡º js åˆ° distç›®å½•</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">toJs</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> src(<span class="string">'src/**/*.ts'</span>)</span><br><span class="line">    .pipe(tsProject())</span><br><span class="line">    .pipe(dest(<span class="string">'dist'</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// nodemon ç›‘æ§ ts æ–‡ä»¶</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">runNodemon</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  nodemon(&#123;</span><br><span class="line">    inspect: <span class="literal">true</span>,</span><br><span class="line">    script: <span class="string">'src/app.ts'</span>,</span><br><span class="line">    watch: [<span class="string">'src'</span>],</span><br><span class="line">    ext: <span class="string">'ts'</span>,</span><br><span class="line">    env: &#123; <span class="attr">NODE_ENV</span>: <span class="string">'development'</span> &#125;,</span><br><span class="line">    <span class="comment">// tasks: ['build'],</span></span><br><span class="line">  &#125;).on(<span class="string">'crash'</span>, () =&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.error(<span class="string">'Application has crashed!\n'</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> build = series(clean, toJs);</span><br><span class="line">task(<span class="string">'build'</span>, build);</span><br><span class="line">exports.build = build;</span><br><span class="line">exports.default = runNodemon;</span><br></pre></td></tr></table></figure>

<h4 id="typescript-çš„é…ç½®"><a href="#typescript-çš„é…ç½®" class="headerlink" title="typescript çš„é…ç½®"></a>typescript çš„é…ç½®</h4><p>tsconfig.json çš„è®¾ç½®</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"compilerOptions"</span>: &#123;</span><br><span class="line">    <span class="attr">"baseUrl"</span>: <span class="string">"."</span>, <span class="comment">// importçš„ç›¸å¯¹èµ·å§‹è·¯å¾„</span></span><br><span class="line">    <span class="attr">"outDir"</span>: <span class="string">"./dist"</span>, <span class="comment">// æ„å»ºè¾“å‡ºç›®å½•</span></span><br><span class="line">    <span class="attr">"module"</span>: <span class="string">"commonjs"</span>,</span><br><span class="line">    <span class="attr">"target"</span>: <span class="string">"esnext"</span>,<span class="comment">// node ç¯å¢ƒæ”¯æŒ esnext</span></span><br><span class="line">    <span class="attr">"allowSyntheticDefaultImports"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"importHelpers"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"strict"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"moduleResolution"</span>: <span class="string">"node"</span>,</span><br><span class="line">    <span class="attr">"esModuleInterop"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"forceConsistentCasingInFileNames"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"noImplicitAny"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"suppressImplicitAnyIndexErrors"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"noUnusedParameters"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"noUnusedLocals"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"noImplicitReturns"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"experimentalDecorators"</span>: <span class="literal">true</span>, <span class="comment">// å¼€å¯è£…é¥°å™¨çš„ä½¿ç”¨</span></span><br><span class="line">    <span class="attr">"emitDecoratorMetadata"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"allowJs"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"sourceMap"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"paths"</span>: &#123;</span><br><span class="line">      <span class="attr">"@/*"</span>: [ <span class="string">"src/*"</span> ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"include"</span>: [</span><br><span class="line">    <span class="string">"src/**/*"</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">"exclude"</span>: [</span><br><span class="line">    <span class="string">"node_modules"</span>,</span><br><span class="line">    <span class="string">"dist"</span></span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="eslint-çš„é…ç½®"><a href="#eslint-çš„é…ç½®" class="headerlink" title="eslint çš„é…ç½®"></a>eslint çš„é…ç½®</h4><p>å½“ç„¶ <strong>eslint</strong> ä¹Ÿè¦æ·»åŠ å¯¹ <strong>typescript</strong> å¯¹æ”¯æŒ</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm install -D @typescript-eslint/eslint-plugin @typescript-eslint/parser</span><br></pre></td></tr></table></figure>

<p>.eslintrc.json çš„è®¾ç½®</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"env"</span>: &#123;</span><br><span class="line">    <span class="attr">"es6"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"node"</span>: <span class="literal">true</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"extends"</span>: [</span><br><span class="line">    <span class="string">"eslint:recommended"</span>,</span><br><span class="line">    <span class="string">"plugin:@typescript-eslint/eslint-recommended"</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">"globals"</span>: &#123;</span><br><span class="line">    <span class="attr">"Atomics"</span>: <span class="string">"readonly"</span>,</span><br><span class="line">    <span class="attr">"SharedArrayBuffer"</span>: <span class="string">"readonly"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"parser"</span>: <span class="string">"@typescript-eslint/parser"</span>,</span><br><span class="line">  <span class="attr">"parserOptions"</span>: &#123;</span><br><span class="line">    <span class="attr">"ecmaVersion"</span>: <span class="number">2018</span>,</span><br><span class="line">    <span class="attr">"sourceType"</span>: <span class="string">"module"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"plugins"</span>: [</span><br><span class="line">    <span class="string">"@typescript-eslint"</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">"rules"</span>: &#123;</span><br><span class="line">    <span class="attr">"indent"</span>: [ <span class="string">"warn"</span>, <span class="number">2</span> ],</span><br><span class="line">    <span class="attr">"no-unused-vars"</span>: <span class="number">0</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="package-json-è¿è¡Œé…ç½®"><a href="#package-json-è¿è¡Œé…ç½®" class="headerlink" title="package.json è¿è¡Œé…ç½®"></a>package.json è¿è¡Œé…ç½®</h4><p>æœ€åå°±æ˜¯è®¾ç½® package.json çš„ scripts</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">"scripts": &#123;</span><br><span class="line">  "start": "gulp",// dev</span><br><span class="line">  "build": "gulp build", // output</span><br><span class="line">  "eslint": "eslint --fix --ext .js,.ts src/",</span><br><span class="line">  "server": "export NODE_ENV=production &amp;&amp; node dist/app" // production server</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<h2 id="æ·»åŠ ç±»å‹åŒ–æ”¯æŒ"><a href="#æ·»åŠ ç±»å‹åŒ–æ”¯æŒ" class="headerlink" title="æ·»åŠ ç±»å‹åŒ–æ”¯æŒ"></a>æ·»åŠ ç±»å‹åŒ–æ”¯æŒ</h2><p>é¡¹ç›®ä¸»è¦ä½¿ç”¨åˆ°äº†ä»¥ä¸‹çš„ç»„ä»¶</p>
<ul>
<li>jsonwebtoken</li>
<li>koa</li>
<li>koa-body</li>
<li>koa-compress</li>
<li>koa-favicon</li>
<li>koa-logger</li>
<li>koa-router</li>
<li>koa-static</li>
<li>koa2-cors</li>
<li>log4js</li>
</ul>
<p>é‚£ä¹ˆå°±è¦å®‰è£…å¯¹åº”çš„ type æ–‡ä»¶ï¼Œå½“ç„¶åˆ«å¿˜äº† <strong>@types/node</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm install -D @types/jsonwebtoken @types/koa @types/koa-compress @types/koa-favicon @types/koa-logger @types/koa-router @types/koa-static @types/koa2-cors @types/log4js @types/node</span><br></pre></td></tr></table></figure>



<h2 id="ä½¿ç”¨-typescript-è£…é¥°å™¨-æ”¹é€ é¡¹ç›®"><a href="#ä½¿ç”¨-typescript-è£…é¥°å™¨-æ”¹é€ é¡¹ç›®" class="headerlink" title="ä½¿ç”¨ typescript è£…é¥°å™¨ æ”¹é€ é¡¹ç›®"></a>ä½¿ç”¨ typescript è£…é¥°å™¨ æ”¹é€ é¡¹ç›®</h2><p><strong>.net mvc</strong> æ¡†æ¶æœ‰ä¸ªå¾ˆä¾¿åˆ©çš„åœ°æ–¹å°±æ˜¯ ä½¿ç”¨è£…é¥°å™¨å¯¹æ§åˆ¶å™¨è¿›è¡Œé…ç½®ï¼Œç°åœ¨é€šè¿‡ <strong>typescript</strong> çš„è£…é¥°å™¨ä¹Ÿå¯ä»¥å®ç°ç›¸åŒçš„åŠŸèƒ½ã€‚è¿™é‡Œéœ€è¦ä½¿ç”¨åˆ°åå°„ç›¸å…³çš„åº“ <strong>reflect-metadata</strong>ï¼Œç”¨è¿‡ <strong>Java</strong> æˆ– <strong>C#</strong> çš„å°ä¼™ä¼´ï¼Œå¯¹åå°„çš„åŸç†ä¸€å®šä¸é™Œç”Ÿã€‚</p>
<h4 id="å®šä¹‰httpè¯·æ±‚çš„è£…é¥°å™¨"><a href="#å®šä¹‰httpè¯·æ±‚çš„è£…é¥°å™¨" class="headerlink" title="å®šä¹‰httpè¯·æ±‚çš„è£…é¥°å™¨"></a>å®šä¹‰httpè¯·æ±‚çš„è£…é¥°å™¨</h4><p>æˆ‘ä»¬å†ä¹Ÿä¸éœ€è¦åœ¨è·¯ç”±é…ç½®å’Œæ§åˆ¶å™¨æ–¹æ³•ä¹‹é—´æ¥å›æŸ¥æ‰¾å’ŒåŒ¹é…äº†</p>
<figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">'reflect-metadata'</span></span><br><span class="line"><span class="keyword">import</span> &#123; ROUTER_MAP &#125; <span class="keyword">from</span> <span class="string">'../constant'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @desc ç”Ÿæˆ http method è£…é¥°å™¨</span></span><br><span class="line"><span class="comment"> * @param &#123;string&#125; method - http methodï¼Œå¦‚ getã€postã€head</span></span><br><span class="line"><span class="comment"> * @return Decorator - è£…é¥°å™¨</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createMethodDecorator</span>(<span class="params">method: <span class="built_in">string</span></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// è£…é¥°å™¨æ¥æ”¶è·¯ç”± path ä½œä¸ºå‚æ•°</span></span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="title">httpMethodDecorator</span>(<span class="params">path: <span class="built_in">string</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function">(<span class="params">proto: <span class="built_in">any</span>, name: <span class="built_in">string</span></span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> target = proto.<span class="keyword">constructor</span>;</span><br><span class="line">      <span class="keyword">const</span> routeMap = Reflect.getMetadata(ROUTER_MAP, target, <span class="string">'method'</span>) || [];</span><br><span class="line">      routeMap.push(&#123; name, method, path &#125;);</span><br><span class="line">      Reflect.defineMetadata(ROUTER_MAP, routeMap, target, <span class="string">'method'</span>);</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¯¼å‡º http method è£…é¥°å™¨</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> post = createMethodDecorator(<span class="string">'post'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="keyword">get</span> = createMethodDecorator(<span class="string">'get'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> del = createMethodDecorator(<span class="string">'del'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> put = createMethodDecorator(<span class="string">'put'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> patch = createMethodDecorator(<span class="string">'patch'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> options = createMethodDecorator(<span class="string">'options'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> head = createMethodDecorator(<span class="string">'head'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> all = createMethodDecorator(<span class="string">'all'</span>);</span><br></pre></td></tr></table></figure>

<h4 id="è£…é¥°æ§åˆ¶å™¨çš„æ–¹æ³•"><a href="#è£…é¥°æ§åˆ¶å™¨çš„æ–¹æ³•" class="headerlink" title="è£…é¥°æ§åˆ¶å™¨çš„æ–¹æ³•"></a>è£…é¥°æ§åˆ¶å™¨çš„æ–¹æ³•</h4><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> Sign &#123;</span><br><span class="line">    </span><br><span class="line">  <span class="meta">@post</span>(<span class="string">'/login'</span>)</span><br><span class="line">  <span class="keyword">async</span> login (ctx: Context) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; email, password &#125; = ctx.request.body;</span><br><span class="line">    <span class="keyword">const</span> users = <span class="keyword">await</span> userDao.getUser(&#123; email &#125;);</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="keyword">return</span> ctx.body = &#123;</span><br><span class="line">      code: <span class="number">0</span>,</span><br><span class="line">      message: <span class="string">'ç™»å½•æˆåŠŸ'</span>,</span><br><span class="line">      data</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@post</span>(<span class="string">'/register'</span>)</span><br><span class="line">  <span class="keyword">async</span> register (ctx: Context) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; email, password &#125; = ctx.request.body;</span><br><span class="line">    <span class="keyword">const</span> salt = makeSalt();</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="keyword">return</span> ctx.body = &#123;</span><br><span class="line">      code: <span class="number">0</span>,</span><br><span class="line">      message: <span class="string">'æ³¨å†ŒæˆåŠŸï¼'</span>,</span><br><span class="line">      data</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="æ”¶é›†å…ƒæ•°æ®å’Œæ·»åŠ è·¯ç”±"><a href="#æ”¶é›†å…ƒæ•°æ®å’Œæ·»åŠ è·¯ç”±" class="headerlink" title="æ”¶é›†å…ƒæ•°æ®å’Œæ·»åŠ è·¯ç”±"></a>æ”¶é›†å…ƒæ•°æ®å’Œæ·»åŠ è·¯ç”±</h4><p>æˆ‘ä»¬å·²ç»æŠŠè£…é¥°å™¨æ·»åŠ åˆ°å¯¹åº”æ§åˆ¶å™¨çš„æ–¹æ³•ä¸Šäº†ï¼Œé‚£ä¹ˆæ€ä¹ˆæŠŠå…ƒæ•°æ®æ”¶é›†èµ·æ¥å‘¢ï¼Ÿè¿™å°±éœ€è¦ç”¨åˆ° <strong>node</strong> æä¾›çš„ <strong>fs</strong> æ–‡ä»¶æ¨¡å—ï¼Œ<strong>node</strong>æœåŠ¡ç¬¬ä¸€æ¬¡å¯åŠ¨çš„æ—¶å€™ï¼Œæ‰«æä¸€écontrolleræ–‡ä»¶å¤¹ï¼Œæ”¶é›†åˆ°æ‰€æœ‰æ§åˆ¶å™¨æ¨¡å—ï¼Œç»“åˆè£…é¥°å™¨æ”¶é›†åˆ°çš„metadataï¼Œå°±å¯ä»¥æŠŠå¯¹åº”çš„æ–¹æ³•æ·»åŠ åˆ° <strong>koa-router</strong>ã€‚</p>
<figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">'reflect-metadata'</span></span><br><span class="line"><span class="keyword">import</span> fs <span class="keyword">from</span> <span class="string">'fs'</span></span><br><span class="line"><span class="keyword">import</span> path <span class="keyword">from</span> <span class="string">'path'</span></span><br><span class="line"><span class="keyword">import</span> &#123; ROUTER_MAP &#125; <span class="keyword">from</span> <span class="string">'./constant'</span></span><br><span class="line"><span class="keyword">import</span> &#123; RouteMeta &#125; <span class="keyword">from</span> <span class="string">'./type'</span></span><br><span class="line"><span class="keyword">import</span> Router <span class="keyword">from</span> <span class="string">'koa-router'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> addRouter = <span class="function">(<span class="params">router: Router</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> ctrPath = path.join(__dirname, <span class="string">'controller'</span>);</span><br><span class="line">  <span class="keyword">const</span> modules: ObjectConstructor[] = [];</span><br><span class="line">  <span class="comment">// æ‰«æcontrolleræ–‡ä»¶å¤¹ï¼Œæ”¶é›†æ‰€æœ‰controller</span></span><br><span class="line">  fs.readdirSync(ctrPath).forEach(<span class="function"><span class="params">name</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="regexp">/^[^.]+?\.(t|j)s$/</span>.test(name)) &#123;</span><br><span class="line">      modules.push(<span class="built_in">require</span>(path.join(ctrPath, name)).default)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="comment">// ç»“åˆmetaæ•°æ®æ·»åŠ è·¯ç”±</span></span><br><span class="line">  modules.forEach(<span class="function"><span class="params">m</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> routerMap: RouteMeta[] = Reflect.getMetadata(ROUTER_MAP, m, <span class="string">'method'</span>) || [];</span><br><span class="line">    <span class="keyword">if</span> (routerMap.length) &#123;</span><br><span class="line">      <span class="keyword">const</span> ctr = <span class="keyword">new</span> m();</span><br><span class="line">      routerMap.forEach(<span class="function"><span class="params">route</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> &#123; name, method, path &#125; = route;</span><br><span class="line">        router[method](path, ctr[name]);</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> addRouter</span><br></pre></td></tr></table></figure>

<h2 id="æœ€å"><a href="#æœ€å" class="headerlink" title="æœ€å"></a>æœ€å</h2><p>è¿™æ ·å¯¹<strong>koa</strong>é¡¹ç›®è„šæ‰‹æ¶çš„æ”¹é€ åŸºæœ¬å®Œæˆï¼Œæºç è¯·æŸ¥çœ‹ <em><a href="https://github.com/edwardzhong/koa-server" target="_blank" rel="noopener">koa-server</a></em></p>
</div>
    	
		<div class="post-footer">
			<div class="tags">
				<i class="icon-tags"></i> 
				
					
					
						
							<a href="/tags/node/">node</a>
						
					
						
							<a href="/tags/koa/">koa</a>
						
					
						
							<a href="/tags/typescript/">typescript</a>
						
					
				
			</div>
			<a class="share" href="javascript:;" data-url="/2020/02/04/koatypescript/" data-desc="åŸæ–‡åœ°å€ï¼šä½¿ç”¨typescriptæ”¹é€ koaå¼€å‘æ¡†æ¶
å¼ºç±»å‹çš„ TypeScript å¼€å‘ä½“éªŒ..." data-type="share" title="share"><i class="icon-share"></i></a>
		</div>
	</div>
</article>
</div>
<nav class="pagination clearfix">
  
    
      
        <a href="/2020/06/04/svg1/" class="prev post-prev"> <i class="icon-leftarrow"></i> svgé«˜çº§åº”ç”¨åŠåŠ¨ç”»</a>
      

      
        <a href="/2019/05/28/webglray/" class="next post-next"> WebGLä¹‹ç‰©ä½“é€‰æ‹© <i class="icon-rightarrow"></i></a>
      
    
  
</nav>

<div class="wxshare-popup">
    <a class="close" href="javascript:;"></a>
    <p>æ‰«ä¸€æ‰«ï¼Œåˆ†äº«åˆ°å¾®ä¿¡</p>
    <div id="qrcode" class="wx-qrcode"></div>
</div>

    
    <footer class="footer">
<p class="theme">
	Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/edwardzhong/simply.git" target="_blank" rel="noopener">simply</a>
</p>
<p class="copy">Copyright &copy; 2020 Jeff Zhong</p>
</footer>
    <div class="top-bottom">
      <div class="to-top hide" title="to top"><i class="icon-up"></i></div>
      <div class="to-bottom hide" title="to bottom"><i class="icon-down"></i></div>
    </div>
    </div>

  </div>
<input type="hidden" name="isPost" id="isPost" value="true">
<i id="barBtn" class="icon icon-menu"></i>
<div id="payMe" class="payme">
    <i class="icon icon-cancel"></i>
    <p class="pay-title">ç»™æˆ‘çš„æ—©é¤åŠ ä¸ªè›‹å§ ğŸ˜Š</p>
    <div>
      <img src="/images/weixinpay.jpg" alt="weixinpay">
      <img src="/images/alipay.jpg" alt="alipay" style="display:none;">
    </div>
    <div class="pay-selects">
        <input type="radio" name="pay" id="weixinpay" checked="checked"><label for="weixinpay"> å¾®ä¿¡ </label>&nbsp;&nbsp;
        <input type="radio" name="pay" id="alipay"><label for="alipay"> æ”¯ä»˜å® </label>
    </div>
</div>

  
  
    <script src="/lib/jquery-2.2.3.min.js"></script>
  
    <script src="/lib/qrcode.min.js"></script>
  
    <script src="/js/index.js"></script>
  

<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>

</body>
</html>
