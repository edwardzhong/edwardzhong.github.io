<!doctype html>
<html lang="zh-CN">









<head>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
  <!-- ä¼˜å…ˆä½¿ç”¨ IE æœ€æ–°ç‰ˆæœ¬å’Œ Chrome -->
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
  <!-- ä¸ºç§»åŠ¨è®¾å¤‡æ·»åŠ  viewport -->
  <meta name="viewport" content="width=device-width,initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no">
  <!-- æ·»åŠ åˆ°ä¸»å±åçš„æ ‡é¢˜ï¼ˆiOS 6 æ–°å¢ï¼‰ -->
  <meta name="apple-mobile-web-app-title" content="Dockeræ­å»ºéƒ¨ç½²Nodeé¡¹ç›® - Jeff's world">
  <!-- æ˜¯å¦å¯ç”¨ WebApp å…¨å±æ¨¡å¼ï¼Œåˆ é™¤è‹¹æœé»˜è®¤çš„å·¥å…·æ å’Œèœå•æ  -->
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <!-- è®¾ç½®è‹¹æœå·¥å…·æ é¢œè‰² -->
  <meta name="apple-mobile-web-app-status-bar-style" content = "black" />
  <!-- æ·»åŠ æ™ºèƒ½ App å¹¿å‘Šæ¡ Smart App Bannerï¼ˆiOS 6+ Safariï¼‰ -->
  <!-- <meta name = "apple-itunes-app" content = "app-id=myAppStoreID, affiliate-data=myAffiliateData, app-argument=myURL"> -->
  <!-- å¿½ç•¥é¡µé¢ä¸­çš„æ•°å­—è¯†åˆ«ä¸ºç”µè¯ï¼Œå¿½ç•¥emailè¯†åˆ« -->
  <meta name="format-detection" content = "telphone=no, email=no" />
  <!--ä¸‹é¢ä¸‰ä¸ªæ˜¯æ¸…é™¤ç¼“å­˜ å¾®ä¿¡æµè§ˆå™¨ç¼“å­˜ä¸¥é‡åˆæ— åˆ·æ–°ï¼›è¿™ä¸ªæ–¹æ³•è°ƒè¯•çš„æ—¶å€™å¾ˆæ–¹ä¾¿-->
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Cache-Control" content="no-cache">
  <meta http-equiv="Expires" content="0">
  
  <link rel="dns-prefetch" href="https://jeff_zhong.gitee.io/blog">
  <link rel="icon shortcut" type="image/ico" href="/favicon.ico">
  <meta name="author" content="Jeff Zhong">
  <meta name="description" content="it's a blog by hexo">
  <meta name="keywords" content="hexo theme">
  <title >Dockeræ­å»ºéƒ¨ç½²Nodeé¡¹ç›® - Jeff's world</title>
    <!-- The Open Graph protocol -->
  <meta property="og:url" content="https://jeff_zhong.gitee.io/blog">
  <meta property="og:type" content="blog">
  <meta property="og:title" content="Dockeræ­å»ºéƒ¨ç½²Nodeé¡¹ç›® - Jeff's world">
  <meta property="og:description" content="it's a blog by hexo">
  
    
    
      <link rel="stylesheet" href="/lib/fontello/fontello.css">
    
      <link rel="stylesheet" href="/lib/reboto/roboto.css">
    
      <link rel="stylesheet" href="/css/index.css">
    
  
  <script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?5255e97b442092b8e1a219e6a48a0d42";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>

<meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/atom.xml" title="Jeff's world" type="application/atom+xml">
</head>
<body>
<header class="header">
  <div class="top"></div>
  <h2>Jeff's World</h2>
  <h3>Things that I'm interested in</h3>
  <div class="menu">
  
  
  
      <a  href="/" title="ä¸» é¡µ">
        <i class="icon-home"></i>
        <span>ä¸» é¡µ</span>
      </a>
  
      <a  href="https://jeff_zhong.gitee.io/demo/" title="Demo">
        <i class="icon-page"></i>
        <span>Demo</span>
      </a>
  
      <a  data-tag="search"  href="javascript:;" title="æœ ç´¢">
        <i class="icon-search"></i>
        <span>æœ ç´¢</span>
      </a>
  
  </div>
  <div class="state">
  
    <a href="/archives">53<br>æ–‡ ç« </a><a href="/categories">2<br>åˆ† ç±»</a><a href="/tags">70<br>æ ‡ ç­¾</a>
  </div>
  <div class="social">
  
  
  
      <a href="https://github.com/edwardzhong" target="_blank" rel="noopener" title="Github"><i class="icon-github"></i></a>
  
      <a href="https://x.com/jeff_zhong3" target="_blank" rel="noopener" title="X"><i class="icon-twitter"></i></a>
  
      <a href="https://www.facebook.com/jianfeng.edward" target="_blank" rel="noopener" title="Facebook"><i class="icon-facebook"></i></a>
  
      <a href="http://weibo.com/1593251850" target="_blank" rel="noopener" title="Weibo"><i class="icon-weibo"></i></a>
  
      <a href="/atom.xml" title="Rss"><i class="icon-rss"></i></a>
  
  </div>
  <div id="payBtn" class="pay-icon" title="è°¢è°¢æ‚¨çš„èµèµ">èµ</div>
</header>
  <div class="container">
    <div class="main">
    
        
<div class="post-list">
	<article class="post" style="animation:listshow 0.6s ease-out both 0.30000000000000004s">
    
    
        
    
	
	<a href="javascript:;">
        <div class="post-banner" style="background: url(/blog/images/banner7.jpg)  center top / 100% no-repeat">
    		<h3 class="post-title">Dockeræ­å»ºéƒ¨ç½²Nodeé¡¹ç›®</h3>
    	</div>
	</a>
	<div class="post-inner">
	
    	<div class="post-info">
    		<time><i class="icon-calendar"></i> 2020/07/13 11:39:00</time>
    		<span class="category">
    		
    			
    			<i class="icon-book"></i>
    			
                    
                        <a href="/categories/%E6%8A%80%E6%9C%AF/">æŠ€æœ¯</a>
                    
    			
    		
    		</span>
    	</div>
    	<!-- <p><p>å‰æ®µæ—¶é—´åšäº†ä¸ªnodeå…¨æ ˆé¡¹ç›®ï¼ŒæœåŠ¡ç«¯æŠ€æœ¯æ ˆæ˜¯ nginx + koa + postgresqlã€‚å…¶ä¸­åœ¨centosä¸Šæ­å»ºç¯å¢ƒå’Œéƒ¨ç½²éƒ½æŒºè´¹å‘¨æŠ˜ï¼Œéƒ¨ç½²æµ‹è¯•æœåŠ¡å™¨ï¼Œæ¥ç€ä¸Šçº¿çš„æ—¶å€™åˆéƒ¨ç½²ç”Ÿäº§ç¯å¢ƒæœåŠ¡å™¨â€¦</p>
</p> -->
    	
    		<div class="post-content"><p>å‰æ®µæ—¶é—´åšäº†ä¸ª<code>node</code>å…¨æ ˆé¡¹ç›®ï¼ŒæœåŠ¡ç«¯æŠ€æœ¯æ ˆæ˜¯ <code>nginx</code> + <code>koa</code> + <code>postgresql</code>ã€‚å…¶ä¸­åœ¨<code>centos</code>ä¸Šæ­å»ºç¯å¢ƒå’Œéƒ¨ç½²éƒ½æŒºè´¹å‘¨æŠ˜ï¼Œéƒ¨ç½²æµ‹è¯•æœåŠ¡å™¨ï¼Œæ¥ç€ä¸Šçº¿çš„æ—¶å€™åˆéƒ¨ç½²ç”Ÿäº§ç¯å¢ƒæœåŠ¡å™¨ã€‚è¿™ä¸­é—´å°±æœ‰å¾ˆå¤šæ—¢æ— èŠåˆè´¹ç²¾åŠ›ï¼ŒåƒåŠ›ä¸è®¨å¥½çš„â€ä½“åŠ›æ´»â€ã€‚æ‰€ä»¥å°±å¼€å§‹æ€è€ƒæ€ä¹ˆè‡ªåŠ¨åŒ–è¿™éƒ¨åˆ†æ­å»ºéƒ¨ç½²çš„å·¥ä½œï¼Œä¹Ÿå°±å¼•å‡ºäº†<code>Docker</code>ã€‚</p>
<a id="more"></a>

<h2 id="ä»€ä¹ˆæ˜¯Docker"><a href="#ä»€ä¹ˆæ˜¯Docker" class="headerlink" title="ä»€ä¹ˆæ˜¯Docker"></a>ä»€ä¹ˆæ˜¯Docker</h2><p><code>Docker</code> æ˜¯æ¯”è™šæ‹Ÿæœºè¿˜è¦è½»é‡çº§çš„è™šæ‹ŸåŒ–æŠ€æœ¯ï¼Œå®ƒè™šæ‹ŸåŒ–çš„å®ä½“å°±å«åšå®¹å™¨ã€‚å®¹å™¨æœ¬èº«å°±æ˜¯ä¸€ä¸ªéš”ç¦»äº†ä½œç”¨åŸŸçš„<code>sandbox</code>ï¼ŒåŒæ—¶å®ƒåªåŒ…å«äº†åŸºç¡€åº“å’Œæœ¬èº«æ‰¿è½½çš„æœåŠ¡ï¼Œéå¸¸ç²¾ç®€ã€‚å®¹å™¨è¿è¡Œèµ·æ¥åå°±åªæ˜¯å®¿ä¸»æœºä¸­çš„ä¸€ä¸ªè¿›ç¨‹è€Œå·²ï¼Œå ç”¨çš„èµ„æºæ˜¯éå¸¸å°çš„ï¼Œè¿™å°±ä¸ºæ“ä½œç³»ç»Ÿä¸Šè¿è¡Œå®¹å™¨é›†ç¾¤åˆ›é€ äº†æ¡ä»¶ï¼Œå¯æ“ä½œæ€§å’Œçµæ´»æ€§æä½³ã€‚</p>
<p>é•œåƒå’Œå®¹å™¨åˆæ˜¯ä»€ä¹ˆå…³ç³»å‘¢ï¼Ÿå¯ä»¥æŠŠé•œåƒçœ‹æˆæ˜¯ç±»ï¼ˆ<code>class</code>ï¼‰ï¼Œå®¹å™¨çœ‹æˆå¯¹è±¡ï¼ˆ<code>object</code>ï¼‰ï¼Œå®¹å™¨æ˜¯ç”±é•œåƒå®ä¾‹åŒ–äº§ç”Ÿå‡ºæ¥çš„ï¼Œå½“ç„¶ä¸€ä¸ªé•œåƒå¯ä»¥ç”Ÿæˆå¤šä¸ªå®¹å™¨ã€‚</p>
<h2 id="å®¢æˆ·ç«¯Docker"><a href="#å®¢æˆ·ç«¯Docker" class="headerlink" title="å®¢æˆ·ç«¯Docker"></a>å®¢æˆ·ç«¯Docker</h2><p>å¦‚æœä¸åœ¨æœåŠ¡å™¨ï¼Œæˆ‘ä»¬åœ¨å®¢æˆ·ç«¯è¦æ€ä¹ˆä½¿ç”¨ <code>Docker</code>å‘¢ï¼Ÿåœ¨ <code>Windows</code> å’Œ <code>OSX</code> ä¸Šå¯ä»¥ä½¿ç”¨ <code>Docker Desktop</code>ï¼Œå†åŠ ä¸Š<code>Kitematic</code>ï¼Œè¿™ä¸¤ä¸ªéƒ½æ˜¯æ¡Œé¢ç®¡ç†å·¥å…·ï¼Œå¸¸è§„çš„æ“ä½œæ–¹é¢éå¸¸ä¾¿åˆ©ã€‚<code>Docker Desktop</code> å’Œ <code>Kitematic</code> åªæ˜¯å¯è§†åŒ–äº†éƒ¨åˆ†æ“ä½œï¼Œå‘½ä»¤è¡Œè¿˜æ˜¯å¿…å¤‡çš„ï¼Œå› ä¸ºå¾ˆå¤šæ“ä½œä¹Ÿèƒ½å‘½ä»¤è¡Œæ‰è¡Œã€‚</p>
<h2 id="DockeråŸºæœ¬æ“ä½œ"><a href="#DockeråŸºæœ¬æ“ä½œ" class="headerlink" title="DockeråŸºæœ¬æ“ä½œ"></a>DockeråŸºæœ¬æ“ä½œ</h2><h4 id="é•œåƒåç§°"><a href="#é•œåƒåç§°" class="headerlink" title="é•œåƒåç§°"></a>é•œåƒåç§°</h4><p>å…³äºé•œåƒæ ‡ç­¾ï¼Œæ¯”å¦‚<code>nginx:1.19.0-alpine</code>ï¼Œ1.19.0æ˜¯ <code>nginx</code> çš„ç‰ˆæœ¬å·ï¼Œ<code>alpine</code>æ˜¯osçš„ä»£å·ã€‚</p>
<blockquote>
<p>Jessie: debian 8</p>
<p>Stretch: debian 9</p>
<p>Buster: debian 10</p>
<p>Alpine:  Alpineï¼Œæ¨èä½¿ç”¨ï¼Œå› ä¸ºä½“ç§¯éå¸¸å°</p>
</blockquote>
<p><code>Alpine</code> æ˜¯ä½“ç§¯æœ€å°çš„ä¸€ä¸ªç‰ˆæœ¬ï¼Œæœ‰äº›ç”šè‡³æ˜¯å…¶ä»–ç‰ˆæœ¬çš„å››åˆ†ä¹‹ä¸€ã€‚è¿™æ„å‘³ç€æ„å»ºé•œåƒæ›´å¿«ï¼Œè¿è¡Œæ•ˆç‡æ›´é«˜ï¼Œå› ä¸ºåŠ è½½çš„ç»„ä»¶æ›´åŠ å°‘ï¼Œæ— å½¢ä¸­ä¹Ÿæ„å‘³ç€æ¼æ´æ›´å°‘æ›´å®‰å…¨ã€‚</p>
<h4 id="æ‹‰å–é•œåƒ"><a href="#æ‹‰å–é•œåƒ" class="headerlink" title="æ‹‰å–é•œåƒ"></a>æ‹‰å–é•œåƒ</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker pull nginx:1.19.0-alpine</span><br></pre></td></tr></table></figure>

<h4 id="å¯åŠ¨å®¹å™¨"><a href="#å¯åŠ¨å®¹å™¨" class="headerlink" title="å¯åŠ¨å®¹å™¨"></a>å¯åŠ¨å®¹å™¨</h4><blockquote>
<p>â€“name webï¼šæŒ‡å®šå®¹å™¨åç§°ä¸ºweb</p>
<p>-p 8080:80ï¼š å®¹å™¨nginxç›‘å¬ç«¯å£ä¸º80ï¼Œæ˜ å°„åˆ°æœ¬åœ°ç«¯å£8080</p>
<p>-v xxxx:xxxxï¼šè¿™é‡Œæ˜¯ç”¨æœ¬åœ°é…ç½®æ–‡ä»¶æ˜ å°„åˆ°å®¹å™¨nginxé…ç½®æ–‡ä»¶</p>
<p>-dï¼šåå°è¿è¡Œ</p>
<p>nginx:1.19.0-alpineï¼šä½¿ç”¨çš„é•œåƒ</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker run --name web -p 8080:80 -v /usr/etc/nginx/nginx.conf:/etc/nginx/nginx.conf:ro -d nginx:1.19.0-alpine</span><br></pre></td></tr></table></figure>

<h4 id="å…¶ä»–æ“ä½œ"><a href="#å…¶ä»–æ“ä½œ" class="headerlink" title="å…¶ä»–æ“ä½œ"></a>å…¶ä»–æ“ä½œ</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker images <span class="comment">#æ˜¾ç¤ºé•œåƒ</span></span><br><span class="line">docker rmi xxx <span class="comment">#åˆ é™¤é•œåƒ</span></span><br><span class="line">docker ps <span class="comment">#æ˜¾ç¤ºè¿è¡Œçš„å®¹å™¨</span></span><br><span class="line">docker rm xxx <span class="comment">#åˆ é™¤å®¹å™¨</span></span><br></pre></td></tr></table></figure>

<h2 id="Dockerfile"><a href="#Dockerfile" class="headerlink" title="Dockerfile"></a>Dockerfile</h2><p>æ„å»ºé•œåƒæ¯”è¾ƒæ–¹ä¾¿çš„æ˜¯ä½¿ç”¨<code>Dockerfile</code>ï¼Œå®ƒå°±æ˜¯é•œåƒçš„é…ç½®æ–‡ä»¶ï¼Œåªè¦æœ‰<code>Dockerfile</code>ï¼Œéšæ—¶å¯ä»¥æ„å»ºé•œåƒã€‚å¦‚ä¸‹å°±æ˜¯æ„å»ºä¸€ä¸ªéå¸¸ç®€å•çš„<code>nginx</code>é•œåƒï¼Œ<code>from</code>å°±æ˜¯æ„å»ºæ—¶ä½¿ç”¨çš„åŸºç¡€é•œåƒï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">FROM nginx</span><br><span class="line">COPY nginx.conf /etc/nginx/nginx.conf</span><br></pre></td></tr></table></figure>

<h2 id="Docker-compose"><a href="#Docker-compose" class="headerlink" title="Docker-compose"></a>Docker-compose</h2><p>å½“æˆ‘ä»¬çš„é¡¹ç›®ä¸ä»…åªæœ‰å•ä¸ªå®¹å™¨ï¼Œè€Œæ˜¯éœ€è¦è¿è¡Œå¤šä¸ªå®¹å™¨ï¼Œè€Œä¸”å®¹å™¨ä¹‹é—´è¿˜éœ€è¦äº’ç›¸é€šä¿¡çš„æ—¶å€™ï¼Œå°±éœ€è¦æ›´å¼ºå¤§çš„ç®¡ç†å·¥å…·äº†ã€‚æ¯”å¦‚<code>k8s</code>ï¼Œä½†æˆ‘ä»¬ç›®å‰çš„å°é¡¹ç›®ä½¿ç”¨å®˜æ–¹è‡ªå¸¦çš„<code>Docker-compose</code>å·²ç»è¶³çŸ£ã€‚</p>
<p>é¦–å…ˆéœ€è¦<code>docker-compose.yml</code>é…ç½®æ–‡ä»¶ï¼Œæ¯”å¦‚ä¸‹é¢å°±æ˜¯ä¸¤ä¸ªå®¹å™¨çš„æ¨¡æ¿ï¼Œ<code>image</code>è¡¨ç¤ºä½¿ç”¨çš„é•œåƒï¼Œ<code>ports</code>åˆ™è¡¨ç¤ºç«¯å£æ˜ å°„ï¼Œ<code>volumes</code>åˆ™æ˜¯éœ€è¦æ˜ å°„çš„æ•°æ®å·ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">"3"</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">webapp:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">web</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">"8080:80"</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">"/data"</span></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">"redis:alpine"</span></span><br></pre></td></tr></table></figure>

<p>æ¥ç€å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è¡Œè¿›è¡Œæ“ä½œï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker-compose build [options] [SERVICE...] <span class="comment">#æ„å»ºï¼ˆé‡æ–°æ„å»ºï¼‰é¡¹ç›®ä¸­çš„æœåŠ¡å®¹å™¨</span></span><br><span class="line">docker-compose up -d <span class="comment"># è¿è¡Œ compose é¡¹ç›®,åå°æ‰§è¡Œ</span></span><br></pre></td></tr></table></figure>

<p><code>docker-compose up</code> æ˜¯ä¸ªéå¸¸å¼ºå¤§çš„å‘½ä»¤ï¼Œå®ƒå°†å°è¯•è‡ªåŠ¨å®ŒæˆåŒ…æ‹¬æ„å»ºé•œåƒï¼Œï¼ˆé‡æ–°ï¼‰åˆ›å»ºæœåŠ¡ï¼Œå¯åŠ¨æœåŠ¡ï¼Œå¹¶å…³è”æœåŠ¡ç›¸å…³å®¹å™¨çš„ä¸€ç³»åˆ—æ“ä½œã€‚é“¾æ¥çš„æœåŠ¡éƒ½å°†ä¼šè¢«è‡ªåŠ¨å¯åŠ¨ï¼Œé™¤éå·²ç»å¤„äºè¿è¡ŒçŠ¶æ€ã€‚å¯ä»¥è¯´ï¼Œå¤§éƒ¨åˆ†æ—¶å€™éƒ½å¯ä»¥ç›´æ¥é€šè¿‡è¯¥å‘½ä»¤æ¥å¯åŠ¨ä¸€ä¸ªé¡¹ç›®ã€‚</p>
<h2 id="æ„å»ºnginx-node-postgresé¡¹ç›®"><a href="#æ„å»ºnginx-node-postgresé¡¹ç›®" class="headerlink" title="æ„å»ºnginx-node-postgresé¡¹ç›®"></a>æ„å»ºnginx-node-postgresé¡¹ç›®</h2><p>æœ‰äº†ä¸Šé¢çš„åŸºç¡€ï¼Œæ¥ç€å°±å¯ä»¥æ„å»ºæˆ‘ä»¬è‡ªå·±çš„é¡¹ç›®äº†ï¼Œé¦–å…ˆæ˜¯<code>node</code>æœåŠ¡çš„<code>dockerfile</code>ï¼Œä¸»è¦åšäº†å¦‚ä¸‹æ­¥éª¤</p>
<ol>
<li>åˆ›å»ºå®¹å™¨å·¥ä½œç›®å½•</li>
<li>å¤åˆ¶ç›¸å…³é…ç½®æ–‡ä»¶åˆ°å®¹å™¨</li>
<li>åœ¨å®¹å™¨å®‰è£…<code>npm</code>åŒ…</li>
<li>è¿è¡Œ<code>pm2</code>å¯åŠ¨å®¹å™¨</li>
</ol>
<figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line"><span class="keyword">FROM</span> node:<span class="number">14.5</span>.<span class="number">0</span>-alpine3.<span class="number">12</span></span><br><span class="line"><span class="comment"># å·¥ä½œç›®å½•</span></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="bash"> /usr/src/app</span></span><br><span class="line"><span class="comment"># å¤åˆ¶é…ç½®æ–‡ä»¶</span></span><br><span class="line"><span class="keyword">COPY</span><span class="bash"> package*.json ./</span></span><br><span class="line"><span class="keyword">COPY</span><span class="bash"> process.yml ./</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> npm <span class="built_in">set</span> registry https://registry.npm.taobao.org/ \</span></span><br><span class="line"><span class="bash">  &amp;&amp; npm install pm2 -g \</span></span><br><span class="line"><span class="bash">  &amp;&amp; npm install</span></span><br><span class="line"><span class="comment"># ä½¿ç”¨pm2ç®¡ç†</span></span><br><span class="line"><span class="keyword">CMD</span><span class="bash"> [<span class="string">"pm2-runtime"</span>, <span class="string">"process.yml"</span>, <span class="string">"--only"</span>, <span class="string">"app"</span>, <span class="string">"--env"</span>, <span class="string">"production"</span>]</span></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">3010</span></span><br></pre></td></tr></table></figure>

<p>æ¥ç€é…ç½® <code>docker-compose.yml</code></p>
<ol>
<li>dbé…ç½®çš„æ˜¯æ•°æ®åº“<code>postgres</code>ï¼Œå…¶ä¸­æ•°æ®å· <code>volumes</code> æ˜ å°„äº†æ•°æ®åº“ç›®å½•å’Œåˆå§‹åŒ–è„šæ­¥</li>
<li>appé…ç½®çš„æ˜¯<code>node</code>æœåŠ¡ï¼Œå…¶ä¸­çš„<code>build</code>æ˜¯æ˜ å°„ä¸Šé¢<code>dockerfile</code>æ‰€åœ¨çš„ç›®å½•ï¼›<code>depends_on</code>è¡¨ç¤ºä¾èµ–çš„å®¹å™¨ã€å¯åŠ¨å…ˆåï¼Œè¿™é‡Œå…ˆå¯åŠ¨dbå†å¯åŠ¨<code>node</code>ï¼›<code>links</code>è¡¨ç¤ºå°†dbçš„åç§°æ˜ å°„åˆ°appå®¹å™¨</li>
<li>nginxå®¹å™¨<code>depend_on</code>äºappå®¹å™¨ï¼ŒåŒæ—¶é…ç½®è½¬å‘<code>node</code>çš„æœåŠ¡</li>
</ol>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">'3'</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">db:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">postgres:12.3-alpine</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">postgres</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">TZ=Asia/Shanghai</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">POSTGRES_PASSWORD=xxxx</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./postgres/data:/var/lib/postgresql/data</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./postgres/init:/docker-entrypoint-initdb.d</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">5432</span><span class="string">:5432</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span> <span class="comment">#å§‹ç»ˆé‡å¯,ç”Ÿäº§ç¯å¢ƒä¸­æ¨èé…ç½®ä¸º always</span></span><br><span class="line">    <span class="attr">expose:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">5432</span></span><br><span class="line">      </span><br><span class="line">  <span class="attr">app:</span> </span><br><span class="line">    <span class="attr">image:</span> <span class="string">koa-pg</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">koa</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./dist:/usr/src/app/dist</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./logs:/usr/src/app/logs</span></span><br><span class="line">    <span class="attr">build:</span> <span class="string">./</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">TZ=Asia/Shanghai</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">db</span></span><br><span class="line">    <span class="attr">links:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">db</span></span><br><span class="line">    <span class="attr">expose:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">3010</span></span><br><span class="line">      </span><br><span class="line">  <span class="attr">nginx:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">nginx:1.19.0-alpine</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">nginx</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./nginx.conf:/etc/nginx/nginx.conf</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">8080</span><span class="string">:80</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">TZ=Asia/Shanghai</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">app</span></span><br><span class="line">    <span class="attr">links:</span> <span class="comment"># hoståä»£æ›¿ipé…ç½®nginxçš„è½¬å‘</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">app</span></span><br><span class="line">    <span class="attr">expose:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">8080</span></span><br></pre></td></tr></table></figure>

<p>é…ç½®å®Œæˆ‘ä»¬çš„é¡¹ç›®ä¹‹åï¼Œæ¥ç€å°±æ˜¯è¿è¡Œèµ·æ¥</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker-compose up -d</span><br></pre></td></tr></table></figure>

<p>åœ¨æˆ‘ä»¬çš„æœ¬åœ°å¼€å‘æœºæ˜¯å¦‚æ­¤ï¼Œéƒ¨ç½²åˆ°æœåŠ¡å™¨ä¹Ÿæ˜¯å¦‚æ­¤ï¼Œä½ æƒ³è¦éƒ¨ç½²å‡ å°æœåŠ¡å™¨å°±éƒ¨ç½²å‡ å°ï¼Œåªè¦è£…äº†<code>docker</code>ï¼Œéƒ½æ˜¯ä¸€å¥å‘½ä»¤è¡Œå°±èƒ½è§£å†³çš„äº‹æƒ…ã€‚</p>
<p>è¦å¯åŠ¨å‡ ä¸ªå®¹å™¨ï¼Œä¿®æ”¹ä¸‹<code>docker-compose.yml</code>çš„é…ç½®ï¼Œå†æ¬¡<code>docker-compose up</code>ï¼Œso easy !</p>
</div>
    	
		<div class="post-footer">
			<div class="tags">
				<i class="icon-tags"></i> 
				
					
					
						
							<a href="/tags/koa/">koa</a>
						
					
						
							<a href="/tags/docker/">docker</a>
						
					
						
							<a href="/tags/nginx/">nginx</a>
						
					
						
							<a href="/tags/postgres/">postgres</a>
						
					
				
			</div>
			<a class="share" href="javascript:;" data-url="/2020/07/13/docker/" data-desc="å‰æ®µæ—¶é—´åšäº†ä¸ªnodeå…¨æ ˆé¡¹ç›®ï¼ŒæœåŠ¡ç«¯æŠ€æœ¯æ ˆæ˜¯ nginx + koa + postgresq..." data-type="share" title="share"><i class="icon-share"></i></a>
		</div>
	</div>
</article>
</div>
<nav class="pagination clearfix">
  
    
      
        <a href="/2020/09/17/webgldeferred/" class="prev post-prev"> <i class="icon-leftarrow"></i> WebGLä¹‹å»¶è¿Ÿç€è‰²</a>
      

      
        <a href="/2020/07/01/flutter2/" class="next post-next"> Flutterè½®æ’­å›¾ <i class="icon-rightarrow"></i></a>
      
    
  
</nav>

<div class="wxshare-popup">
    <a class="close" href="javascript:;"></a>
    <p>æ‰«ä¸€æ‰«ï¼Œåˆ†äº«åˆ°å¾®ä¿¡</p>
    <div id="qrcode" class="wx-qrcode"></div>
</div>

    
    <footer class="footer">
<p class="theme">
	Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/edwardzhong/simply.git" target="_blank" rel="noopener">simply</a>
</p>
<p class="copy">Copyright &copy; 2025 Jeff Zhong</p>
</footer>
    <div class="top-bottom">
      <div class="to-top hide" title="to top"><i class="icon-up"></i></div>
      <div class="to-bottom hide" title="to bottom"><i class="icon-down"></i></div>
    </div>
    </div>

  </div>
<input type="hidden" name="isPost" id="isPost" value="true">
<i id="barBtn" class="icon icon-menu"></i>
<div id="payMe" class="payme">
    <i class="icon icon-cancel"></i>
    <p class="pay-title">ç»™æˆ‘çš„æ—©é¤åŠ ä¸ªè›‹å§ ğŸ˜Š</p>
    <div>
      <img src="/images/weixinpay.jpg" alt="weixinpay">
      <img src="/images/alipay.jpg" alt="alipay" style="display:none;">
    </div>
    <div class="pay-selects">
        <input type="radio" name="pay" id="weixinpay" checked="checked"><label for="weixinpay"> å¾®ä¿¡ </label>&nbsp;&nbsp;
        <input type="radio" name="pay" id="alipay"><label for="alipay"> æ”¯ä»˜å® </label>
    </div>
</div>

  
  
    <script src="/lib/jquery-2.2.3.min.js"></script>
  
    <script src="/lib/qrcode.min.js"></script>
  
    <script src="/js/index.js"></script>
  

<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>

</body>
</html>
