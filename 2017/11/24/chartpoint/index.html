<!doctype html>
<html lang="zh-CN">










<head>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
  <!-- 优先使用 IE 最新版本和 Chrome -->
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
  <!-- 为移动设备添加 viewport -->
  <meta name="viewport" content="width=device-width,initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no">
  <!-- 添加到主屏后的标题（iOS 6 新增） -->
  <meta name="apple-mobile-web-app-title" content="canvas图表(4) - 散点图 - Jeff's world">
  <!-- 是否启用 WebApp 全屏模式，删除苹果默认的工具栏和菜单栏 -->
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <!-- 设置苹果工具栏颜色 -->
  <meta name="apple-mobile-web-app-status-bar-style" content = "black" />
  <!-- 添加智能 App 广告条 Smart App Banner（iOS 6+ Safari） -->
  <!-- <meta name = "apple-itunes-app" content = "app-id=myAppStoreID, affiliate-data=myAffiliateData, app-argument=myURL"> -->
  <!-- 忽略页面中的数字识别为电话，忽略email识别 -->
  <meta name="format-detection" content = "telphone=no, email=no" />
  <!--下面三个是清除缓存 微信浏览器缓存严重又无刷新；这个方法调试的时候很方便-->
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Cache-Control" content="no-cache">
  <meta http-equiv="Expires" content="0">
  
  <link rel="dns-prefetch" href="http://jeffzhong.space">
  <link rel="icon shortcut" type="image/ico" href="/favicon.ico">
  <meta name="author" content="Jeff Zhong">
  <meta name="description" content="it's a blog by hexo">
  <meta name="keywords" content="hexo theme">
  <title >canvas图表(4) - 散点图 - Jeff's world</title>
    <!-- The Open Graph protocol -->
  <meta property="og:url" content="http://jeffzhong.space">
  <meta property="og:type" content="blog">
  <meta property="og:title" content="canvas图表(4) - 散点图 - Jeff's world">
  <meta property="og:description" content="it's a blog by hexo">
  <!-- UC Browser Compatible -->
<!--   <script>
      var agent = navigator.userAgent.toLowerCase();
      if(agent.indexOf('ucbrowser')>0) {
          alert('由于 UC 浏览器使用极旧的内核，而本网站使用了一些新的特性。\n为了您能更好的浏览，推荐使用 Chrome 或 Firefox 浏览器。');
      }
  </script> -->
  
    
    
      <link rel="stylesheet" href="/lib/fontello/fontello.css?t=1">
    
      <link rel="stylesheet" href="/lib/reboto/roboto.css?t=1">
    
      <link rel="stylesheet" href="/dist/css/index.css?t=1">
    
  
  <script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?5255e97b442092b8e1a219e6a48a0d42";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>

</head>
<body>
<header class="header">
  <div class="top"></div>
  <h2>Jeff's World</h2>
  <h3>Things that I'm interested in</h3>
  <div class="menu">
  
  
  
      <a 
        href="/">
        <i class="icon icon-home"></i>
        主页
      </a>
  
      <a 
        href="http://jeffzhong.space/sites/demo/">
        <i class="icon icon-tag"></i>
        Demo
      </a>
  
      <a  data-tag="search" 
        href="javascript:;">
        <i class="icon icon-search"></i>
        搜索
      </a>
  
  </div>
  <div class="state">
  
    <a href="/archives">18<br>文章</a><a href="/categories">2<br>分类</a><a href="/tags">29<br>标签</a>
  </div>
  <div class="social">
  
  
  
      <a href="https://github.com/edwardzhong" title="Github"><i class="icon icon-github-circled"></i></a>
  
      <a href="https://twitter.com/JianfengEdward" title="Twitter"><i class="icon icon-twitter"></i></a>
  
      <a href="https://www.facebook.com/jianfeng.edward" title="Facebook"><i class="icon icon-facebook"></i></a>
  
      <a href="http://weibo.com/1593251850" title="Weibo"><i class="icon icon-weibo"></i></a>
  
      <a href="/atom.xml" title="Rss"><i class="icon icon-rss"></i></a>
  
  </div>
  <div id="payBtn" class="pay-icon" title="谢谢您的赞赏">赏</div>
</header>
  <div class="container">
    <div class="main">
    
        
<div class="post-list">
	<article class="post" style="animation:listshow 0.6s ease-out both 0.30000000000000004s">
    
    
        
    
	
	<a href="javascript:;">
        <div class="post-banner" style="background: url(http://oncse3u6r.bkt.clouddn.com/banner5.jpg)  center top / 100% no-repeat">
    		<h3 class="post-title">canvas图表(4) - 散点图</h3>
    	</div>
	</a>
	<div class="post-inner">
	
    	<div class="post-info">
    		<time class="icon icon-calendar"> 2017/11/24 03:53:00</time>
    		<span class="category">
    		
    			
    			<i class="icon icon-book"></i>
    			
                    
                        <a href="/categories/技术/">技术</a>
                    
        			
    			
    		
    		</span>
    	</div>
    	<!-- <p><p>&emsp;&emsp;今天开始完成散点图，做完这一节，我的canvas图表系列就算是完成了，毕竟平时最频繁用到的就是这几类图表了：柱状，折线，饼图，散点。经过编写canvas图表项目的实践，…</p>
</p> -->
    	
    	<div class="post-content"><!-- 原文地址：[canvas图表(4) - 散点图](http://jeffzhong.space/2017/11/24/chartpoint/) -->
<p>&emsp;&emsp;今天开始完成散点图，做完这一节，我的canvas图表系列就算是完成了，毕竟平时最频繁用到的就是这几类图表了：柱状，折线，饼图，散点。经过编写canvas图表项目的实践，我对canvas也做到了比较深入的理解，也是越来越喜欢计算机图形相关的知识了。接下来canvas的学习会告一段落，我会继续接着学习webGL，同时学习使用blender建立简单的3D模型。</p>
<p>本节效果请看：<em><a href="https://edwardzhong.github.io/sites/demo/dist/chartpoint.html" target="_blank" rel="external">散点气泡图http://jeffzhong.space/sites/demo/dist/chartpoint.html</a></em><br><!-- ![it](http://oncse3u6r.bkt.clouddn.com/chartpoint.jpg) --><br><img src="http://oncse3u6r.bkt.clouddn.com/chartpoint.jpg" width="480"><br><a id="more"></a></p>
<p>&emsp;&emsp;经过学习之前的<em><a href="http://jeffzhong.space/2017/11/23/chartpie/">其他图表</a></em>后，就会发现很多地方都是相似的，只是具体的细节有些区别，所以这次主要就是讲解散点图不同的部分，功能点包括： </p>
<ol>
<li>组织数据；</li>
<li>画面绘制；<br><strong>3. 数据动画的实现；</strong><br><strong>4. 位移坐标绘制</strong><br><strong>5. 鼠标事件的处理。</strong></li>
</ol>
<h2 id="使用方式"><a href="#使用方式" class="headerlink" title="使用方式"></a>使用方式</h2><p>&emsp;&emsp;用法基本跟柱状图和折线图类似，数据使用的是Echart的样例上的，但是它的数据格式太反人道了，我重新组织了数据格式，这样更符合我们的使用习惯。<br><figure class="highlight javascript"><table><tr><td class="code"><pre><div class="line"><span class="keyword">var</span> con=<span class="built_in">document</span>.getElementById(<span class="string">'container'</span>);</div><div class="line"><span class="keyword">var</span> point =<span class="keyword">new</span> Point(con);</div><div class="line">point.init(&#123;</div><div class="line">	title:<span class="string">'1990 与 2015 年各国家人均寿命与 GDP'</span>,</div><div class="line"> 	xAxis:&#123;</div><div class="line"> 		name:<span class="string">'GDP'</span>,</div><div class="line"> 		data:[<span class="number">10000</span>,<span class="number">20000</span>,<span class="number">30000</span>,<span class="number">40000</span>,<span class="number">50000</span>,<span class="number">60000</span>,<span class="number">70000</span>],</div><div class="line"> 		formatter:<span class="string">'$ &#123;value&#125;'</span></div><div class="line"> 	&#125;,</div><div class="line"> 	yAxis:&#123;</div><div class="line">		name:<span class="string">'AGE'</span></div><div class="line">	&#125;,</div><div class="line">	desc:&#123;</div><div class="line">		xVal:<span class="string">'gdp'</span>,</div><div class="line">		yVal:<span class="string">'age'</span>,</div><div class="line">		num:<span class="string">'number'</span></div><div class="line">	&#125;,</div><div class="line">	series:[&#123;</div><div class="line">		name:<span class="string">'1990'</span>,</div><div class="line">		data:[</div><div class="line">			&#123;<span class="attr">xVal</span>:<span class="number">28604</span>,<span class="attr">yVal</span>:<span class="number">77</span>,<span class="attr">num</span>:<span class="number">17096869</span>,<span class="attr">name</span>:<span class="string">'Australia'</span>&#125;,</div><div class="line">			&#123;<span class="attr">xVal</span>:<span class="number">31163</span>,<span class="attr">yVal</span>:<span class="number">77.4</span>,<span class="attr">num</span>:<span class="number">27662440</span>,<span class="attr">name</span>:<span class="string">'Canada'</span>&#125;,</div><div class="line">			&#123;<span class="attr">xVal</span>:<span class="number">1516</span>,<span class="attr">yVal</span>:<span class="number">68</span>,<span class="attr">num</span>:<span class="number">1154605773</span>,<span class="attr">name</span>:<span class="string">'China'</span>&#125;,</div><div class="line">			&#123;<span class="attr">xVal</span>:<span class="number">13670</span>,<span class="attr">yVal</span>:<span class="number">74.7</span>,<span class="attr">num</span>:<span class="number">10582082</span>,<span class="attr">name</span>:<span class="string">'Cuba'</span>&#125;,</div><div class="line">			&#123;<span class="attr">xVal</span>:<span class="number">28599</span>,<span class="attr">yVal</span>:<span class="number">75</span>,<span class="attr">num</span>:<span class="number">4986705</span>,<span class="attr">name</span>:<span class="string">'Finland'</span>&#125;,</div><div class="line">			&#123;<span class="attr">xVal</span>:<span class="number">29476</span>,<span class="attr">yVal</span>:<span class="number">77.1</span>,<span class="attr">num</span>:<span class="number">56943299</span>,<span class="attr">name</span>:<span class="string">'France'</span>&#125;,</div><div class="line">			&#123;<span class="attr">xVal</span>:<span class="number">31476</span>,<span class="attr">yVal</span>:<span class="number">75.4</span>,<span class="attr">num</span>:<span class="number">78958237</span>,<span class="attr">name</span>:<span class="string">'Germany'</span>&#125;,</div><div class="line">			&#123;<span class="attr">xVal</span>:<span class="number">28666</span>,<span class="attr">yVal</span>:<span class="number">78.1</span>,<span class="attr">num</span>:<span class="number">254830</span>,<span class="attr">name</span>:<span class="string">'Iceland'</span>&#125;,</div><div class="line">			&#123;<span class="attr">xVal</span>:<span class="number">1777</span>,<span class="attr">yVal</span>:<span class="number">57.7</span>,<span class="attr">num</span>:<span class="number">870601776</span>,<span class="attr">name</span>:<span class="string">'India'</span>&#125;,</div><div class="line">			&#123;<span class="attr">xVal</span>:<span class="number">29550</span>,<span class="attr">yVal</span>:<span class="number">79.1</span>,<span class="attr">num</span>:<span class="number">122249285</span>,<span class="attr">name</span>:<span class="string">'Japan'</span>&#125;,</div><div class="line">			&#123;<span class="attr">xVal</span>:<span class="number">2076</span>,<span class="attr">yVal</span>:<span class="number">67.9</span>,<span class="attr">num</span>:<span class="number">20194354</span>,<span class="attr">name</span>:<span class="string">'North Korea'</span>&#125;,</div><div class="line">			&#123;<span class="attr">xVal</span>:<span class="number">12087</span>,<span class="attr">yVal</span>:<span class="number">72</span>,<span class="attr">num</span>:<span class="number">42972254</span>,<span class="attr">name</span>:<span class="string">'South Korea'</span>&#125;,</div><div class="line">			&#123;<span class="attr">xVal</span>:<span class="number">24021</span>,<span class="attr">yVal</span>:<span class="number">75.4</span>,<span class="attr">num</span>:<span class="number">3397534</span>,<span class="attr">name</span>:<span class="string">'New Zealand'</span>&#125;,</div><div class="line">			&#123;<span class="attr">xVal</span>:<span class="number">43296</span>,<span class="attr">yVal</span>:<span class="number">76.8</span>,<span class="attr">num</span>:<span class="number">4240375</span>,<span class="attr">name</span>:<span class="string">'Norway'</span>&#125;,</div><div class="line">			&#123;<span class="attr">xVal</span>:<span class="number">10088</span>,<span class="attr">yVal</span>:<span class="number">70.8</span>,<span class="attr">num</span>:<span class="number">38195258</span>,<span class="attr">name</span>:<span class="string">'Poland'</span>&#125;,</div><div class="line">			&#123;<span class="attr">xVal</span>:<span class="number">19349</span>,<span class="attr">yVal</span>:<span class="number">69.6</span>,<span class="attr">num</span>:<span class="number">147568552</span>,<span class="attr">name</span>:<span class="string">'Russia'</span>&#125;,</div><div class="line">			&#123;<span class="attr">xVal</span>:<span class="number">10670</span>,<span class="attr">yVal</span>:<span class="number">67.3</span>,<span class="attr">num</span>:<span class="number">53994605</span>,<span class="attr">name</span>:<span class="string">'Turkey'</span>&#125;,</div><div class="line">			&#123;<span class="attr">xVal</span>:<span class="number">26424</span>,<span class="attr">yVal</span>:<span class="number">75.7</span>,<span class="attr">num</span>:<span class="number">57110117</span>,<span class="attr">name</span>:<span class="string">'United Kingdom'</span>&#125;,</div><div class="line">			&#123;<span class="attr">xVal</span>:<span class="number">37062</span>,<span class="attr">yVal</span>:<span class="number">75.4</span>,<span class="attr">num</span>:<span class="number">252847810</span>,<span class="attr">name</span>:<span class="string">'United States'</span>&#125;]</div><div class="line">		&#125;,</div><div class="line">		&#123;</div><div class="line">		name:<span class="string">'2015'</span>,</div><div class="line">		data:[</div><div class="line">			&#123;<span class="attr">xVal</span>:<span class="number">44056</span>,<span class="attr">yVal</span>:<span class="number">81.8</span>,<span class="attr">num</span>:<span class="number">23968973</span>,<span class="attr">name</span>:<span class="string">'Australia'</span>&#125;,</div><div class="line">		    &#123;<span class="attr">xVal</span>:<span class="number">43294</span>,<span class="attr">yVal</span>:<span class="number">81.7</span>,<span class="attr">num</span>:<span class="number">35939927</span>,<span class="attr">name</span>:<span class="string">'Canada'</span>&#125;,</div><div class="line">		    &#123;<span class="attr">xVal</span>:<span class="number">13334</span>,<span class="attr">yVal</span>:<span class="number">76.9</span>,<span class="attr">num</span>:<span class="number">1376048943</span>,<span class="attr">name</span>:<span class="string">'China'</span>&#125;,</div><div class="line">		    &#123;<span class="attr">xVal</span>:<span class="number">21291</span>,<span class="attr">yVal</span>:<span class="number">78.5</span>,<span class="attr">num</span>:<span class="number">11389562</span>,<span class="attr">name</span>:<span class="string">'Cuba'</span>&#125;,</div><div class="line">		    &#123;<span class="attr">xVal</span>:<span class="number">38923</span>,<span class="attr">yVal</span>:<span class="number">80.8</span>,<span class="attr">num</span>:<span class="number">5503457</span>,<span class="attr">name</span>:<span class="string">'Finland'</span>&#125;,</div><div class="line">		    &#123;<span class="attr">xVal</span>:<span class="number">37599</span>,<span class="attr">yVal</span>:<span class="number">81.9</span>,<span class="attr">num</span>:<span class="number">64395345</span>,<span class="attr">name</span>:<span class="string">'France'</span>&#125;,</div><div class="line">		    &#123;<span class="attr">xVal</span>:<span class="number">44053</span>,<span class="attr">yVal</span>:<span class="number">81.1</span>,<span class="attr">num</span>:<span class="number">80688545</span>,<span class="attr">name</span>:<span class="string">'Germany'</span>&#125;,</div><div class="line">		    &#123;<span class="attr">xVal</span>:<span class="number">42182</span>,<span class="attr">yVal</span>:<span class="number">82.8</span>,<span class="attr">num</span>:<span class="number">329425</span>,<span class="attr">name</span>:<span class="string">'Iceland'</span>&#125;,</div><div class="line">		    &#123;<span class="attr">xVal</span>:<span class="number">5903</span>,<span class="attr">yVal</span>:<span class="number">66.8</span>,<span class="attr">num</span>:<span class="number">1311050527</span>,<span class="attr">name</span>:<span class="string">'India'</span>&#125;,</div><div class="line">		    &#123;<span class="attr">xVal</span>:<span class="number">36162</span>,<span class="attr">yVal</span>:<span class="number">83.5</span>,<span class="attr">num</span>:<span class="number">126573481</span>,<span class="attr">name</span>:<span class="string">'Japan'</span>&#125;,</div><div class="line">		    &#123;<span class="attr">xVal</span>:<span class="number">1390</span>,<span class="attr">yVal</span>:<span class="number">71.4</span>,<span class="attr">num</span>:<span class="number">25155317</span>,<span class="attr">name</span>:<span class="string">'North Korea'</span>&#125;,</div><div class="line">		    &#123;<span class="attr">xVal</span>:<span class="number">34644</span>,<span class="attr">yVal</span>:<span class="number">80.7</span>,<span class="attr">num</span>:<span class="number">50293439</span>,<span class="attr">name</span>:<span class="string">'South Korea'</span>&#125;,</div><div class="line">		    &#123;<span class="attr">xVal</span>:<span class="number">34186</span>,<span class="attr">yVal</span>:<span class="number">80.6</span>,<span class="attr">num</span>:<span class="number">4528526</span>,<span class="attr">name</span>:<span class="string">'New Zealand'</span>&#125;,</div><div class="line">		    &#123;<span class="attr">xVal</span>:<span class="number">64304</span>,<span class="attr">yVal</span>:<span class="number">81.6</span>,<span class="attr">num</span>:<span class="number">5210967</span>,<span class="attr">name</span>:<span class="string">'Norway'</span>&#125;,</div><div class="line">		    &#123;<span class="attr">xVal</span>:<span class="number">24787</span>,<span class="attr">yVal</span>:<span class="number">77.3</span>,<span class="attr">num</span>:<span class="number">38611794</span>,<span class="attr">name</span>:<span class="string">'Poland'</span>&#125;,</div><div class="line">		    &#123;<span class="attr">xVal</span>:<span class="number">23038</span>,<span class="attr">yVal</span>:<span class="number">73.13</span>,<span class="attr">num</span>:<span class="number">143456918</span>,<span class="attr">name</span>:<span class="string">'Russia'</span>&#125;,</div><div class="line">		    &#123;<span class="attr">xVal</span>:<span class="number">19360</span>,<span class="attr">yVal</span>:<span class="number">76.5</span>,<span class="attr">num</span>:<span class="number">78665830</span>,<span class="attr">name</span>:<span class="string">'Turkey'</span>&#125;,</div><div class="line">		    &#123;<span class="attr">xVal</span>:<span class="number">38225</span>,<span class="attr">yVal</span>:<span class="number">81.4</span>,<span class="attr">num</span>:<span class="number">64715810</span>,<span class="attr">name</span>:<span class="string">'United Kingdom'</span>&#125;,</div><div class="line">		    &#123;<span class="attr">xVal</span>:<span class="number">53354</span>,<span class="attr">yVal</span>:<span class="number">79.1</span>,<span class="attr">num</span>:<span class="number">321773631</span>,<span class="attr">name</span>:<span class="string">'United States'</span>&#125;]</div><div class="line">	&#125;]</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<h2 id="数据动画"><a href="#数据动画" class="headerlink" title="数据动画"></a>数据动画</h2><p>&emsp;&emsp;清除屏幕，然后重绘，实现动画效果。实现了气泡半径的缩放和气泡的位移动画，为了更加的美观，气泡使用了径向渐变createRadialGradient和阴影shadow，之前已经介绍过，不再详述。要注意的是，要谨慎使用阴影特性，因为它挺消耗性能，数据量一大，会卡的不要不要的😅<br><figure class="highlight javascript"><table><tr><td class="code"><pre><div class="line">animate()&#123;</div><div class="line">	<span class="keyword">var</span> that=<span class="keyword">this</span>,</div><div class="line">		ctx=<span class="keyword">this</span>.ctx,</div><div class="line">		item,obj,h,r,isStop=<span class="literal">true</span>;</div><div class="line">	(<span class="function"><span class="keyword">function</span> <span class="title">run</span>(<span class="params"></span>)</span>&#123;</div><div class="line">		ctx.save();</div><div class="line">		<span class="comment">//清屏</span></div><div class="line">		ctx.clearRect(<span class="number">0</span>,<span class="number">0</span>,that.W,that.H);</div><div class="line">		<span class="comment">// 画坐标系</span></div><div class="line">		that.drawAxis();</div><div class="line">		<span class="comment">// 画标签</span></div><div class="line">		that.drawTag();</div><div class="line">		<span class="comment">// 画y轴刻度</span></div><div class="line">		that.drawY();</div><div class="line">		ctx.translate(that.padding,that.H-that.padding);</div><div class="line">		ctx.shadowBlur=<span class="number">1</span>;</div><div class="line">		isStop=<span class="literal">true</span>;</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>,l=that.animateArr.length;i&lt;l;i++)&#123;</div><div class="line">			item=that.animateArr[i];</div><div class="line">			<span class="keyword">if</span>(item.hide)<span class="keyword">continue</span>;</div><div class="line"></div><div class="line">			item.isStop=<span class="literal">true</span>;</div><div class="line">			ctx.strokeStyle=item.color;</div><div class="line">			ctx.shadowColor=item.color;</div><div class="line">			</div><div class="line">			<span class="keyword">for</span>(<span class="keyword">var</span> j=<span class="number">0</span>,jl=item.data.length;j&lt;jl;j++)&#123;</div><div class="line">				obj=item.data[j];</div><div class="line">				<span class="keyword">var</span> gradient=ctx.createRadialGradient(obj.x,-obj.h,<span class="number">0</span>,obj.x,-obj.h,obj.radius);</div><div class="line">				gradient.addColorStop(<span class="number">0</span>,<span class="string">'hsla('</span>+item.hsl+<span class="string">',70%,80%,0.7)'</span>);</div><div class="line">				gradient.addColorStop(<span class="number">1</span>,<span class="string">'hsla('</span>+item.hsl+<span class="string">',70%,60%,0.7)'</span>);</div><div class="line">				ctx.fillStyle=gradient;</div><div class="line">				ctx.beginPath();</div><div class="line">				<span class="keyword">if</span>(obj.r&gt;obj.radius)&#123;</div><div class="line">					r=obj.r-obj.v;</div><div class="line">					<span class="keyword">if</span>(r&lt;obj.radius)&#123;</div><div class="line">						obj.r=obj.radius;</div><div class="line">					&#125;</div><div class="line">				&#125; <span class="keyword">else</span> &#123;</div><div class="line">					r=obj.r+obj.v;</div><div class="line">					<span class="keyword">if</span>(r&gt;obj.radius)&#123;</div><div class="line">						obj.r=obj.radius;</div><div class="line">					&#125;</div><div class="line">				&#125;</div><div class="line">				<span class="keyword">if</span>(obj.r!=obj.radius)&#123;</div><div class="line">					obj.r=r;</div><div class="line">					item.isStop=<span class="literal">false</span>;</div><div class="line">				&#125;</div><div class="line">				<span class="keyword">if</span>(obj.p&gt;obj.h)&#123;</div><div class="line">					h=obj.y<span class="number">-4</span>;</div><div class="line">					<span class="keyword">if</span>(h&lt;obj.h)&#123;</div><div class="line">						obj.y=obj.p=obj.h;</div><div class="line">					&#125;</div><div class="line">				&#125; <span class="keyword">else</span> &#123;</div><div class="line">					h=obj.y+<span class="number">4</span>;</div><div class="line">					<span class="keyword">if</span>(h&gt;obj.h)&#123;</div><div class="line">						obj.y=obj.p=obj.h;</div><div class="line">					&#125;</div><div class="line">				&#125;</div><div class="line">				<span class="keyword">if</span>(obj.y!=obj.h)&#123;</div><div class="line">					obj.y=h;</div><div class="line">					item.isStop=<span class="literal">false</span>;</div><div class="line">				&#125;</div><div class="line">				ctx.arc(obj.x,-obj.y,obj.r,<span class="number">0</span>,<span class="built_in">Math</span>.PI*<span class="number">2</span>,<span class="literal">false</span>);</div><div class="line">				ctx.fill();</div><div class="line">				ctx.stroke();</div><div class="line">			&#125;</div><div class="line">			<span class="keyword">if</span>(!item.isStop)&#123;isStop=<span class="literal">false</span>; &#125;</div><div class="line">		&#125;</div><div class="line">		ctx.restore();</div><div class="line">		<span class="keyword">if</span>(isStop)&#123;<span class="keyword">return</span>;&#125;</div><div class="line">		requestAnimationFrame(run);</div><div class="line">	&#125;());</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="位移坐标绘制"><a href="#位移坐标绘制" class="headerlink" title="位移坐标绘制"></a>位移坐标绘制</h2><p>&emsp;&emsp;比较有特色和有意思的是，根据鼠标位置在画板中实时绘制虚线十字架，同时在x轴y轴显示该点对应的数值信息。</p>
<p>&emsp;&emsp;我首先设置了8像素的间隔，然后间隔使用moveTo和lineTo绘制坐标，分别绘制了y轴和x轴的虚线，同时根据坐标点计算出该位置对应的数值，并将它们绘制到x轴和y轴上面。<br><img src="http://oncse3u6r.bkt.clouddn.com/chartpoint2.jpg" alt="it"><br><figure class="highlight javascript"><table><tr><td class="code"><pre><div class="line">drawLine(pos)&#123;</div><div class="line">	<span class="keyword">var</span> that=<span class="keyword">this</span>,</div><div class="line">		ctx=that.ctx,</div><div class="line">		padding=<span class="keyword">this</span>.padding,</div><div class="line">		xmax=<span class="keyword">this</span>.xAxis.data.slice(<span class="number">-1</span>)[<span class="number">0</span>],</div><div class="line">		xdis=<span class="keyword">this</span>.W-padding*<span class="number">2</span>,</div><div class="line">		ymin=<span class="keyword">this</span>.info.min,</div><div class="line">		ymax=<span class="keyword">this</span>.info.max,</div><div class="line">		ydis=<span class="keyword">this</span>.H-padding*<span class="number">2</span>-<span class="keyword">this</span>.paddingTop,</div><div class="line">		yNum,xNum,space=<span class="number">8</span>;</div><div class="line">	</div><div class="line">	ctx.save();</div><div class="line">	ctx.lineWidth=<span class="number">0.5</span>;</div><div class="line">	ctx.strokeStyle=<span class="string">'hsla(0,0%,30%,1)'</span>;</div><div class="line">	<span class="comment">// 绘制虚线十字坐标</span></div><div class="line">	ctx.beginPath();</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i*space&lt;=xdis;i++)&#123;</div><div class="line">		ctx[i%<span class="number">2</span>?<span class="string">'lineTo'</span>:<span class="string">'moveTo'</span>](padding+i*space,pos.y*<span class="number">2</span>);</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i*space&lt;=ydis;i++)&#123;</div><div class="line">		ctx[i%<span class="number">2</span>?<span class="string">'lineTo'</span>:<span class="string">'moveTo'</span>](pos.x*<span class="number">2</span>,padding+that.paddingTop+i*space);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	ctx.stroke();</div><div class="line"></div><div class="line">	<span class="comment">// 绘制在xy轴对应的数值</span></div><div class="line">	ctx.fillStyle=<span class="string">'hsla(0,0%,30%,1)'</span>;</div><div class="line">	ctx.fillRect(padding<span class="number">-75</span>,pos.y*<span class="number">2</span><span class="number">-20</span>,<span class="number">70</span>,<span class="number">36</span>);</div><div class="line">	ctx.fillRect(pos.x*<span class="number">2</span><span class="number">-55</span>,that.H-padding+<span class="number">10</span>,<span class="number">110</span>,<span class="number">40</span>);</div><div class="line">	yNum=<span class="built_in">Math</span>.round((ymin+(that.H-padding-pos.y*<span class="number">2</span>)/ydis*(ymax-ymin))*<span class="number">100</span>)/<span class="number">100</span>;</div><div class="line">	xNum=<span class="built_in">Math</span>.round((pos.x*<span class="number">2</span>-padding)/xdis*xmax*<span class="number">100</span>)/<span class="number">100</span>;</div><div class="line"></div><div class="line">	ctx.font=<span class="string">'22px arial'</span>;</div><div class="line">	ctx.textAlign=<span class="string">'center'</span>;</div><div class="line">	ctx.textBaseLine=<span class="string">'middle'</span>;</div><div class="line">	ctx.fillStyle=<span class="string">'hsla(0,0%,100%,1)'</span>;</div><div class="line">	ctx.fillText(yNum,padding<span class="number">-40</span>,pos.y*<span class="number">2</span>+<span class="number">5</span>);</div><div class="line">	ctx.fillText(xNum,pos.x*<span class="number">2</span>,that.H-padding+<span class="number">40</span>);</div><div class="line">	ctx.restore();</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="事件处理"><a href="#事件处理" class="headerlink" title="事件处理"></a>事件处理</h2><p>&emsp;&emsp;mousemove的时候，如果位置在标签上和在图表画面上时，变为手形图标。滑过画板内容的时候，还要判断是否在某个气泡上面，如果是则用浮层显示该气泡对应的内容，同时前置该气泡并用scale放大。接着还要绘制该点的虚线十字架并在xy轴绘制对应数值。</p>
<p>&emsp;&emsp;mousedown某个击标签就会显示隐藏对应分类，每次触发就会看到气泡的半径变化和位移的动画效果。</p>
<p>&emsp;&emsp;事件相关内容具体实现可参考<em><a href="http://jeffzhong.space/2017/11/23/chartpie/">canvas图表(3) - 饼图</a></em></p>
<h2 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h2><p>&emsp;&emsp;所有图表代码请看<em><a href="https://github.com/edwardzhong/html5Canvas/blob/master/chart/chart.js" target="_blank" rel="external">chart.js</a></em></p>
</div>
    	
		<div class="post-footer">
			<div class="share" data-url="/2017/11/24/chartpoint/" data-desc="
&emsp;&emsp;今天开始完成散点图，做完这一节，我的canvas图表系列就算是完成了..."><a href="javascript:;" data-type="share" class="icon icon-share"> 分享</a></div>
			<div class="tags">
			<i class="icon icon-tag"></i> 
			
				
				
                    
                        <a href="/tags/前端/">前端</a>
                    
				
                    
                        <a href="/tags/js/">js</a>
                    
				
                    
                        <a href="/tags/canvas/">canvas</a>
                    
				
			
			</div>
		</div>
	</div>
</article>
</div>

<nav class="pagination clearfix">
  
    
      
      <a href="/2017/11/27/projecttemplate/" class="prev post-prev">&larr; 前端快速开发模版</a>
      

      
      <a href="/2017/11/23/chartpie/" class="next post-next">canvas图表(3) - 饼图 &rarr;</a>
      
    
  
</nav>

<div class="wxshare-popup">
    <a class="close" href="javascript:;"><i class="icon icon-cancel"></i></a>
    <p>扫一扫，分享到微信</p>
    <div id="qrcode" class="wx-qrcode"></div>
</div>

    
    <footer class="footer">
<p class="theme">
	Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/edwardzhong/simply.git">simply</a>
</p>
<p class="copy">Copyright &copy; 2018 Jeff Zhong</p>
</footer>
    <div class="top-bottom">
      <div class="to-top hide" title="to top"><i class="icon icon-up-open"></i></div>
      <div class="to-bottom hide" title="to bottom"><i class="icon icon-down-open"></i></div>
    </div>
    </div>

  </div>
<input type="hidden" name="isPost" id="isPost" value="true">
<i id="barBtn" class="icon icon-menu"></i>
<div id="payMe" class="payme">
    <i class="icon icon-cancel"></i>
    <p class="pay-title">给我的早餐加个蛋吧 <i class="icon icon-smile"></i></p>
    <div>
      <img src="/img/weixinpay.jpg" alt="weixinpay">
      <img src="/img/alipay.jpg" alt="alipay" style="display:none;">
    </div>
    <div class="pay-selects">
        <input type="radio" name="pay" id="weixinpay" checked="checked"><label for="weixinpay"> 微信 </label>&nbsp;&nbsp;
        <input type="radio" name="pay" id="alipay"><label for="alipay"> 支付宝 </label>
    </div>
</div>

  
  
    <script src="/lib/jquery-2.2.3.min.js"></script>
  
    <script src="/lib/qrcode.min.js"></script>
  
    <script src="/dist/js/index.js"></script>
  

<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


</body>
</html>
