<!doctype html>
<html lang="zh-CN">









<head>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
  <!-- ä¼˜å…ˆä½¿ç”¨ IE æœ€æ–°ç‰ˆæœ¬å’Œ Chrome -->
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
  <!-- ä¸ºç§»åŠ¨è®¾å¤‡æ·»åŠ  viewport -->
  <meta name="viewport" content="width=device-width,initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no">
  <!-- æ·»åŠ åˆ°ä¸»å±åçš„æ ‡é¢˜ï¼ˆiOS 6 æ–°å¢ï¼‰ -->
  <meta name="apple-mobile-web-app-title" content="WebGLå­¦ä¹ (1) - ä¸‰è§’å½¢ - Jeff's world">
  <!-- æ˜¯å¦å¯ç”¨ WebApp å…¨å±æ¨¡å¼ï¼Œåˆ é™¤è‹¹æœé»˜è®¤çš„å·¥å…·æ å’Œèœå•æ  -->
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <!-- è®¾ç½®è‹¹æœå·¥å…·æ é¢œè‰² -->
  <meta name="apple-mobile-web-app-status-bar-style" content = "black" />
  <!-- æ·»åŠ æ™ºèƒ½ App å¹¿å‘Šæ¡ Smart App Bannerï¼ˆiOS 6+ Safariï¼‰ -->
  <!-- <meta name = "apple-itunes-app" content = "app-id=myAppStoreID, affiliate-data=myAffiliateData, app-argument=myURL"> -->
  <!-- å¿½ç•¥é¡µé¢ä¸­çš„æ•°å­—è¯†åˆ«ä¸ºç”µè¯ï¼Œå¿½ç•¥emailè¯†åˆ« -->
  <meta name="format-detection" content = "telphone=no, email=no" />
  <!--ä¸‹é¢ä¸‰ä¸ªæ˜¯æ¸…é™¤ç¼“å­˜ å¾®ä¿¡æµè§ˆå™¨ç¼“å­˜ä¸¥é‡åˆæ— åˆ·æ–°ï¼›è¿™ä¸ªæ–¹æ³•è°ƒè¯•çš„æ—¶å€™å¾ˆæ–¹ä¾¿-->
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Cache-Control" content="no-cache">
  <meta http-equiv="Expires" content="0">
  
  <link rel="dns-prefetch" href="https://jeff_zhong.gitee.io/blog">
  <link rel="icon shortcut" type="image/ico" href="/favicon.ico">
  <meta name="author" content="Jeff Zhong">
  <meta name="description" content="it's a blog by hexo">
  <meta name="keywords" content="hexo theme">
  <title >WebGLå­¦ä¹ (1) - ä¸‰è§’å½¢ - Jeff's world</title>
    <!-- The Open Graph protocol -->
  <meta property="og:url" content="https://jeff_zhong.gitee.io/blog">
  <meta property="og:type" content="blog">
  <meta property="og:title" content="WebGLå­¦ä¹ (1) - ä¸‰è§’å½¢ - Jeff's world">
  <meta property="og:description" content="it's a blog by hexo">
  
    
    
      <link rel="stylesheet" href="/blog/lib/fontello/fontello.css">
    
      <link rel="stylesheet" href="/blog/lib/reboto/roboto.css">
    
      <link rel="stylesheet" href="/blog/css/index.css">
    
  
  <script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?5255e97b442092b8e1a219e6a48a0d42";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>

<meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/blog/atom.xml" title="Jeff's world" type="application/atom+xml">
</head>
<body>
<header class="header">
  <div class="top"></div>
  <h2>Jeff's World</h2>
  <h3>Things that I'm interested in</h3>
  <div class="menu">
  
  
  
      <a  href="/blog/" title="ä¸» é¡µ">
        <i class="icon-home"></i>
        <span>ä¸» é¡µ</span>
      </a>
  
      <a  href="https://jeff_zhong.gitee.io/demo/" title="Demo">
        <i class="icon-page"></i>
        <span>Demo</span>
      </a>
  
      <a  data-tag="search"  href="javascript:;" title="æœ ç´¢">
        <i class="icon-search"></i>
        <span>æœ ç´¢</span>
      </a>
  
  </div>
  <div class="state">
  
    <a href="/blog/archives">48<br>æ–‡ ç« </a><a href="/blog/categories">2<br>åˆ† ç±»</a><a href="/blog/tags">64<br>æ ‡ ç­¾</a>
  </div>
  <div class="social">
  
  
  
      <a href="https://github.com/edwardzhong" target="_blank" rel="noopener" title="Github"><i class="icon-github"></i></a>
  
      <a href="https://twitter.com/JianfengEdward" target="_blank" rel="noopener" title="Twitter"><i class="icon-twitter"></i></a>
  
      <a href="https://www.facebook.com/jianfeng.edward" target="_blank" rel="noopener" title="Facebook"><i class="icon-facebook"></i></a>
  
      <a href="http://weibo.com/1593251850" target="_blank" rel="noopener" title="Weibo"><i class="icon-weibo"></i></a>
  
      <a href="/blog/atom.xml" title="Rss"><i class="icon-rss"></i></a>
  
  </div>
  <div id="payBtn" class="pay-icon" title="è°¢è°¢æ‚¨çš„èµèµ">èµ</div>
</header>
  <div class="container">
    <div class="main">
    
        
<div class="post-list">
	<article class="post" style="animation:listshow 0.6s ease-out both 0.30000000000000004s">
    
    
        
    
	
	<a href="javascript:;">
        <div class="post-banner" style="background: url(/blog/images/banner3.jpg)  center top / 100% no-repeat">
    		<h3 class="post-title">WebGLå­¦ä¹ (1) - ä¸‰è§’å½¢</h3>
    	</div>
	</a>
	<div class="post-inner">
	
    	<div class="post-info">
    		<time><i class="icon-calendar"></i> 2017/11/08 16:35:00</time>
    		<span class="category">
    		
    			
    			<i class="icon-book"></i>
    			
                    
                        <a href="/blog/categories/%E6%8A%80%E6%9C%AF/">æŠ€æœ¯</a>
                    
    			
    		
    		</span>
    	</div>
    	<!-- <p><p>è¿˜è®°å¾—ç¬¬ä¸€æ¬¡çœ‹åˆ°canvasçš„ç²’å­ç‰¹æ•ˆçš„æ—¶å€™ï¼ŒçœŸçš„æŠŠæˆ‘ç»™æƒŠè‰³åˆ°äº†ï¼ŒåŸæ¥åœ¨æµè§ˆå™¨ä¹Ÿèƒ½åšå‡ºè¿™ä¹ˆæ£’çš„æ•ˆæœã€‚ç»“åˆã€ŠHTML5 Canvasæ ¸å¿ƒæŠ€æœ¯ã€‹å’Œç½‘ä¸Šçš„æ•™ç¨‹ï¼Œç»è¿‡åŠå¹´æ–­æ–­ç»­ç»­çš„å­¦ä¹ ï¼Œå¯¹canvaâ€¦</p>
</p> -->
    	
    		<div class="post-content"><!-- åŸæ–‡åœ°å€ï¼š[WebGLå­¦ä¹ (1) - ä¸‰è§’å½¢](https://jeff_zhong.gitee.io/blog/2017/11/08/webgl/) -->

<p>è¿˜è®°å¾—ç¬¬ä¸€æ¬¡çœ‹åˆ°canvasçš„ç²’å­ç‰¹æ•ˆçš„æ—¶å€™ï¼ŒçœŸçš„æŠŠæˆ‘ç»™æƒŠè‰³åˆ°äº†ï¼ŒåŸæ¥åœ¨æµè§ˆå™¨ä¹Ÿèƒ½åšå‡ºè¿™ä¹ˆæ£’çš„æ•ˆæœã€‚ç»“åˆã€ŠHTML5 Canvasæ ¸å¿ƒæŠ€æœ¯ã€‹å’Œç½‘ä¸Šçš„æ•™ç¨‹ï¼Œç»è¿‡åŠå¹´æ–­æ–­ç»­ç»­çš„å­¦ä¹ ï¼Œå¯¹canvasçš„å­¦ä¹ ç»ˆäºå®Œç»“ï¼Œå¯¹å¸¸ç”¨çš„canvasç‰¹æ•ˆåŸºæœ¬èƒ½åšåˆ°ä¿¡æ‰‹æ‹ˆæ¥çš„ã€‚canvasç‰¹æ•ˆè¯·çœ‹ï¼š<em><a href="https://jeff_zhong.gitee.io/demo/">æ ·ä¾‹åˆ—è¡¨</a></em></p>
<p>ä¼—æ‰€å‘¨çŸ¥ï¼Œcanvasæ˜¯2Dç»˜å›¾æŠ€æœ¯ï¼Œè™½ç„¶å¯ä»¥é€šè¿‡åæ ‡å˜æ¢ï¼Œä½ç½®è®¡ç®—ä¹Ÿèƒ½åšåˆ°3Dçš„æ•ˆæœã€‚ä½†3Dåœºæ™¯æ•°æ®é‡æ¯•ç«Ÿæ¯”2Dè¦é«˜ä¸€ä¸ªæ•°é‡çº§çš„ï¼Œçº¯ç²¹ç”¨canvasçš„è¯ï¼Œä¸ç®¡æ˜¯æ€§èƒ½å’Œå¼€å‘çš„å¤æ‚åº¦ä¼šæˆä¸ºä¸€ä¸ªç“¶é¢ˆã€‚</p>
<p>è¿™ä¹Ÿæ˜¯webGLå‡ºç°çš„åŸå› ï¼Œè§£å†³webç«¯3Dæ¸²æŸ“çš„åœºæ™¯ã€‚webGLä¼šè°ƒç”¨åˆ°GPUï¼Œå¤„ç†å¤§é‡é‡å¤çš„3Dåœºæ™¯æ•°æ®æ—¶ï¼Œæ€§èƒ½éå¸¸æœ‰ä¼˜åŠ¿ã€‚åŒæ—¶webGLæ˜¯åŸºäºopenGL ES 2.0ï¼Œ å› æ­¤å®ƒå¤„ç†3Dåœºæ™¯æ˜¯éå¸¸æˆç†Ÿçš„ã€‚ä½†ä¸ºä»€ä¹ˆä¸ç›´æ¥å­¦ä¹ three.jså‘¢ï¼Ÿå› ä¸ºæœ¬äººå¯¹å›¾å½¢å­¦æ„Ÿå…´è¶£ï¼Œåªæ˜¯å¸Œæœ›åšä¸€äº›è‡ªå·±å–œæ¬¢çš„æ•ˆæœçš„åŒæ—¶æ·±å…¥äº†è§£è®¡ç®—æœºå›¾å½¢å­¦ï¼Œæ²¡æŒ‡æœ›é€šè¿‡å®ƒåšå•†ä¸šé¡¹ç›®ã€‚</p>
<p>ä¸ºäº†è®©å­¦ä¹ æ›´æœ‰åŠ¨åŠ›å’Œç›®çš„æ€§ï¼Œæˆ‘ä»¬ä»¥å®ä¾‹ä¸ºå¯¼å‘å­¦ä¹ webGLï¼Œå†ä»ä¸­å±•å¼€åˆ°éœ€è¦å­¦ä¹ å“ªäº›çŸ¥è¯†ç‚¹ã€‚è¿™æ¬¡æˆ‘ä»¬æ¥å®ç°å¦‚ä¸‹çš„åŠ¨ç”»ï¼Œè¯¥æ•™ç¨‹å‚è€ƒäº†ã€ŠWebGLç¼–ç¨‹æŒ‡å—ã€‹</p>
<p>å®é™…æ•ˆæœè¯·çœ‹ï¼š<em><a href="https://jeff_zhong.gitee.io/demo/dist/webgl.html">æ—‹è½¬çš„ä¸‰è§’å½¢</a></em><br><img src="/blog/images/trianrotate.gif" width="200"></p>
<a id="more"></a>

<h2 id="webGLæ¸²æŸ“æµç¨‹"><a href="#webGLæ¸²æŸ“æµç¨‹" class="headerlink" title="webGLæ¸²æŸ“æµç¨‹"></a>webGLæ¸²æŸ“æµç¨‹</h2><p>webGLçš„æ¸²æŸ“æµç¨‹å¦‚ä¸‹ï¼Œå…¶ä¸­ç¬¬2ï¼Œ3ï¼Œ4æ­¥æ˜¯é‡ç‚¹ï¼Œé‡Œé¢ç»†èŠ‚æ¯”è¾ƒå¤šã€‚æ¥ç€æˆ‘ä»¬å°±æŒ‰è¿™ä¸ªæµç¨‹ä¸€æ­¥ä¸€æ­¥è§£å†³é—®é¢˜</p>
<ol>
<li>è·å–webGLç»˜å›¾ä¸Šä¸‹æ–‡</li>
<li>åˆå§‹åŒ–ç€è‰²å™¨</li>
<li>åˆ›å»ºã€ç»‘å®šç¼“å†²åŒºå¯¹è±¡</li>
<li>å‘é¡¶ç‚¹ç€è‰²å™¨å’Œç‰‡å…ƒç€è‰²å™¨å†™å…¥æ•°æ®</li>
<li>è®¾ç½®canvasèƒŒæ™¯è‰²ï¼Œæ¸…ç©ºcanvas</li>
<li>ç»˜åˆ¶</li>
</ol>
<h2 id="webGLç»˜å›¾ä¸Šä¸‹æ–‡"><a href="#webGLç»˜å›¾ä¸Šä¸‹æ–‡" class="headerlink" title="webGLç»˜å›¾ä¸Šä¸‹æ–‡"></a>webGLç»˜å›¾ä¸Šä¸‹æ–‡</h2><p>webGLæ˜¯canvasåŸºç¡€ä¹‹ä¸Šçš„3Dç»˜å›¾æŠ€æœ¯ï¼Œåªæ˜¯ä¸Šä¸‹æ–‡ä¸åŒï¼Œget3DContextå‡½æ•°ä½œç”¨å°±æ˜¯ä¾æ¬¡é™çº§è·å–ä¸Šä¸‹æ–‡ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> canvas = <span class="built_in">document</span>.getElementById(<span class="string">"canvas"</span>),</span><br><span class="line">    gl = get3DContext(canvas, <span class="literal">true</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">get3DContext</span>(<span class="params">canvas, opt</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> names = [<span class="string">"webgl"</span>, <span class="string">"experimental-webgl"</span>, <span class="string">"webkit-3d"</span>, <span class="string">"moz-webgl"</span>];</span><br><span class="line">    <span class="keyword">var</span> context = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, len = names.length; i &lt; len; i++) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            context = canvas.getContext(names[i], opt);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (e) &#123;&#125;</span><br><span class="line">        <span class="keyword">if</span> (context) &#123;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> context;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="ç€è‰²å™¨"><a href="#ç€è‰²å™¨" class="headerlink" title="ç€è‰²å™¨"></a>ç€è‰²å™¨</h2><p>ç€è‰²å™¨å°±æ˜¯åµŒå…¥åˆ°jsä¸­çš„webGLä»£ç ï¼Œæ˜¯ç”±GLSLè¯­è¨€ç¼–å†™çš„ï¼Œå¯ä»¥æŠŠç€è‰²å™¨çœ‹æˆæ˜¯jsä»£ç è¿æ¥webGLçš„ä¸­é—´ä»¶ã€‚é¡¶ç‚¹ç€è‰²å™¨å’Œç‰‡å…ƒç€è‰²å™¨åˆ†åˆ«ç”¨äºæ“ä½œé¡¶ç‚¹å’Œé¢œè‰²å…‰ç…§ï¼Œã€ŠWebGLç¼–ç¨‹æŒ‡å—ã€‹ä¸­æ˜¯æŠŠç€è‰²å™¨å†™æˆå­—ç¬¦ä¸²ï¼Œä½†ä»å¯ç»´æŠ¤æ€§è€ƒè™‘ï¼Œè¿˜æ˜¯å†™åœ¨scriptæ ‡ç­¾ä¸­æ¯”è¾ƒå¥½ã€‚GLSLè¯­è¨€ä¸Cè¯­è¨€éå¸¸åƒï¼Œåªè¦ç†Ÿæ‚‰äº†GLSLç‰¹æœ‰çš„éƒ¨åˆ†ï¼Œå…¶å®è¿˜æ˜¯æ¯”è¾ƒç®€å•çš„ã€‚</p>
<p><strong>é™å®šç¬¦</strong><br>é™å®šç¬¦åªèƒ½ç”¨äºå…¨å±€å˜é‡ï¼Œæœ‰3ç§ç±»å‹ï¼š</p>
<ul>
<li>attributeç”¨äºè¡¨ç¤ºé¡¶ç‚¹ä¿¡æ¯</li>
<li>uniformç”¨äºè¡¨ç¤ºé™¤é¡¶ç‚¹å¤–çš„å…¶ä»–ä¿¡æ¯ï¼Œå¯ä»¥æ˜¯é™¤ç»“æ„ä½“å’Œæ•°ç»„ä¹‹å¤–çš„ä»»æ„ç±»å‹</li>
<li>varyingç”¨äºé¡¶ç‚¹ç€è‰²å™¨å‘ç‰‡å…ƒç€è‰²å™¨ä¼ è¾“æ•°æ®</li>
</ul>
<p><strong>GLSLç‰¹æœ‰çš„æ•°æ®ç±»å‹</strong></p>
<ol>
<li><p>å‘é‡ï¼š</p>
<p> vec2, vec3, vec4  : è¡¨ç¤ºæœ‰2,3,4ä¸ªæµ®ç‚¹æ•°çš„å‘é‡<br> ivec2, ivec3, ivec4  : è¡¨ç¤ºæœ‰2,3,4ä¸ªæ•´å½¢çš„å‘é‡<br> bvec2, bvec3, bvec4 : è¡¨ç¤ºæœ‰2,3,4ä¸ªå¸ƒå°”å€¼çš„å‘é‡</p>
</li>
<li><p>çŸ©é˜µï¼š<br> mat2, mat3, mat4  : è¡¨ç¤ºæœ‰2x2,3x3,4x4çš„æµ®ç‚¹æ•°çš„çŸ©é˜µ</p>
</li>
</ol>
<p><strong>é¡¶ç‚¹ç€è‰²å™¨</strong></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;script type=<span class="string">"x-shader/x-vertex"</span> id=<span class="string">"vs"</span>&gt;</span><br><span class="line">attribute vec4 a_Position; <span class="comment">//é¡¶ç‚¹ï¼Œ4ä¸ªæµ®ç‚¹çš„çŸ¢é‡ï¼Œattributeå˜é‡ä¼ è¾“ä¸é¡¶ç‚¹æœ‰å…³çš„æ•°æ®ï¼Œè¡¨ç¤ºé€é¡¶ç‚¹çš„ä¿¡æ¯</span></span><br><span class="line">uniform mat4 u_xformMatrix; <span class="comment">//å˜æ¢çŸ©é˜µï¼Œ4*4æµ®ç‚¹çŸ©é˜µ, uniformå˜é‡ä¼ è¾“çš„æ˜¯æ‰€æœ‰é¡¶ç‚¹éƒ½ç›¸åŒçš„æ•°æ®</span></span><br><span class="line"><span class="keyword">void</span> main() &#123; </span><br><span class="line">		gl_Position=u_xformMatrix*a_Position;</span><br><span class="line">&#125; </span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>ç‰‡å…ƒç€è‰²å™¨</strong></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;script type=<span class="string">"x-shader/x-fragment"</span> id=<span class="string">"fs"</span>&gt;</span><br><span class="line">precision mediump float; <span class="comment">// ç²¾åº¦é™å®š</span></span><br><span class="line">uniform vec4 u_FragColor;  <span class="comment">// é¢œè‰²</span></span><br><span class="line"><span class="keyword">void</span> main() &#123;</span><br><span class="line">		gl_FragColor = u_FragColor;</span><br><span class="line">&#125;</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure>

<p>æ¥ç€å°±æ˜¯åˆ›å»ºç€è‰²å™¨äº†ï¼Œé¦–å…ˆä»é¡µé¢scriptæ ‡ç­¾å–å‡ºç€è‰²å™¨ä»£ç ï¼Œåˆå§‹åŒ–ç€è‰²å™¨ï¼›æ¥ç€åˆ›å»ºç¨‹åºå¯¹è±¡ï¼Œæœ€åè¿æ¥ç¨‹åºå¯¹è±¡ã€‚ä¸­é—´çš„æ­¥éª¤å…¶å®éå¸¸çš„å•°å—¦ï¼Œå·²ç»æŠŠè¿™å‡ ä¸ªæ­¥éª¤å°è£…ï¼Œæˆ‘ä»¬åªéœ€è¦è°ƒç”¨createShaderså°±å¯ä»¥äº†ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ ¹æ®script idåˆ›å»ºç€è‰²å™¨</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param  <span class="type">&#123;Object&#125;</span> </span>gl  context</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param  <span class="type">&#123;String&#125;</span> </span>vid script id</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param  <span class="type">&#123;String&#125;</span> </span>fid script id</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return <span class="type">&#123;Boolen&#125;</span></span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createShaders</span>(<span class="params">gl, vid, fid</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> vshader, fshader, element, program;</span><br><span class="line">    [vid, fid].forEach(<span class="function"><span class="keyword">function</span>(<span class="params">id</span>) </span>&#123;</span><br><span class="line">        element = <span class="built_in">document</span>.getElementById(id);</span><br><span class="line">        <span class="keyword">if</span> (element) &#123;</span><br><span class="line">            <span class="keyword">switch</span> (element.type) &#123;</span><br><span class="line">                <span class="comment">// é¡¶ç‚¹ç€è‰²å™¨çš„æ—¶å€™</span></span><br><span class="line">                <span class="keyword">case</span> <span class="string">"x-shader/x-vertex"</span>:</span><br><span class="line">                    vshader = element.text;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="comment">// ç‰‡æ®µç€è‰²å™¨çš„æ—¶å€™</span></span><br><span class="line">                <span class="keyword">case</span> <span class="string">"x-shader/x-fragment"</span>:</span><br><span class="line">                    fshader = element.text;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">default</span>:</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">if</span> (!vshader) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"VERTEX_SHADER String not exist"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!fshader) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"FRAGMENT_SHADER String not exist"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    program = createProgram(gl, vshader, fshader);</span><br><span class="line">    <span class="keyword">if</span> (!program) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"Failed to create program"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    gl.useProgram(program);</span><br><span class="line">    gl.program = program;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åˆ›å»ºè¿æ¥ç¨‹åºå¯¹è±¡</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param  <span class="type">&#123;Object&#125;</span> </span>gl       ä¸Šä¸‹æ–‡</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param  <span class="type">&#123;String&#125;</span> </span>vshader  é¡¶ç‚¹ç€è‰²å™¨ä»£ç </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param  <span class="type">&#123;String&#125;</span> </span>fshader  ç‰‡å…ƒç€è‰²å™¨ä»£ç </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return <span class="type">&#123;Object&#125;</span></span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createProgram</span>(<span class="params">gl, vshader, fshader</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// åˆ›å»ºç€è‰²å™¨å¯¹è±¡</span></span><br><span class="line">    <span class="keyword">var</span> vertexShader = loadShader(gl, gl.VERTEX_SHADER, vshader);</span><br><span class="line">    <span class="keyword">var</span> fragmentShader = loadShader(gl, gl.FRAGMENT_SHADER, fshader);</span><br><span class="line">    <span class="keyword">if</span> (!vertexShader || !fragmentShader) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ›å»ºç¨‹åºå¯¹è±¡</span></span><br><span class="line">    <span class="keyword">var</span> program = gl.createProgram();</span><br><span class="line">    <span class="keyword">if</span> (!program) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¿æ¥ç€è‰²å™¨å¯¹è±¡</span></span><br><span class="line">    gl.attachShader(program, vertexShader);</span><br><span class="line">    gl.attachShader(program, fragmentShader);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¿æ¥ç¨‹åºå¯¹è±¡</span></span><br><span class="line">    gl.linkProgram(program);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ£€æŸ¥è¿æ¥ç»“æœ</span></span><br><span class="line">    <span class="keyword">var</span> linked = gl.getProgramParameter(program, gl.LINK_STATUS);</span><br><span class="line">    <span class="keyword">if</span> (!linked) &#123;</span><br><span class="line">        <span class="keyword">var</span> error = gl.getProgramInfoLog(program);</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"Failed to link program: "</span> + error);</span><br><span class="line">        gl.deleteProgram(program);</span><br><span class="line">        gl.deleteShader(fragmentShader);</span><br><span class="line">        gl.deleteShader(vertexShader);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> program;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åŠ è½½ç€è‰²å™¨</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param  <span class="type">&#123;Object&#125;</span> </span>gl     ä¸Šä¸‹æ–‡</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param  <span class="type">&#123;Object&#125;</span> </span>type   ç±»å‹</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param  <span class="type">&#123;String&#125;</span> </span>source ä»£ç å­—ç¬¦ä¸²</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return <span class="type">&#123;Object&#125;</span></span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">loadShader</span>(<span class="params">gl, type, source</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// åˆ›å»ºç€è‰²å™¨å¯¹è±¡</span></span><br><span class="line">    <span class="keyword">var</span> shader = gl.createShader(type);</span><br><span class="line">    <span class="keyword">if</span> (shader == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"unable to create shader"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è®¾ç½®ç€è‰²å™¨ç¨‹åº</span></span><br><span class="line">    gl.shaderSource(shader, source);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç¼–è¯‘ç€è‰²å™¨</span></span><br><span class="line">    gl.compileShader(shader);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ£€æŸ¥ç¼–è¯‘ç»“æœ</span></span><br><span class="line">    <span class="keyword">var</span> compiled = gl.getShaderParameter(shader, gl.COMPILE_STATUS);</span><br><span class="line">    <span class="keyword">if</span> (!compiled) &#123;</span><br><span class="line">        <span class="keyword">var</span> error = gl.getShaderInfoLog(shader);</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"Failed to compile shader: "</span> + error);</span><br><span class="line">        gl.deleteShader(shader);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> shader;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="ç¼“å†²åŒº"><a href="#ç¼“å†²åŒº" class="headerlink" title="ç¼“å†²åŒº"></a>ç¼“å†²åŒº</h2><p>åˆ›å»ºå¥½ç¼“å†²åŒºå¯¹è±¡åï¼Œéœ€è¦æŠŠå®ƒåˆ†é…ç»™å˜é‡ï¼Œç„¶åä½¿å®ƒç”Ÿæ•ˆã€‚æ³¨æ„é¡¶ç‚¹æ•°ç»„ä½¿ç”¨çš„æ˜¯ç±»å‹åŒ–æ•°ç»„Float32Arrayï¼Œè¿™æ ·æ›´åŠ é«˜æ•ˆã€‚vertexAttribPointeræ–¹æ³•è¿™é‡ŒæŒ‡å®šäº†æ¯ä¸ªé¡¶ç‚¹åˆ†é‡çš„ä¸ªæ•°ä¸º2ï¼Œå› ä¸ºæˆ‘ä»¬ç›®å‰åªå®šä¹‰x,yåæ ‡ï¼Œzåæ ‡ä½¿ç”¨ç³»ç»Ÿé»˜è®¤ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åˆ›å»ºç¼“å†²åŒº</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param  <span class="type">&#123;Array&#125;</span> <span class="variable">data</span></span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param  <span class="type">&#123;Object&#125;</span> <span class="variable">bufferType</span></span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return <span class="type">&#123;Object&#125;</span></span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createBuffer</span>(<span class="params">data, bufferType</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// ç”Ÿæˆç¼“å­˜å¯¹è±¡</span></span><br><span class="line">    <span class="keyword">var</span> buffer = gl.createBuffer();</span><br><span class="line">    <span class="keyword">if</span> (!buffer) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"Failed to create the buffer object"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ç»‘å®šç¼“å­˜(gl.ARRAY_BUFFER&lt;é¡¶ç‚¹&gt;||gl.ELEMENT_ARRAY_BUFFER&lt;é¡¶ç‚¹ç´¢å¼•&gt;)</span></span><br><span class="line">    gl.bindBuffer(bufferType || gl.ARRAY_BUFFER, buffer);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å‘ç¼“å­˜ä¸­å†™å…¥æ•°æ®</span></span><br><span class="line">    gl.bufferData(bufferType || gl.ARRAY_BUFFER, data, gl.STATIC_DRAW);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å°†ç»‘å®šçš„ç¼“å­˜è®¾ä¸ºæ— æ•ˆ</span></span><br><span class="line">    <span class="comment">// gl.bindBuffer(gl.ARRAY_BUFFER, null);</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¿”å›ç”Ÿæˆçš„buffer</span></span><br><span class="line">    <span class="keyword">return</span> buffer;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ›å»ºç¼“å†²åŒºå¹¶ä¼ äººé¡¶ç‚¹</span></span><br><span class="line"><span class="keyword">var</span> vertices = <span class="keyword">new</span> <span class="built_in">Float32Array</span>([<span class="number">-0.5</span>, <span class="number">0.5</span>, <span class="number">-0.5</span>, <span class="number">-0.5</span>, <span class="number">0.5</span>, <span class="number">0.5</span>, <span class="number">0.5</span>, <span class="number">-0.5</span>]);</span><br><span class="line"><span class="keyword">if</span> (!createBuffer(vertices)) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ†é…ç¼“å†²åŒºå¯¹è±¡ç»™a_Positionå˜é‡</span></span><br><span class="line"><span class="comment">// (åœ°å€,æ¯ä¸ªé¡¶ç‚¹åˆ†é‡çš„ä¸ªæ•°&lt;1-4&gt;,æ•°æ®ç±»å‹&lt;æ•´å½¢ï¼Œç¬¦ç‚¹ç­‰&gt;,æ˜¯å¦å½’ä¸€åŒ–,æŒ‡å®šç›¸é‚»ä¸¤ä¸ªé¡¶ç‚¹é—´å­—èŠ‚æ•°&lt;é»˜è®¤0&gt;,æŒ‡å®šç¼“å†²åŒºå¯¹è±¡åç§»é‡&lt;é»˜è®¤0&gt;)</span></span><br><span class="line">gl.vertexAttribPointer(a_Position, <span class="number">2</span>, gl.FLOAT, <span class="literal">false</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¯åŠ¨</span></span><br><span class="line">gl.enableVertexAttribArray(a_Position);</span><br></pre></td></tr></table></figure>
<h2 id="å†™å…¥æ•°æ®"><a href="#å†™å…¥æ•°æ®" class="headerlink" title="å†™å…¥æ•°æ®"></a>å†™å…¥æ•°æ®</h2><p>é¦–å…ˆè¦è·å–å˜é‡çš„åœ°å€ï¼Œç„¶åå†ç»™å˜é‡èµ‹å€¼ï¼Œæ„Ÿè§‰æŒºéº»çƒ¦çš„ã€‚attributeæ ‡è®°çš„å˜é‡ä½¿ç”¨getAttribLocationè·å–ï¼ŒåŒç†uniformæ ‡è®°çš„å˜é‡ä½¿ç”¨getUniformLocationè·å–ã€‚</p>
<p>æˆ‘ä»¬çš„åŠ¨ç”»è¦ä½¿å›¾å½¢ç»•åæ ‡åŸç‚¹æ—‹è½¬ï¼Œé‚£ä¹ˆè¿™å°±éœ€è¦ç”¨åˆ°çŸ©é˜µçš„å˜æ¢ï¼ŒçŸ©é˜µç›¸å…³çš„çŸ¥è¯†å°±ä¸è¯¦ç»†è¯´æ˜äº†ã€‚è¦æ³¨æ„webGLä½¿ç”¨çš„æ˜¯åˆ—ä¸»åºçš„çŸ©é˜µï¼Œè®¡ç®—å¥½å˜æ¢çŸ©é˜µåï¼ŒæŠŠå€¼èµ‹äºˆå˜é‡å°±okã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// è·å– u_FragColorå˜é‡çš„å­˜å‚¨åœ°å€å¹¶èµ‹å€¼</span></span><br><span class="line"><span class="keyword">var</span> u_FragColor = gl.getUniformLocation(gl.program, <span class="string">'u_FragColor'</span>);</span><br><span class="line"><span class="keyword">if</span> (!u_FragColor) <span class="keyword">return</span>;</span><br><span class="line"><span class="comment">//é¢œè‰²æ¨¡å¼ä¸ºrgbaï¼Œå€¼èŒƒå›´0ï½1</span></span><br><span class="line">gl.uniform4f(u_FragColor, <span class="number">1.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">1.0</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç»•zè½´æ—‹è½¬</span></span><br><span class="line"><span class="keyword">var</span> deg=<span class="built_in">Math</span>.PI/<span class="number">180</span>*(angle++),</span><br><span class="line">    cos=<span class="built_in">Math</span>.cos(deg),</span><br><span class="line">    sin=<span class="built_in">Math</span>.sin(deg);</span><br><span class="line"></span><br><span class="line"><span class="comment">//  webglä¸­æ˜¯æŒ‰åˆ—ä¸»åº æ—‹è½¬åŠ ä½ç§»</span></span><br><span class="line"><span class="keyword">var</span> xformMatrix=<span class="keyword">new</span> <span class="built_in">Float32Array</span>([</span><br><span class="line">    cos,sin,<span class="number">0.0</span>,<span class="number">0.0</span>,</span><br><span class="line">    -sin,cos,<span class="number">0.0</span>,<span class="number">0.0</span>,</span><br><span class="line">    <span class="number">0.0</span>,<span class="number">0.0</span>,<span class="number">1.0</span>,<span class="number">0.0</span>,</span><br><span class="line">    <span class="number">0.3</span>,<span class="number">0.0</span>,<span class="number">0.0</span>,<span class="number">1.0</span></span><br><span class="line">]);</span><br><span class="line"></span><br><span class="line"><span class="comment">// vè¡¨ç¤ºå¯ä»¥å‘ç€è‰²å™¨ä¼ è¾“å¤šä¸ªæ•°å€¼(åœ°å€å˜é‡,webglä¸­å¿…é¡»false,çŸ©é˜µ)</span></span><br><span class="line">gl.uniformMatrix4fv(u_xformMatrix,<span class="literal">false</span>,xformMatrix);</span><br></pre></td></tr></table></figure>
<h2 id="èƒŒæ™¯æ“ä½œ"><a href="#èƒŒæ™¯æ“ä½œ" class="headerlink" title="èƒŒæ™¯æ“ä½œ"></a>èƒŒæ™¯æ“ä½œ</h2><p>æ¯æ¬¡æ‰§è¡ŒåŠ¨ç”»å‰è¿›è¡Œæ¸…å±ï¼Œå’Œcanvasä¸­çš„è®¾ç½®fillStyleï¼Œæ‰§è¡ŒclearRectï¼Œæ•ˆæœä¸€æ ·ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// è®¾ç½®æ¸…å±é¢œè‰²</span></span><br><span class="line">gl.clearColor(<span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">1.0</span>);</span><br><span class="line"><span class="comment">// æ¸…å±</span></span><br><span class="line">gl.clear(gl.COLOR_BUFFER_BIT);</span><br></pre></td></tr></table></figure>
<h2 id="ç»˜åˆ¶"><a href="#ç»˜åˆ¶" class="headerlink" title="ç»˜åˆ¶"></a>ç»˜åˆ¶</h2><p>æœ€åæ¸²æŸ“å›¾å½¢ï¼Œæ³¨æ„ç¬¬ä¸€ä¸ªå‚æ•°ï¼ŒæŒ‡å®šä¸åŒçš„å€¼ï¼Œå®ƒå°±æ¸²æŸ“ä¸ºä¸åŒçš„å›¾å½¢ï¼Œå¤§å®¶å¯ä»¥ç”¨ä¸åŒçš„å€¼è¯•è¯•æ•ˆæœã€‚</p>
<ul>
<li>POINTS ç‚¹</li>
<li>LINES çº¿æ®µ</li>
<li>LINE_STRIP çº¿æ¡</li>
<li>LINE_LOOP å›è·¯</li>
<li>TRIANGLES ä¸‰è§’å½¢</li>
<li>TRIANGLE_STRIP ä¸‰è§’å¸¦</li>
<li>TRIANGLE_FAN ä¸‰è§’æ‰‡</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// (åŸºæœ¬å›¾å½¢ï¼Œç¬¬å‡ ä¸ªé¡¶ç‚¹ï¼Œæ‰§è¡Œå‡ æ¬¡)ï¼Œä¿®æ”¹åŸºæœ¬å›¾å½¢é¡¹å¯ä»¥ç”Ÿæˆç‚¹ï¼Œçº¿ï¼Œä¸‰è§’å½¢ï¼ŒçŸ©å½¢ï¼Œæ‰‡å½¢ç­‰</span></span><br><span class="line">gl.drawArrays(gl.TRIANGLES, <span class="number">0</span>, <span class="number">3</span>);</span><br></pre></td></tr></table></figure>
<p>æœ€åä¸»ä½“ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> canvas = <span class="built_in">document</span>.getElementById(<span class="string">"canvas"</span>),</span><br><span class="line">    gl = get3DContext(canvas, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">main</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!gl) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"Failed to get the rendering context for WebGL"</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!createShaders(gl, <span class="string">"fs"</span>, <span class="string">"vs"</span>)) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"Failed to intialize shaders."</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ›å»ºç¼“å†²åŒºå¹¶ä¼ äººé¡¶ç‚¹</span></span><br><span class="line">    <span class="keyword">var</span> vertices = <span class="keyword">new</span> <span class="built_in">Float32Array</span>([ <span class="number">-0.5</span>, <span class="number">0.5</span>, <span class="number">-0.5</span>, <span class="number">-0.5</span>, <span class="number">0.5</span>, <span class="number">0.5</span>, <span class="number">0.5</span>, <span class="number">-0.5</span> ]);</span><br><span class="line">    <span class="keyword">if</span> (!createBuffer(vertices)) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"Failed to create the buffer object"</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·å–é¡¶ç‚¹ä½ç½®</span></span><br><span class="line">    <span class="keyword">var</span> a_Position = gl.getAttribLocation(gl.program, <span class="string">"a_Position"</span>);</span><br><span class="line">    <span class="keyword">if</span> (a_Position &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"Failed to get the storage location of a_Position"</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ†é…ç¼“å†²åŒºå¯¹è±¡ç»™a_Positionå˜é‡</span></span><br><span class="line">    gl.vertexAttribPointer(a_Position, <span class="number">2</span>, gl.FLOAT, <span class="literal">false</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    gl.enableVertexAttribArray(a_Position);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·å– u_FragColorå˜é‡çš„å­˜å‚¨åœ°å€å¹¶èµ‹å€¼</span></span><br><span class="line">    <span class="keyword">var</span> u_FragColor = gl.getUniformLocation(gl.program, <span class="string">"u_FragColor"</span>);</span><br><span class="line">    <span class="keyword">if</span> (!u_FragColor) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"Failed to get the storage location of u_FragColor"</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    gl.uniform4f(u_FragColor, <span class="number">1.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">1.0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·å–çŸ©é˜µå˜é‡</span></span><br><span class="line">    <span class="keyword">var</span> u_xformMatrix = gl.getUniformLocation(gl.program, <span class="string">"u_xformMatrix"</span>);</span><br><span class="line">    <span class="keyword">if</span> (!u_xformMatrix) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"Failed to get the storage location of u_xformMatrix"</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> xformMatrix,</span><br><span class="line">        angle = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">// è®¾ç½®æ¸…å±é¢œè‰²</span></span><br><span class="line">    gl.clearColor(<span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">1.0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ‰§è¡ŒåŠ¨ç”»</span></span><br><span class="line">    (<span class="function"><span class="keyword">function</span> <span class="title">animate</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> deg = (<span class="built_in">Math</span>.PI / <span class="number">180</span>) * angle++,</span><br><span class="line">            cos = <span class="built_in">Math</span>.cos(deg),</span><br><span class="line">            sin = <span class="built_in">Math</span>.sin(deg);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ—‹è½¬åŠ ä½ç§»</span></span><br><span class="line">        xformMatrix = <span class="keyword">new</span> <span class="built_in">Float32Array</span>([ </span><br><span class="line">            cos, sin, <span class="number">0.0</span>, <span class="number">0.0</span>,</span><br><span class="line">            -sin, cos, <span class="number">0.0</span>, <span class="number">0.0</span>,</span><br><span class="line">            <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">1.0</span>, <span class="number">0.0</span>,</span><br><span class="line">            <span class="number">0.3</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">1.0</span></span><br><span class="line">        ]);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// vè¡¨ç¤ºå¯ä»¥å‘ç€è‰²å™¨ä¼ è¾“å¤šä¸ªæ•°å€¼(åœ°å€å˜é‡,webglä¸­å¿…é¡»false,çŸ©é˜µ)</span></span><br><span class="line">        gl.uniformMatrix4fv(u_xformMatrix, <span class="literal">false</span>, xformMatrix);</span><br><span class="line"></span><br><span class="line">        gl.clear(gl.COLOR_BUFFER_BIT);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// (åŸºæœ¬å›¾å½¢ï¼Œç¬¬å‡ ä¸ªé¡¶ç‚¹ï¼Œæ‰§è¡Œå‡ æ¬¡)ï¼Œä¿®æ”¹åŸºæœ¬å›¾å½¢é¡¹å¯ä»¥ç”Ÿæˆç‚¹ï¼Œçº¿ï¼Œä¸‰è§’å½¢ï¼ŒçŸ©å½¢ï¼Œæ‰‡å½¢ç­‰</span></span><br><span class="line">        gl.drawArrays(gl.TRIANGLES, <span class="number">0</span>, <span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">        requestAnimationFrame(animate);</span><br><span class="line">    &#125;)();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">main();</span><br></pre></td></tr></table></figure>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>ç›¸æ¯”canvasï¼ŒwebGLçš„apiè¦åŸå§‹å¾—å¤šï¼Œæ¶‰åŠåˆ°å¾ˆå¤šåº•å±‚çš„openGLç»†èŠ‚ï¼Œä½†ç»è¿‡å°è£…åï¼Œæˆ‘ä»¬å¯ä»¥æŠŠé‚£éƒ¨åˆ†ç»†èŠ‚çœ‹æˆä¸€ä¸ªé»‘ç®±ã€‚å¤§éƒ¨åˆ†çš„æ“ä½œéƒ½æ˜¯åŸºäºçŸ©é˜µå˜æ¢ï¼Œå°½ç®¡æœ‰å¾ˆå¤šæ–¹ä¾¿çš„ç¬¬ä¸‰æ–¹çŸ©é˜µåº“ï¼Œä½†æœ‰ç‰¢å›ºçš„çº¿æ€§ä»£æ•°åŸºç¡€è¿˜æ˜¯å¤§æœ‰è£¨ç›Šçš„ï¼ŒGLSLç¼–ç¨‹è¯­è¨€ä¹Ÿæ˜¯ä¸€æ ·éœ€è¦ç†Ÿç»ƒæŒæ¡ã€‚</p>
</div>
    	
		<div class="post-footer">
			<div class="tags">
				<i class="icon-tags"></i> 
				
					
					
						
							<a href="/blog/tags/%E5%89%8D%E7%AB%AF/">å‰ç«¯</a>
						
					
						
							<a href="/blog/tags/js/">js</a>
						
					
						
							<a href="/blog/tags/webGL/">webGL</a>
						
					
				
			</div>
			<a class="share" href="javascript:;" data-url="/blog/2017/11/08/webgltriangle/" data-desc="

è¿˜è®°å¾—ç¬¬ä¸€æ¬¡çœ‹åˆ°canvasçš„ç²’å­ç‰¹æ•ˆçš„æ—¶å€™ï¼ŒçœŸçš„æŠŠæˆ‘ç»™æƒŠè‰³åˆ°äº†ï¼ŒåŸæ¥åœ¨æµè§ˆå™¨ä¹Ÿèƒ½åšå‡ºè¿™ä¹ˆ..." data-type="share" title="share"><i class="icon-share"></i></a>
		</div>
	</div>
</article>
</div>
<nav class="pagination clearfix">
  
    
      
        <a href="/blog/2017/11/12/chartbar/" class="prev post-prev"> <i class="icon-leftarrow"></i> canvaså›¾è¡¨(1) - æŸ±çŠ¶å›¾</a>
      

      
        <a href="/blog/2017/11/02/drawboard/" class="next post-next"> canvaså›¾å½¢ç¼–è¾‘å™¨ <i class="icon-rightarrow"></i></a>
      
    
  
</nav>

<div class="wxshare-popup">
    <a class="close" href="javascript:;"></a>
    <p>æ‰«ä¸€æ‰«ï¼Œåˆ†äº«åˆ°å¾®ä¿¡</p>
    <div id="qrcode" class="wx-qrcode"></div>
</div>

    
    <footer class="footer">
<p class="theme">
	Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/edwardzhong/simply.git" target="_blank" rel="noopener">simply</a>
</p>
<p class="copy">Copyright &copy; 2021 Jeff Zhong</p>
</footer>
    <div class="top-bottom">
      <div class="to-top hide" title="to top"><i class="icon-up"></i></div>
      <div class="to-bottom hide" title="to bottom"><i class="icon-down"></i></div>
    </div>
    </div>

  </div>
<input type="hidden" name="isPost" id="isPost" value="true">
<i id="barBtn" class="icon icon-menu"></i>
<div id="payMe" class="payme">
    <i class="icon icon-cancel"></i>
    <p class="pay-title">ç»™æˆ‘çš„æ—©é¤åŠ ä¸ªè›‹å§ ğŸ˜Š</p>
    <div>
      <img src="/images/weixinpay.jpg" alt="weixinpay">
      <img src="/images/alipay.jpg" alt="alipay" style="display:none;">
    </div>
    <div class="pay-selects">
        <input type="radio" name="pay" id="weixinpay" checked="checked"><label for="weixinpay"> å¾®ä¿¡ </label>&nbsp;&nbsp;
        <input type="radio" name="pay" id="alipay"><label for="alipay"> æ”¯ä»˜å® </label>
    </div>
</div>

  
  
    <script src="/blog/lib/jquery-2.2.3.min.js"></script>
  
    <script src="/blog/lib/qrcode.min.js"></script>
  
    <script src="/blog/js/index.js"></script>
  

<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>

</body>
</html>
