<!doctype html>
<html lang="zh-CN">









<head>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
  <!-- ä¼˜å…ˆä½¿ç”¨ IE æœ€æ–°ç‰ˆæœ¬å’Œ Chrome -->
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
  <!-- ä¸ºç§»åŠ¨è®¾å¤‡æ·»åŠ  viewport -->
  <meta name="viewport" content="width=device-width,initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no">
  <!-- æ·»åŠ åˆ°ä¸»å±åçš„æ ‡é¢˜ï¼ˆiOS 6 æ–°å¢ï¼‰ -->
  <meta name="apple-mobile-web-app-title" content="canvaså›¾è¡¨(3) - é¥¼å›¾ - Jeff's world">
  <!-- æ˜¯å¦å¯ç”¨ WebApp å…¨å±æ¨¡å¼ï¼Œåˆ é™¤è‹¹æœé»˜è®¤çš„å·¥å…·æ å’Œèœå•æ  -->
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <!-- è®¾ç½®è‹¹æœå·¥å…·æ é¢œè‰² -->
  <meta name="apple-mobile-web-app-status-bar-style" content = "black" />
  <!-- æ·»åŠ æ™ºèƒ½ App å¹¿å‘Šæ¡ Smart App Bannerï¼ˆiOS 6+ Safariï¼‰ -->
  <!-- <meta name = "apple-itunes-app" content = "app-id=myAppStoreID, affiliate-data=myAffiliateData, app-argument=myURL"> -->
  <!-- å¿½ç•¥é¡µé¢ä¸­çš„æ•°å­—è¯†åˆ«ä¸ºç”µè¯ï¼Œå¿½ç•¥emailè¯†åˆ« -->
  <meta name="format-detection" content = "telphone=no, email=no" />
  <!--ä¸‹é¢ä¸‰ä¸ªæ˜¯æ¸…é™¤ç¼“å­˜ å¾®ä¿¡æµè§ˆå™¨ç¼“å­˜ä¸¥é‡åˆæ— åˆ·æ–°ï¼›è¿™ä¸ªæ–¹æ³•è°ƒè¯•çš„æ—¶å€™å¾ˆæ–¹ä¾¿-->
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Cache-Control" content="no-cache">
  <meta http-equiv="Expires" content="0">
  
  <link rel="dns-prefetch" href="https://edwardzhong.github.io">
  <link rel="icon shortcut" type="image/ico" href="/favicon.ico">
  <meta name="author" content="Jeff Zhong">
  <meta name="description" content="it's a blog by hexo">
  <meta name="keywords" content="hexo theme">
  <title >canvaså›¾è¡¨(3) - é¥¼å›¾ - Jeff's world</title>
    <!-- The Open Graph protocol -->
  <meta property="og:url" content="https://edwardzhong.github.io">
  <meta property="og:type" content="blog">
  <meta property="og:title" content="canvaså›¾è¡¨(3) - é¥¼å›¾ - Jeff's world">
  <meta property="og:description" content="it's a blog by hexo">
  
    
    
      <link rel="stylesheet" href="/lib/fontello/fontello.css">
    
      <link rel="stylesheet" href="/lib/reboto/roboto.css">
    
      <link rel="stylesheet" href="/css/index.css">
    
  
  <script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?5255e97b442092b8e1a219e6a48a0d42";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>

<meta name="generator" content="Hexo 4.2.0"><link rel="alternate" href="/atom.xml" title="Jeff's world" type="application/atom+xml">
</head>
<body>
<header class="header">
  <div class="top"></div>
  <h2>Jeff's World</h2>
  <h3>Things that I'm interested in</h3>
  <div class="menu">
  
  
  
      <a  href="/" title="ä¸» é¡µ">
        <i class="icon-home"></i>
        <span>ä¸» é¡µ</span>
      </a>
  
      <a  href="/sites/demo/" title="Demo">
        <i class="icon-page"></i>
        <span>Demo</span>
      </a>
  
      <a  data-tag="search"  href="javascript:;" title="æœ ç´¢">
        <i class="icon-search"></i>
        <span>æœ ç´¢</span>
      </a>
  
  </div>
  <div class="state">
  
    <a href="/archives">44<br>æ–‡ ç« </a><a href="/categories">2<br>åˆ† ç±»</a><a href="/tags">61<br>æ ‡ ç­¾</a>
  </div>
  <div class="social">
  
  
  
      <a href="https://github.com/edwardzhong" target="_blank" rel="noopener" title="Github"><i class="icon-github"></i></a>
  
      <a href="https://twitter.com/JianfengEdward" target="_blank" rel="noopener" title="Twitter"><i class="icon-twitter"></i></a>
  
      <a href="https://www.facebook.com/jianfeng.edward" target="_blank" rel="noopener" title="Facebook"><i class="icon-facebook"></i></a>
  
      <a href="http://weibo.com/1593251850" target="_blank" rel="noopener" title="Weibo"><i class="icon-weibo"></i></a>
  
      <a href="/atom.xml" title="Rss"><i class="icon-rss"></i></a>
  
  </div>
  <div id="payBtn" class="pay-icon" title="è°¢è°¢æ‚¨çš„èµèµ">èµ</div>
</header>
  <div class="container">
    <div class="main">
    
        
<div class="post-list">
	<article class="post" style="animation:listshow 0.6s ease-out both 0.30000000000000004s">
    
    
        
    
	
	<a href="javascript:;">
        <div class="post-banner" style="background: url(/images/banner4.jpg)  center top / 100% no-repeat">
    		<h3 class="post-title">canvaså›¾è¡¨(3) - é¥¼å›¾</h3>
    	</div>
	</a>
	<div class="post-inner">
	
    	<div class="post-info">
    		<time><i class="icon-calendar"></i> 2017/11/23 10:23:00</time>
    		<span class="category">
    		
    			
    			<i class="icon-book"></i>
    			
                    
                        <a href="/categories/%E6%8A%80%E6%9C%AF/">æŠ€æœ¯</a>
                    
    			
    		
    		</span>
    	</div>
    	<!-- <p><p>è¿™å‡ å¤©æŠŠcanvaså›¾è¡¨éƒ½ä¼˜åŒ–äº†ä¸‹ï¼ŒåŠ¨ç”»æ•ˆæœæ›´åŠ å‡ºè‰²äº†ï¼Œå¯ä»¥è¯´å¾ˆé€¼è¿‘Echartäº†ã€‚åˆšåˆšå†™å®Œçš„é¥¼å›¾ï¼Œéå¸¸å¥½çš„å®ç°äº†æ—¢å®šçš„åŠŸèƒ½ï¼Œäº¤äº’çš„åŠ¨ç”»æ•ˆæœä¹Ÿæ˜¯å¾ˆæ£’çš„ã€‚<br>æ•ˆæœè¯·çœ‹ï¼šé¥¼å›¾<a href="https://edwa" target="_blank" rel="noopener">https://edwa</a>â€¦</p>
</p> -->
    	
    		<div class="post-content"><!-- åŸæ–‡åœ°å€ï¼š[canvaså›¾è¡¨(3) - é¥¼å›¾](https://edwardzhong.github.io/2017/11/23/chartpie/) -->
<p>è¿™å‡ å¤©æŠŠcanvaså›¾è¡¨éƒ½ä¼˜åŒ–äº†ä¸‹ï¼ŒåŠ¨ç”»æ•ˆæœæ›´åŠ å‡ºè‰²äº†ï¼Œå¯ä»¥è¯´å¾ˆé€¼è¿‘Echartäº†ã€‚åˆšåˆšå†™å®Œçš„é¥¼å›¾ï¼Œéå¸¸å¥½çš„å®ç°äº†æ—¢å®šçš„åŠŸèƒ½ï¼Œäº¤äº’çš„åŠ¨ç”»æ•ˆæœä¹Ÿæ˜¯å¾ˆæ£’çš„ã€‚</p>
<p>æ•ˆæœè¯·çœ‹ï¼š<em><a href="https://edwardzhong.github.io/sites/demo/dist/chartpie.html">é¥¼å›¾https://edwardzhong.github.io/sites/demo/dist/chartpie.html</a></em></p>
<!-- ![it](http://oncse3u6r.bkt.clouddn.com/chartpie.jpg) -->
<img src="http://upload-images.jianshu.io/upload_images/127924-a191a2faf468bea5.jpg" width="500">
<a id="more"></a>

<p>åŠŸèƒ½ç‚¹åŒ…æ‹¬ï¼š</p>
<ol>
<li>ç»„ç»‡æ•°æ®ï¼›</li>
<li>ç”»é¢ç»˜åˆ¶ï¼›</li>
<li>æ•°æ®åŠ¨ç”»çš„å®ç°ï¼›</li>
<li>é¼ æ ‡äº‹ä»¶çš„å¤„ç†ã€‚</li>
</ol>
<h2 id="ä½¿ç”¨æ–¹å¼"><a href="#ä½¿ç”¨æ–¹å¼" class="headerlink" title="ä½¿ç”¨æ–¹å¼"></a>ä½¿ç”¨æ–¹å¼</h2><p>é¥¼å›¾çš„æ•°æ®æ–¹é¢è¦ç®€å•å¾ˆå¤šï¼Œå› ä¸ºä¸ç”¨å¤šä¸ªåˆ†ç»„çš„æ•°æ®ã€‚æŠŠæ‰€æœ‰çš„æ•°æ®ç›¸åŠ å¾—å‡ºæ€»æ•°ï¼Œç„¶åæ¯ä¸ªæ•°æ®åˆ†åˆ«æ±‚å‡ºç™¾åˆ†æ¯”ï¼Œæœ‰äº†ç™¾åˆ†æ¯”å†ç›¸ä¹˜360åº¦çš„å¼§åº¦å¾—å‡ºæ¯ä¸ªæ•°æ®åœ¨åœ†ç›˜ä¸­å¯¹åº”çš„è¦æ˜¾ç¤ºçš„è§’åº¦ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> con=<span class="built_in">document</span>.getElementById(<span class="string">'container'</span>);</span><br><span class="line"><span class="keyword">var</span> pie=<span class="keyword">new</span> Pie(con);</span><br><span class="line">pie.init(&#123;</span><br><span class="line">	title:<span class="string">'ç½‘ç«™ç”¨æˆ·è®¿é—®æ¥æº'</span>,</span><br><span class="line">	toolTip:<span class="string">'è®¿é—®æ¥æº'</span>,</span><br><span class="line">    data:[</span><br><span class="line">        &#123;<span class="attr">value</span>:<span class="number">435</span>, <span class="attr">name</span>:<span class="string">'ç›´æ¥è®¿é—®'</span>&#125;,</span><br><span class="line">        &#123;<span class="attr">value</span>:<span class="number">310</span>, <span class="attr">name</span>:<span class="string">'é‚®ä»¶è¥é”€'</span>&#125;,</span><br><span class="line">        &#123;<span class="attr">value</span>:<span class="number">234</span>, <span class="attr">name</span>:<span class="string">'è”ç›Ÿå¹¿å‘Š'</span>&#125;,</span><br><span class="line">        &#123;<span class="attr">value</span>:<span class="number">135</span>, <span class="attr">name</span>:<span class="string">'è§†é¢‘å¹¿å‘Š'</span>&#125;,</span><br><span class="line">        &#123;<span class="attr">value</span>:<span class="number">1548</span>, <span class="attr">name</span>:<span class="string">'æœç´¢å¼•æ“'</span>&#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="ä»£ç ç»“æ„"><a href="#ä»£ç ç»“æ„" class="headerlink" title="ä»£ç ç»“æ„"></a>ä»£ç ç»“æ„</h2><p>å› ä¸ºä¸ºäº†åŒæ—¶å®ç°æ–°å¢åŠ¨ç”»å’Œæ›´æ–°åŠ¨ç”»ï¼Œè¿™æ¬¡çš„ä»£ç ç»“æ„ç»è¿‡äº†é‡æ„å’Œä¼˜åŒ–ï¼Œè·Ÿä¹‹å‰çš„æœ‰æ¯”è¾ƒå¤§çš„åŒºåˆ«ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Line</span> <span class="keyword">extends</span> <span class="title">Chart</span></span>&#123;</span><br><span class="line">	<span class="keyword">constructor</span>(container)&#123;</span><br><span class="line">		<span class="keyword">super</span>(container);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// åˆå§‹åŒ–</span></span><br><span class="line">	init(opt)&#123;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// ç»‘å®šäº‹ä»¶</span></span><br><span class="line">	bindEvent()&#123;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// æ˜¾ç¤ºä¿¡æ¯</span></span><br><span class="line">	showInfo(pos,arr)&#123;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// æ¸…é™¤å†…å®¹å†ç»˜åˆ¶</span></span><br><span class="line">	clearGrid(index)&#123;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// æ‰§è¡Œæ•°æ®åŠ¨ç”»</span></span><br><span class="line">	animate()&#123;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// æ‰§è¡Œ</span></span><br><span class="line">	create()&#123;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// ç»„ç»‡æ•°æ®</span></span><br><span class="line">	initData()&#123;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// ç»˜åˆ¶</span></span><br><span class="line">	draw()&#123;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="ç»„ç»‡æ•°æ®"><a href="#ç»„ç»‡æ•°æ®" class="headerlink" title="ç»„ç»‡æ•°æ®"></a>ç»„ç»‡æ•°æ®</h2><p>è¿™æ¬¡æŠŠç»„ç»‡æ•°æ®çš„åŠŸèƒ½å•ç‹¬æ‹äº†å‡ºæ¥ï¼Œè¿™æ ·æ–¹ä¾¿é‡ç”¨å’Œä¿®æ”¹ã€‚ç„¶åè¿˜è¦ç»™åŠ¨ç”»å¯¹è±¡å¢åŠ æ˜¯å¦åˆ›å»ºçš„å±æ€§createå’Œä¸Šæ¬¡æœ€åæ›´æ–°çš„åº¦æ•°lastï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿå› ä¸ºæˆ‘ä»¬è¦åŒæ—¶å®ç°åˆ›å»ºå’Œæ›´æ–°å›¾å½¢çš„åŠ¨ç”»æ•ˆæœã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">initData()&#123;</span><br><span class="line">	<span class="keyword">var</span> that=<span class="keyword">this</span>,</span><br><span class="line">		item,</span><br><span class="line">		total=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">if</span>(!<span class="keyword">this</span>.data||!<span class="keyword">this</span>.data.length)&#123;<span class="keyword">return</span>;&#125;</span><br><span class="line">	<span class="keyword">this</span>.legend.length=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;<span class="keyword">this</span>.data.length;i++)&#123;</span><br><span class="line">		item=<span class="keyword">this</span>.data[i];</span><br><span class="line">		<span class="comment">// èµ‹äºˆæ²¡æœ‰é¢œè‰²çš„é¡¹</span></span><br><span class="line">		<span class="keyword">if</span>(!item.color)&#123;</span><br><span class="line">			<span class="keyword">var</span> hsl=i%<span class="number">2</span>?<span class="number">180</span>+<span class="number">20</span>*i/<span class="number">2</span>:<span class="number">20</span>*(i<span class="number">-1</span>);</span><br><span class="line">			item.color=<span class="string">'hsla('</span>+hsl+<span class="string">',70%,60%,1)'</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		item.name=item.name||<span class="string">'unnamed'</span>;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">this</span>.legend.push(&#123;</span><br><span class="line">			hide:!!item.hide,</span><br><span class="line">			name:item.name,</span><br><span class="line">			color:item.color,</span><br><span class="line">			x:<span class="number">50</span>,</span><br><span class="line">			y:that.paddingTop+<span class="number">40</span>+i*<span class="number">50</span>,</span><br><span class="line">			w:<span class="number">80</span>,</span><br><span class="line">			h:<span class="number">30</span>,</span><br><span class="line">			r:<span class="number">5</span></span><br><span class="line">		&#125;);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span>(item.hide)<span class="keyword">continue</span>;</span><br><span class="line">		total+=item.value;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;<span class="keyword">this</span>.data.length;i++)&#123;</span><br><span class="line">		item=<span class="keyword">this</span>.data[i];</span><br><span class="line">		<span class="keyword">if</span>(!<span class="keyword">this</span>.animateArr[i])&#123;<span class="comment">//åˆ›å»º</span></span><br><span class="line">			<span class="keyword">this</span>.animateArr.push(&#123;</span><br><span class="line">				i:i,</span><br><span class="line">				create:<span class="literal">true</span>,</span><br><span class="line">				hide:!!item.hide,</span><br><span class="line">				name:item.name,</span><br><span class="line">				color:item.color,</span><br><span class="line">				num:item.value,</span><br><span class="line">				percent:<span class="built_in">Math</span>.round(item.value/total*<span class="number">10000</span>)/<span class="number">100</span>,</span><br><span class="line">				ang:<span class="built_in">Math</span>.round(item.value/total*<span class="built_in">Math</span>.PI*<span class="number">2</span>*<span class="number">100</span>)/<span class="number">100</span>,</span><br><span class="line">				last:<span class="number">0</span>,</span><br><span class="line">				cur:<span class="number">0</span></span><br><span class="line">			&#125;);</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;<span class="comment">//æ›´æ–°				</span></span><br><span class="line">			<span class="keyword">if</span>(that.animateArr[i].hide&amp;&amp;!item.hide)&#123;</span><br><span class="line">				that.animateArr[i].create=<span class="literal">true</span>;</span><br><span class="line">				that.animateArr[i].cur=<span class="number">0</span>;</span><br><span class="line">			&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">				that.animateArr[i].create=<span class="literal">false</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			that.animateArr[i].hide=item.hide;</span><br><span class="line">			that.animateArr[i].percent=<span class="built_in">Math</span>.round(item.value/total*<span class="number">10000</span>)/<span class="number">100</span>;</span><br><span class="line">			that.animateArr[i].ang=<span class="built_in">Math</span>.round(item.value/total*<span class="built_in">Math</span>.PI*<span class="number">2</span>*<span class="number">100</span>)/<span class="number">100</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="ç»˜åˆ¶"><a href="#ç»˜åˆ¶" class="headerlink" title="ç»˜åˆ¶"></a>ç»˜åˆ¶</h2><p>é¥¼å›¾çš„ç»˜åˆ¶åŠŸèƒ½å¾ˆç®€å•ï¼Œå› ä¸ºä¸ç”¨åæ ‡ç³»ï¼Œåªéœ€è¦ç»˜åˆ¶æ ‡é¢˜å’Œæ ‡ç­¾åˆ—è¡¨ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">draw()&#123;</span><br><span class="line">	<span class="keyword">var</span> item,ctx=<span class="keyword">this</span>.ctx;</span><br><span class="line">	ctx.fillStyle=<span class="string">'hsla(0,0%,30%,1)'</span>;</span><br><span class="line">	ctx.strokeStyle=<span class="string">'hsla(0,0%,20%,1)'</span>;</span><br><span class="line">	ctx.textBaseLine=<span class="string">'middle'</span>;</span><br><span class="line">	ctx.font=<span class="string">'24px arial'</span>;</span><br><span class="line">	</span><br><span class="line">	ctx.clearRect(<span class="number">0</span>,<span class="number">0</span>,<span class="keyword">this</span>.W,<span class="keyword">this</span>.H);</span><br><span class="line">	<span class="keyword">if</span>(<span class="keyword">this</span>.title)&#123;</span><br><span class="line">		ctx.save();</span><br><span class="line">		ctx.textAlign=<span class="string">'center'</span>;</span><br><span class="line">		ctx.font=<span class="string">'bold 40px arial'</span>;</span><br><span class="line">		ctx.fillText(<span class="keyword">this</span>.title,<span class="keyword">this</span>.W/<span class="number">2</span>,<span class="number">70</span>);</span><br><span class="line">		ctx.restore();</span><br><span class="line">	&#125;</span><br><span class="line">	ctx.save();</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;<span class="keyword">this</span>.legend.length;i++)&#123;</span><br><span class="line">		item=<span class="keyword">this</span>.legend[i];</span><br><span class="line">		<span class="comment">// ç”»åˆ†ç±»æ ‡ç­¾</span></span><br><span class="line">		ctx.textAlign=<span class="string">'left'</span>;</span><br><span class="line">		ctx.fillStyle=item.color;</span><br><span class="line">		ctx.strokeStyle=item.color;</span><br><span class="line">		roundRect(ctx,item.x,item.y,item.w,item.h,item.r);</span><br><span class="line">		ctx.globalAlpha=item.hide?<span class="number">0.3</span>:<span class="number">1</span>;</span><br><span class="line">		ctx.fill();</span><br><span class="line">		ctx.fillText(item.name,item.x+item.w+<span class="number">20</span>,item.y+item.h<span class="number">-5</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	ctx.restore();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="æ‰§è¡Œç»˜åˆ¶é¥¼å›¾åŠ¨ç”»"><a href="#æ‰§è¡Œç»˜åˆ¶é¥¼å›¾åŠ¨ç”»" class="headerlink" title="æ‰§è¡Œç»˜åˆ¶é¥¼å›¾åŠ¨ç”»"></a>æ‰§è¡Œç»˜åˆ¶é¥¼å›¾åŠ¨ç”»</h2><p>åŠ¨ç”»åŒºåˆ†äº†åˆ›å»ºå’Œæ›´æ–°ï¼Œè¿™æ ·ç”¨æˆ·å¾ˆå®¹æ˜“å°±èƒ½çœ‹å‡ºæ•°æ®çš„æ¯”ä¾‹å…³ç³»å˜åŒ–ï¼Œä¹Ÿå°±æ›´åŠ çš„ç›´è§‚ã€‚åˆ›å»ºå°±æ˜¯ä»0å¼§åº¦åˆ°æŒ‡å®šçš„å¼§åº¦ï¼Œåªæœ‰æ•°å€¼çš„å¢åŠ ï¼›è€Œæ›´æ–°åŠ¨ç”»å°±è¦åŒºåˆ†å¢åŠ å’Œå‡å°‘çš„æƒ…å†µï¼Œå› ä¸ºå½“ç”¨æˆ·ç‚¹å‡»æŸä¸ªæ ‡ç­¾çš„æ—¶å€™ï¼Œä¼šéšè—æ˜¾ç¤ºæŸä¸ªåˆ†ç±»çš„æ•°æ®ï¼Œäºæ˜¯éœ€è¦é‡æ–°è®¡ç®—æ¯ä¸ªåˆ†ç±»çš„æ¯”ä¾‹ï¼Œé‚£ä¹ˆç›¸åº”çš„åˆ†ç±»ç™¾åˆ†æ¯”å°±ä¼šå¢åŠ æˆ–å‡å°‘ã€‚æˆ‘ä»¬æ ¹æ®å½“å‰æœ€æ–°è¦è¾¾åˆ°çš„æ¯”ä¾‹angå’Œå·²ç»æ‰§è¡Œå®Œçš„å½“å‰æ¯”ä¾‹lastçš„è¿›è¡Œå¯¹æ¯”ï¼Œç›¸åº”æ‰§è¡Œå¢åŠ å’Œå‡å°‘æ¯”ä¾‹ï¼ŒåŠ¨ç”»åŸç†å°±æ˜¯è¿™æ ·ã€‚</p>
<p>canvasç»˜åˆ¶åœ†å½¢context.arc(x,y,r,sAngle,eAngle,counterclockwise);åªè¦æˆ‘ä»¬æŒ‡å®šå¼€å§‹è§’åº¦å’Œç»“æŸè§’åº¦å°±ä¼šç”»å‡ºæŠ«è¨é¥¼ä¸€æ ·çš„æ•ˆæœï¼Œæ‰€æœ‰çš„æŠ«è¨é¥¼åŠ èµ·æ¥å°±æ˜¯ä¸€ä¸ªåœ†ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">animate()&#123;</span><br><span class="line">	<span class="keyword">var</span> that=<span class="keyword">this</span>,</span><br><span class="line">		ctx=that.ctx,</span><br><span class="line">		canvas=that.canvas,</span><br><span class="line">		item,startAng,ang,</span><br><span class="line">		isStop=<span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">	(<span class="function"><span class="keyword">function</span> <span class="title">run</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">		isStop=<span class="literal">true</span>;</span><br><span class="line">		ctx.save();</span><br><span class="line">		ctx.translate(that.W/<span class="number">2</span>,that.H/<span class="number">2</span>);</span><br><span class="line">		ctx.fillStyle=<span class="string">'#fff'</span>;</span><br><span class="line">		ctx.beginPath();</span><br><span class="line">		ctx.arc(<span class="number">0</span>,<span class="number">0</span>,that.H/<span class="number">3</span>+<span class="number">30</span>,<span class="number">0</span>,<span class="built_in">Math</span>.PI*<span class="number">2</span>,<span class="literal">false</span>);</span><br><span class="line">		ctx.fill();</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>,l=that.animateArr.length;i&lt;l;i++)&#123;</span><br><span class="line">			item=that.animateArr[i];</span><br><span class="line">			<span class="keyword">if</span>(item.hide)<span class="keyword">continue</span>;</span><br><span class="line">			startAng=-<span class="built_in">Math</span>.PI/<span class="number">2</span>;</span><br><span class="line">			that.animateArr.forEach(<span class="function">(<span class="params">obj,j</span>)=&gt;</span>&#123;</span><br><span class="line">				<span class="keyword">if</span>(j&lt;i&amp;&amp;!obj.hide)&#123;startAng+=obj.cur;&#125;</span><br><span class="line">			&#125;);</span><br><span class="line"></span><br><span class="line">			ctx.fillStyle=item.color;</span><br><span class="line">			<span class="keyword">if</span>(item.create)&#123;<span class="comment">//åˆ›å»ºåŠ¨ç”»</span></span><br><span class="line">				<span class="keyword">if</span>(item.cur&gt;=item.ang)&#123;</span><br><span class="line">					item.cur=item.last=item.ang;</span><br><span class="line">				&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">					item.cur+=<span class="number">0.05</span>;</span><br><span class="line">					isStop=<span class="literal">false</span>;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125; <span class="keyword">else</span> &#123;<span class="comment">//æ›´æ–°åŠ¨ç”»</span></span><br><span class="line">				<span class="keyword">if</span>(item.last&gt;item.ang)&#123;</span><br><span class="line">					ang=item.cur<span class="number">-0.05</span>;</span><br><span class="line">					<span class="keyword">if</span>(ang&lt;item.ang)&#123;</span><br><span class="line">						item.cur=item.last=item.ang;</span><br><span class="line">					&#125;</span><br><span class="line">				&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">					ang=item.cur+<span class="number">0.05</span>;</span><br><span class="line">					<span class="keyword">if</span>(ang&gt;item.ang)&#123;</span><br><span class="line">						item.cur=item.last=item.ang;</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">if</span>(item.cur!=item.ang)&#123;</span><br><span class="line">					item.cur=ang;</span><br><span class="line">					isStop=<span class="literal">false</span>;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			ctx.beginPath();</span><br><span class="line">			ctx.moveTo(<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">			ctx.arc(<span class="number">0</span>,<span class="number">0</span>,that.H/<span class="number">3</span>,startAng,startAng+item.cur,<span class="literal">false</span>);</span><br><span class="line">			ctx.closePath();</span><br><span class="line">			ctx.fill();</span><br><span class="line">		&#125;</span><br><span class="line">		ctx.restore();</span><br><span class="line">		<span class="keyword">if</span>(isStop) &#123;</span><br><span class="line">			that.clearGrid();</span><br><span class="line">			<span class="keyword">return</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		requestAnimationFrame(run);</span><br><span class="line">	&#125;());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="äº¤äº’å¤„ç†"><a href="#äº¤äº’å¤„ç†" class="headerlink" title="äº¤äº’å¤„ç†"></a>äº¤äº’å¤„ç†</h2><p>æ‰§è¡Œå®ŒåŠ¨ç”»åï¼Œæˆ‘è¿™é‡Œå†æ‰§è¡Œäº†ä¸€éæ¸…é™¤ç»˜åˆ¶ï¼Œè¿™ä¸ªä¹Ÿæ˜¯é¼ æ ‡è§¦æ‘¸æ ‡ç­¾å’Œé¥¼å›¾æ—¶çš„å¯¹åº”åŠ¨ç”»æ–¹æ³•ï¼Œä¼šç»˜åˆ¶æ¯ä¸ªåˆ†ç±»çš„åç§°æè¿°ï¼Œæ›´æ–¹ä¾¿ç”¨æˆ·æŸ¥çœ‹ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">clearGrid(index)&#123;</span><br><span class="line">	<span class="keyword">var</span> that=<span class="keyword">this</span>,</span><br><span class="line">		ctx=that.ctx,</span><br><span class="line">		canvas=that.canvas,</span><br><span class="line">		item,startAng=-<span class="built_in">Math</span>.PI/<span class="number">2</span>,</span><br><span class="line">		len=that.animateArr.filter(<span class="function"><span class="params">item</span>=&gt;</span>!item.hide).length,</span><br><span class="line">		j=<span class="number">0</span>,angle=<span class="number">0</span>,</span><br><span class="line">		r=that.H/<span class="number">3</span>;</span><br><span class="line">	ctx.clearRect(<span class="number">0</span>,<span class="number">0</span>,that.W,that.H);</span><br><span class="line">	that.draw();</span><br><span class="line">	ctx.save();</span><br><span class="line">	ctx.translate(that.W/<span class="number">2</span>,that.H/<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>,l=that.animateArr.length;i&lt;l;i++)&#123;</span><br><span class="line">		item=that.animateArr[i];</span><br><span class="line">		<span class="keyword">if</span>(item.hide)<span class="keyword">continue</span>;</span><br><span class="line">		ctx.strokeStyle=item.color;</span><br><span class="line">		ctx.fillStyle=item.color;</span><br><span class="line">		angle=j&gt;=len<span class="number">-1</span>?<span class="built_in">Math</span>.PI*<span class="number">2</span>-<span class="built_in">Math</span>.PI/<span class="number">2</span>:startAng+item.ang;</span><br><span class="line">		ctx.beginPath();</span><br><span class="line">		ctx.moveTo(<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">		<span class="keyword">if</span>(index===i)&#123;</span><br><span class="line">			ctx.save();</span><br><span class="line">			<span class="comment">// ctx.shadowColor='hsla(0,0%,50%,1)';</span></span><br><span class="line">			ctx.shadowColor=item.color;</span><br><span class="line">			ctx.shadowBlur=<span class="number">5</span>;</span><br><span class="line">			ctx.arc(<span class="number">0</span>,<span class="number">0</span>,r+<span class="number">20</span>,startAng,angle,<span class="literal">false</span>);</span><br><span class="line">			ctx.closePath();</span><br><span class="line">			ctx.fill();</span><br><span class="line">			ctx.stroke();</span><br><span class="line">			ctx.restore();</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			ctx.arc(<span class="number">0</span>,<span class="number">0</span>,r,startAng,angle,<span class="literal">false</span>);</span><br><span class="line">			ctx.closePath();</span><br><span class="line">			ctx.fill();</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">//ç”»åˆ†ç±»æè¿°</span></span><br><span class="line">		<span class="keyword">var</span> tr=r+<span class="number">40</span>,tw=<span class="number">0</span>,</span><br><span class="line">			tAng=startAng+item.ang/<span class="number">2</span>,</span><br><span class="line">			x=tr*<span class="built_in">Math</span>.cos(tAng),</span><br><span class="line">			y=tr*<span class="built_in">Math</span>.sin(tAng);</span><br><span class="line"></span><br><span class="line">		ctx.lineWidth=<span class="number">2</span>;</span><br><span class="line">		ctx.lineCap=<span class="string">'round'</span>;</span><br><span class="line">		ctx.beginPath();</span><br><span class="line">		ctx.moveTo(<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">		ctx.lineTo(x,y);</span><br><span class="line">		<span class="keyword">if</span>(tAng&gt;=-<span class="built_in">Math</span>.PI/<span class="number">2</span>&amp;&amp;tAng&lt;=<span class="built_in">Math</span>.PI/<span class="number">2</span>)&#123;</span><br><span class="line">			ctx.lineTo(x+<span class="number">30</span>,y);</span><br><span class="line">			ctx.fillText(item.name,x+<span class="number">40</span>,y+<span class="number">10</span>);</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			tw=ctx.measureText(item.name).width;<span class="comment">//è®¡ç®—å­—ç¬¦é•¿åº¦</span></span><br><span class="line">			ctx.lineTo(x<span class="number">-30</span>,y);</span><br><span class="line">			ctx.fillText(item.name,x<span class="number">-40</span>-tw,y+<span class="number">10</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		ctx.stroke();</span><br><span class="line">		startAng+=item.ang;</span><br><span class="line">		j++;</span><br><span class="line">	&#125;</span><br><span class="line">	ctx.restore();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="äº‹ä»¶å¤„ç†"><a href="#äº‹ä»¶å¤„ç†" class="headerlink" title="äº‹ä»¶å¤„ç†"></a>äº‹ä»¶å¤„ç†</h2><p>mousemoveçš„æ—¶å€™ï¼Œè§¦æ‘¸æ ‡ç­¾å’Œè§¦æ‘¸é¥¼å›¾éƒ½æ˜¯åŸºæœ¬ç›¸åŒçš„æ•ˆæœï¼Œé€‰ä¸­çš„åˆ†ç±»æ‰©å¤§åŠå¾„ï¼ŒåŒæ—¶å¢åŠ é˜´å½±ï¼Œä»¥è¾¾åˆ°å‡¸å‡ºæ¥çš„åŠ¨ç”»æ•ˆæœï¼Œå…·ä½“å®ç°è¯·çœ‹ä¸Šé¢çš„clearGridæ–¹æ³•ã€‚åˆ¤æ–­æ˜¯å¦ç‚¹ä¸­éƒ½æ˜¯ä½¿ç”¨isPointInPathè¿™ä¸ªapiï¼Œä¹‹å‰å·²ç»ä»‹ç»è¿‡ï¼Œä¸å†ç»†è®²ã€‚</p>
<p>mousedownæŸä¸ªå‡»æ ‡ç­¾å°±ä¼šæ˜¾ç¤ºéšè—å¯¹åº”åˆ†ç±»ï¼Œæ¯æ¬¡è§¦å‘å°±ä¼šçœ‹åˆ°é¥¼å›¾çš„æ¯”ä¾‹å˜åŒ–çš„åŠ¨ç”»æ•ˆæœï¼Œè¿™ä¸ªå’Œä¹‹å‰çš„æŸ±çŠ¶å›¾å’ŒæŠ˜çº¿å›¾çš„åŠŸèƒ½ä¸€è‡´ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">bindEvent()&#123;</span><br><span class="line">	<span class="keyword">var</span> that=<span class="keyword">this</span>,</span><br><span class="line">		canvas=that.canvas,</span><br><span class="line">		ctx=that.ctx;</span><br><span class="line">	<span class="keyword">if</span>(!<span class="keyword">this</span>.data.length) <span class="keyword">return</span>;</span><br><span class="line">	<span class="keyword">this</span>.canvas.addEventListener(<span class="string">'mousemove'</span>,<span class="function"><span class="keyword">function</span>(<span class="params">e</span>)</span>&#123;</span><br><span class="line">		<span class="keyword">var</span> isLegend=<span class="literal">false</span>;</span><br><span class="line">		<span class="keyword">var</span> box=canvas.getBoundingClientRect(),</span><br><span class="line">			pos = &#123;</span><br><span class="line">			x:e.clientX-box.left,</span><br><span class="line">			y:e.clientY-box.top</span><br><span class="line">		&#125;;</span><br><span class="line">		<span class="comment">// æ ‡ç­¾</span></span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>,item,len=that.legend.length;i&lt;len;i++)&#123;</span><br><span class="line">			item=that.legend[i];</span><br><span class="line">			roundRect(ctx,item.x,item.y,item.w,item.h,item.r);</span><br><span class="line">			<span class="keyword">if</span>(ctx.isPointInPath(pos.x*<span class="number">2</span>,pos.y*<span class="number">2</span>))&#123;</span><br><span class="line">				canvas.style.cursor=<span class="string">'pointer'</span>;</span><br><span class="line">				<span class="keyword">if</span>(!item.hide)&#123;</span><br><span class="line">					that.clearGrid(i);</span><br><span class="line">				&#125;</span><br><span class="line">				isLegend=<span class="literal">true</span>;</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			canvas.style.cursor=<span class="string">'default'</span>;</span><br><span class="line">			that.tip.style.display=<span class="string">'none'</span>;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span>(isLegend) <span class="keyword">return</span>;</span><br><span class="line">		<span class="comment">// å›¾è¡¨</span></span><br><span class="line">		<span class="keyword">var</span> startAng=-<span class="built_in">Math</span>.PI/<span class="number">2</span>;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>,l=that.animateArr.length;i&lt;l;i++)&#123;</span><br><span class="line">			item=that.animateArr[i];</span><br><span class="line">			<span class="keyword">if</span>(item.hide)<span class="keyword">continue</span>;</span><br><span class="line">			ctx.beginPath();</span><br><span class="line">			ctx.moveTo(that.W/<span class="number">2</span>,that.H/<span class="number">2</span>);</span><br><span class="line">			ctx.arc(that.W/<span class="number">2</span>,that.H/<span class="number">2</span>,that.H/<span class="number">3</span>,startAng,startAng+item.ang,<span class="literal">false</span>);</span><br><span class="line">			ctx.closePath();</span><br><span class="line">			startAng+=item.ang;</span><br><span class="line">			<span class="keyword">if</span>(ctx.isPointInPath(pos.x*<span class="number">2</span>,pos.y*<span class="number">2</span>))&#123;</span><br><span class="line">				canvas.style.cursor=<span class="string">'pointer'</span>;</span><br><span class="line">				that.clearGrid(i);</span><br><span class="line">				that.showInfo(pos,that.toolTip,[&#123;<span class="attr">name</span>:item.name,<span class="attr">num</span>:item.num+<span class="string">' ('</span>+item.percent+<span class="string">'%)'</span>&#125;]);</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			canvas.style.cursor=<span class="string">'default'</span>;</span><br><span class="line">			that.clearGrid();</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">	&#125;,<span class="literal">false</span>);</span><br><span class="line">	<span class="keyword">this</span>.canvas.addEventListener(<span class="string">'mousedown'</span>,<span class="function"><span class="keyword">function</span>(<span class="params">e</span>)</span>&#123;</span><br><span class="line">		e.preventDefault();</span><br><span class="line">		<span class="keyword">var</span> box=that.canvas.getBoundingClientRect();</span><br><span class="line">		<span class="keyword">var</span> pos = &#123;</span><br><span class="line">			x:e.clientX-box.left,</span><br><span class="line">			y:e.clientY-box.top</span><br><span class="line">		&#125;;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>,item,len=that.legend.length;i&lt;len;i++)&#123;</span><br><span class="line">			item=that.legend[i];</span><br><span class="line">			roundRect(ctx,item.x,item.y,item.w,item.h,item.r);</span><br><span class="line">			<span class="keyword">if</span>(ctx.isPointInPath(pos.x*<span class="number">2</span>,pos.y*<span class="number">2</span>))&#123;</span><br><span class="line">				that.data[i].hide=!that.data[i].hide;</span><br><span class="line">				that.create();</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;,<span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="æœ€å"><a href="#æœ€å" class="headerlink" title="æœ€å"></a>æœ€å</h2><p>æ‰€æœ‰å›¾è¡¨ä»£ç è¯·çœ‹<em><a href="https://github.com/edwardzhong/html5Canvas/blob/master/chart/chart.js" target="_blank" rel="noopener">chart.js</a></em></p>
</div>
    	
		<div class="post-footer">
			<div class="tags">
				<i class="icon-tags"></i> 
				
					
					
						
							<a href="/tags/%E5%89%8D%E7%AB%AF/">å‰ç«¯</a>
						
					
						
							<a href="/tags/js/">js</a>
						
					
						
							<a href="/tags/canvas/">canvas</a>
						
					
				
			</div>
			<a class="share" href="javascript:;" data-url="/2017/11/23/chartpie/" data-desc="
è¿™å‡ å¤©æŠŠcanvaså›¾è¡¨éƒ½ä¼˜åŒ–äº†ä¸‹ï¼ŒåŠ¨ç”»æ•ˆæœæ›´åŠ å‡ºè‰²äº†ï¼Œå¯ä»¥è¯´å¾ˆé€¼è¿‘Echartäº†ã€‚åˆšåˆšå†™å®Œ..." data-type="share" title="share"><i class="icon-share"></i></a>
		</div>
	</div>
</article>
</div>
<nav class="pagination clearfix">
  
    
      
        <a href="/2017/11/24/chartpoint/" class="prev post-prev"> <i class="icon-leftarrow"></i> canvaså›¾è¡¨(4) - æ•£ç‚¹å›¾</a>
      

      
        <a href="/2017/11/21/chartline/" class="next post-next"> canvaså›¾è¡¨(2) - æŠ˜çº¿å›¾ <i class="icon-rightarrow"></i></a>
      
    
  
</nav>

<div class="wxshare-popup">
    <a class="close" href="javascript:;"></a>
    <p>æ‰«ä¸€æ‰«ï¼Œåˆ†äº«åˆ°å¾®ä¿¡</p>
    <div id="qrcode" class="wx-qrcode"></div>
</div>

    
    <footer class="footer">
<p class="theme">
	Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/edwardzhong/simply.git" target="_blank" rel="noopener">simply</a>
</p>
<p class="copy">Copyright &copy; 2020 Jeff Zhong</p>
</footer>
    <div class="top-bottom">
      <div class="to-top hide" title="to top"><i class="icon-up"></i></div>
      <div class="to-bottom hide" title="to bottom"><i class="icon-down"></i></div>
    </div>
    </div>

  </div>
<input type="hidden" name="isPost" id="isPost" value="true">
<i id="barBtn" class="icon icon-menu"></i>
<div id="payMe" class="payme">
    <i class="icon icon-cancel"></i>
    <p class="pay-title">ç»™æˆ‘çš„æ—©é¤åŠ ä¸ªè›‹å§ ğŸ˜Š</p>
    <div>
      <img src="/images/weixinpay.jpg" alt="weixinpay">
      <img src="/images/alipay.jpg" alt="alipay" style="display:none;">
    </div>
    <div class="pay-selects">
        <input type="radio" name="pay" id="weixinpay" checked="checked"><label for="weixinpay"> å¾®ä¿¡ </label>&nbsp;&nbsp;
        <input type="radio" name="pay" id="alipay"><label for="alipay"> æ”¯ä»˜å® </label>
    </div>
</div>

  
  
    <script src="/lib/jquery-2.2.3.min.js"></script>
  
    <script src="/lib/qrcode.min.js"></script>
  
    <script src="/js/index.js"></script>
  

<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>

</body>
</html>
